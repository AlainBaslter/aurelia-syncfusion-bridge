/*!
*  filename: ej.kanban.min.js
*  version : 12.3
*  Copyright Syncfusion Inc. 2001 - 2014. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["jquery-easing","./../common/ej.globalize.min","jquery-validation","jsrender","./../common/ej.core.min","./../common/ej.data.min","./../common/ej.touch.min","./../common/ej.draggable.min","./../common/ej.scroller.min","./ej.button.min","./ej.waitingpopup.min","./ej.datepicker.min","./ej.datetimepicker.min","./ej.dropdownlist.min","./ej.dialog.min","./ej.editor.min","./ej.toolbar.min","./ej.rte.min","./ej.menu.min"],n):n()})(function(){var t,n;(function(n){var t;(function(t){var i=function(){function t(n){this.kanbanObj=null;this._dragEle=null;this._dropEle=null;this._priorityCollection=[];this._dropTarget=null;this.kanbanObj=n}return t.prototype._addDragableClass=function(){var n=this.kanbanObj;n._dropped=!1;this._dragEle=n.getContent().find(".e-columnrow .e-kanbancard");this._dropEle=n.getContent().find(".e-columnrow .e-rowcell");this._dropEle.addClass("e-droppable");this._dragEle.addClass("e-draggable e-droppable");this._enableDragDrop();n._on(n.element,"mouseup touchstart pointerdown MSPointerDown","",$.proxy(n.element.focus(),this))},t.prototype._enableDragDrop=function(){var n=this.kanbanObj;this._drag();$(n.getContent()).ejDroppable({accept:$(n.getContent()).find("div.e-kanbancard"),drop:function(n,t){$(t.helper).hide()}})},t.prototype._selectedPrevCurrentCards=function(){var t,i,n=this.kanbanObj;n._previousRowCellIndex.length>0&&(t=n._getCardbyIndexes(n._previousRowCellIndex),n._pCardId=t.attr("id"));n._previousRowCellIndex=n._currentRowCellIndex;n._pCardId=n._cCardId;n._currentRowCellIndex.length>0&&(i=n._getCardbyIndexes(n._currentRowCellIndex),n._cCardId=i.attr("id"))},t.prototype._getPriorityIndex=function(t){for(var r=null,u=this.kanbanObj,i=0;i<u._priorityCollection.length;i++)if(u._priorityCollection[i].primaryKey==t.attr("id")){r=u._priorityCollection[i];break}return n.isNullOrUndefined(r)?this._getPriorityKey(n.parseInt(t.attr("id"))):n.parseInt(r.dropKey)},t.prototype._removeFromPriorirtyCollec=function(t){for(var r=null,u=this.kanbanObj,i=0;i<u._priorityCollection.length;i++)if(u._priorityCollection[i].primaryKey==t){r=i;break}n.isNullOrUndefined(r)||u._priorityCollection.splice(r,1)},t.prototype._columnDataOndrop=function(t,i){var u=this.kanbanObj,c=new n.DataManager(u._initialData),f,e,o,s,h,r=new n.Query;return e=u.model.keyField,o=u.model.fields.swimlaneKey,s=$(t).hasClass("e-rowcell")?$(t).attr("ej-mappingkey"):$(t).parents(".e-rowcell").attr("ej-mappingkey"),h=$(t).parents(".e-columnrow").prev(".e-swimlanerow").find(".e-slkey").text(),r=n.isNullOrUndefined(o)?r.where(e,n.FilterOperators.equal,s):r.where(e,n.FilterOperators.equal,s).where(o,n.FilterOperators.equal,h),f=c.executeLocal(r),f.sort(function(n,t){return n[i]-t[i]}),f},t.prototype._dropToColumn=function(t,i){var r=this.kanbanObj,c,f,e=[],l=!1,o=r.model.fields.priority,a,s,v,h,u,y;for(n.isNullOrUndefined(r._filterToolBar)||(a=r._filterToolBar.find(".e-select")),t.hasClass("e-targetclone")&&(t=t.parent()),this._selectedPrevCurrentCards(),o&&(!n.isNullOrUndefined(r._filterToolBar)&&a.length>0||r._searchBar!=null&&r._searchBar.find(".e-cancel").length>0)?(e=this._columnDataOndrop(t,o),l=e.length>0):l=$(t).children(".e-kanbancard").length>1,r.model.selectionType==n.Kanban.SelectionType.Multiple&&this._getSelectedCards(i).length>0&&$(i).hasClass("e-cardselection")&&(i=this._getSelectedCards(i)),s=0;s<i.length;s++)for(v=i[s],h=0;h<$(v).length;h++)u=$(v)[h],$(u).is(":visible")&&(o&&l&&(c=!n.isNullOrUndefined(r._filterToolBar)&&a.length>0||r._searchBar!=null&&r._searchBar.find(".e-cancel").length>0?e[e.length-1][o]:this._getPriorityIndex(t.find(".e-kanbancard").last()),f=this._getPriorityIndex($(u)),c>=f&&(f=++c),this._removeFromPriorirtyCollec($(u).attr("id")),r._priorityCollection.push({primaryKey:$(u).attr("id"),dropKey:f}),y=r._getKanbanCardData(r._currentJsonData,$(u)[0].id)[0],n.isNullOrUndefined(f)||(y[o]=f,e.push(y))),$(t).find(".e-customaddbutton").length>0?$(u).insertBefore($(t).find(".e-customaddbutton")):$(t).append(u));this._updateDropAction(t,i)},t.prototype._updateDropAction=function(t,i){var v,r=this.kanbanObj,u,e,o,s,c,f,h,l,a;for(v=$(t).hasClass("e-rowcell")?t:$(t).closest("td.e-rowcell"),r._selectedCardData=[],u=0;u<i.length;u++)if(n.isNullOrUndefined(i[u].length))$(i[u]).is(":visible")&&(e=$(i[u]).attr("id"),this._updateDropData(t,i[u],e),f=r.element.find("#"+e),f.parents(".e-rowcell").hasClass("e-shrink")&&f.addClass("e-hide"));else for(o=0;o<i[u].length;o++)$(i[u][o]).is(":visible")&&(e=i[u][o].id,this._updateDropData(t,i[u][o],e),f=r.element.find("#"+e),f.parents(".e-rowcell").hasClass("e-shrink")&&f.addClass("e-hide"));if(r.model.fields.priority&&r._priorityCollection.length>0)for(s=0;s<r._priorityCollection.length;s++)c=r._priorityCollection[s].primaryKey,f=r.element.find("#"+c),this._updateDropData(t,f,c);r._bulkUpdateData.length>0&&(r._dataManager instanceof n.DataManager&&!r._dataManager.dataSource.offline||r._dataSource().adaptor instanceof n.remoteSaveAdaptor)&&(a=this,l={added:[],deleted:[],changed:[]},l.changed=r._bulkUpdateData,$("#"+r._id).data("ejWaitingPopup").show(),h=r._dataManager.saveChanges(l,r.model.fields.primaryKey,r.model.query._fromTable),$.isFunction(h.promise)&&(h.done(function(){a._updateDataOndrop(r._bulkUpdateData)}),h.fail(function(n){var t={error:n.error};a._updateDataOndrop(r._failBulkData);r._trigger("actionFailure",t)})));(!n.isNullOrUndefined(i[0].length)&&i[0].length>1||i.length>1||i.length==1&&$(i).hasClass("e-cardselection"))&&(r._previousRowCellIndex=n.isNullOrUndefined(r._pCardId)?[]:this._updateRowCellIndexes(r._pCardId,r._previousRowCellIndex),r._currentRowCellIndex=n.isNullOrUndefined(r._cCardId)?[]:this._updateRowCellIndexes(r._cCardId,r._currentRowCellIndex),r._selectionOnRerender(),n.isNullOrUndefined(r._pCardId)&&(r._previousRowCellIndex=r._currentRowCellIndex),r.model.selectionType==n.Kanban.SelectionType.Single?r.selectedRowCellIndexes=r._currentRowCellIndex:this._updateSelectedCardIndexes(t));r._priorityCollection=[]},t.prototype._updateDataOndrop=function(n){for(var r,t=this.kanbanObj,i=0;i<n.length;i++)r=n[i][t.model.fields.primaryKey],t.element.find("#"+r).length>0&&t._renderSingleCard(r,n[i]);t._failBulkData=[];t._bulkUpdateData=[];t.refresh(!0);$("#"+t._id).data("ejWaitingPopup").hide()},t.prototype._getPriorityKey=function(n){var t=this.kanbanObj,i=t._getKanbanCardData(t._currentJsonData,n);return i[0][t.model.fields.priority]},t.prototype._dropAsSibling=function(t,i,r){var u=this.kanbanObj,h=0,g=0,it=0,w,rt,e,d,nt,ut,ft,f=[],st,c=u.model.fields.priority,b,k,a,et,y,o,ht,ot,p,s,v,l,tt;for(n.isNullOrUndefined(u._filterToolBar)||(b=u._filterToolBar.find(".e-select")),k=u.model.fields.primaryKey,this._selectedPrevCurrentCards(),c&&(!n.isNullOrUndefined(u._filterToolBar)&&b.length>0||u._searchBar!=null&&u._searchBar.find(".e-cancel").length>0)&&(f=this._columnDataOndrop(t,c)),$(t).hasClass("e-targetclone")&&(ut=$(t).prevAll(".e-kanbancard")[0],ft=$(t).nextAll(".e-kanbancard")[0],$(t).hasClass("e-targetappend")?(r=!0,t=ut,n.isNullOrUndefined(t)&&(t=ft)):(r=!1,t=ft,n.isNullOrUndefined(t)&&(t=ut))),nt=t,u.model.selectionType==n.Kanban.SelectionType.Multiple&&this._getSelectedCards(i).length>0&&$(i).hasClass("e-cardselection")&&(i=this._getSelectedCards(i)),a=0;a<i.length;a++)for(et=i[a],y=0;y<$(et).length;y++)if(o=$(et)[y],$(o).is(":visible")&&(r&&(y>0&&i[a][y-1]!=nt?t=i[a][y-1]:y==0&&a>0&&i[a-1]!=nt&&(t=i[a-1])),o!=nt&&(r?$(o).insertAfter(t):$(o).insertBefore(t),c&&(!n.isNullOrUndefined(u._filterToolBar)&&b.length>0||u._searchBar!=null&&u._searchBar.find(".e-cancel").length>0)&&(ht=u._getKanbanCardData(f,$(t).attr("id")),l=f.indexOf(ht[0]),r?f.splice(l+1,0,u._getKanbanCardData(u._currentJsonData,$(o)[0].id)[0]):f.splice(l,0,u._getKanbanCardData(u._currentJsonData,$(o)[0].id)[0]),st=$(o)[0].id)),c)){if(!n.isNullOrUndefined(u._filterToolBar)&&b.length>0||u._searchBar!=null&&u._searchBar.find(".e-cancel").length>0)for(v=u._getKanbanCardData(f,$(t).attr("id")),h=v[0][c],v=u._getKanbanCardData(f,st),d=[],p=f.indexOf(v[0]);p<f.length;p++)d.push(f[p]);else h=this._getPriorityIndex($(t)),d=$(o).nextAll(".e-kanbancard")["andSelf()"];for(p=0;p<d.length;p++){if(s=d[p],!n.isNullOrUndefined(u._filterToolBar)&&b.length>0||u._searchBar!=null&&u._searchBar.find(".e-cancel").length>0?(v=null,e=s[c],!r&&n.parseInt($(o)[0].id)==s[c]&&h<e&&(e=h),v=u._getKanbanCardData(f,s[k]),l=ot=f.indexOf(v[0]),l-1>=0&&(g=f[l-1][c]),v=u._getKanbanCardData(f,s[k]),l=ot=f.indexOf(v[0]),l+1<f.length?(it=f[l+1][c],w=f[l+1]):w=[]):(e=this._getPriorityKey(n.parseInt($(s).attr("id"))),!r&&$(o)[0]==s&&h<e&&(e=h),rt=$(s).prevAll(".e-kanbancard"),rt.length>0&&(g=this._getPriorityIndex(rt.eq(0))),w=$(s).nextAll(".e-kanbancard"),w.length>0&&(it=this._getPriorityIndex(w.eq(0)))),!isNaN(g)&&g<e&&(e<it||w.length==0))break;!n.isNullOrUndefined(u._filterToolBar)&&b.length>0||u._searchBar!=null&&u._searchBar.find(".e-cancel").length>0?(!r&&n.parseInt($(o)[0].id)==s[k]?!r&&n.parseInt($(o)[0].id)==s[k]&&h<e||(e=h):e=++h,f[ot][c]=e,tt=s[k]):(!r&&$(o)[0]==s?!r&&$(o)[0]==s&&h<e||(e=h):e=++h,tt=$(s).attr("id"));this._removeFromPriorirtyCollec(tt);u._priorityCollection.push({primaryKey:tt,dropKey:e});h=e}}this._updateDropAction(t,i);this._dropTarget=null},t.prototype._updateSelectedCardIndexes=function(n){var e,f,t=this.kanbanObj,i,r,u;if(t.selectedRowCellIndexes.length>0)for($(n).hasClass("e-rowcell")?f=$(n).index():(n=t.element.find("#"+$(n).attr("id")),f=$(n).parents(".e-rowcell").index()),e=$(n).parents(".e-columnrow"),$.inArray(f,t.selectedRowCellIndexes[0].cellIndex)==-1&&t.selectedRowCellIndexes[0].cellIndex.push(f),i=0;i<t.selectedRowCellIndexes[0].cellIndex.length;i++)if(r=e.find(".e-rowcell").eq(t.selectedRowCellIndexes[0].cellIndex[i]).find(".e-cardselection"),r.length>0)for(t.selectedRowCellIndexes[0].cardIndex.splice(i,1),t.element.find(".e-targetclone").remove(),u=0;u<r.length;u++)u>0?t.selectedRowCellIndexes[0].cardIndex[i].push($(r[u]).index()):t.selectedRowCellIndexes[0].cardIndex.splice(i,0,[$(r[0]).index()]);else t.selectedRowCellIndexes[0].cellIndex.splice(i,1),t.selectedRowCellIndexes[0].cardIndex.splice(i,1),--i},t.prototype._updateDropData=function(t,i,r){var u=this.kanbanObj,a,o,c,f,s,l,h,e,v;if(!n.isNullOrUndefined(u.model.fields.primaryKey)){if(f=[],o=u.model.fields.priority,c=u.model.fields.primaryKey,n.isNullOrUndefined(r)&&(r=$(t).attr("id")),a=$(t).hasClass("e-rowcell")?$(t):$(t).parents(".e-rowcell"),a.index()<0&&(a=u.element.find("#"+$(t).attr("id")).parents(".e-rowcell")),f=u._getKanbanCardData(u._currentJsonData,r),(u._dataManager instanceof n.DataManager&&!u._dataManager.dataSource.offline||u._dataSource().adaptor instanceof n.remoteSaveAdaptor)&&u._failBulkData.push($.extend(!0,{},f[0])),f.length>0&&(f[0][u.model.keyField]=u.model.columns[a.index()].key,u.model.fields.swimlaneKey&&(f[0][u.model.fields.swimlaneKey]=$(t).parents("tr.e-columnrow").prev().find("div.e-slkey").html())),u._dropped=!0,o&&u._priorityCollection.length>0){for(h=0;h<u._priorityCollection.length;h++)if(u._priorityCollection[h].primaryKey==r){s=u._priorityCollection[h];u._priorityCollection.splice(h,1);break}if(!n.isNullOrUndefined(s)&&f.length>0&&(f[0][o]=s.dropKey),!n.isNullOrUndefined(u._filterToolBar)&&u._filterToolBar.find(".e-select").length>0&&!n.isNullOrUndefined(s)||u._searchBar!=null&&u._searchBar.find(".e-cancel").length>0)for(e=0;e<u._initialData.length;e++)if(s.primaryKey==u._initialData[e][c]){f.length>0?u._initialData[e]=f[0]:u._initialData[e][o]=s.dropKey;l=u._initialData[e];break}}if(f.length>0){if($(i).hasClass("e-cardselection")){for(e=0;e<u._selectedCardData.length;e++)if(f[0][c]==u._selectedCardData[e][c])break;u._selectedCardData.splice(e,1);u._selectedCardData.push(f[0])}u._dataManager instanceof n.DataManager&&!u._dataManager.dataSource.offline||u._dataSource().adaptor instanceof n.remoteSaveAdaptor?u._bulkUpdateData.push(f[0]):u._renderSingleCard(r,f[0])}else o&&(u._dataManager instanceof n.DataManager&&!u._dataManager.dataSource.offline||u._dataSource().adaptor instanceof n.remoteSaveAdaptor?u._getKanbanCardData(u._bulkUpdateData,l[c]).length<=0&&u._bulkUpdateData.push(l):u._dataSource()instanceof n.DataManager?(v=u._getKanbanCardData(u._dataSource().dataSource.json,r),v[0][o]=l[o]):(v=u._getKanbanCardData(u._dataSource(),r),v[0][o]=l[o]))}},t.prototype._updateRowCellIndexes=function(t,i){var e,r,u=[],f;return n.isNullOrUndefined(t)?u=i:(f=this.kanbanObj.element.find("#"+t),e=$(f).parents(".e-columnrow"),r=$(f).parents(".e-rowcell"),u.push([e.index(),[r.index()],[r.find(".e-kanbancard").index(r.find("#"+t))]])),u},t.prototype._dragStop=function(n,t,i){var s=this,c,y,l,p,f,u=this.kanbanObj,r,o,v,h;if(n.element.dropped||t&&t.remove(),n.target=this._getCursorElement(n),r=$(n.target).closest(".e-kanbancard").length>0?$(n.target).closest(".e-kanbancard")[0]:n.target,s._dropEle.removeClass("e-dropping e-dragged"),c={data:n.dragData,draggedElement:n.dragEle,dropTarget:$(r),event:n.event},u._trigger("cardDragStop",c))return!1;l=$(n.element).parents(".e-columnrow");y=l.find(".e-cardselection");p=l.find(".e-rowcell");f=u.element.find(".e-targetclone");var w=$(r).parent().children().hasClass("e-customaddbutton"),a=$(r).parent().children().hasClass("e-limits"),b=$(r).parent().children().hasClass("e-shrinkheader"),e=$(r).parent().children(),k=b?w?a?e.length==4:e.length==3:a?e.length==3:e.length==2:w?a?e.length==3:e.length==2:a?e.length==2:e.length==1;return(f.is(":visible")?r.nodeName=="TD"&&$(r).parent().hasClass("e-columnrow")&&f.is(":visible")||f.siblings().length<=0||k?(o=$(r).children().last(),o.hasClass("e-targetclone")&&(o=o.prev()),v=f.siblings().not(".e-shrinkheader").not(".e-customaddbutton").not(".e-limits"),($(r).children().length==0||v.length<=0||$(o).offset().top+$(o).height()<$(f).offset().top)&&(o.next().hasClass("e-targetclone")||v.length<=0?s._dropToColumn($(r),$(n.element)):(i=!1,s._dropAsSibling($(f.next()),$(n.element),i)))):r.nodeName=="DIV"&&($(r).hasClass("e-kanbancard")||$(r).hasClass("e-targetclone"))&&(f.is(":visible")||y.length>1)&&s._dropAsSibling($(r),$(n.element),i):s._removeKanbanCursor(),u.element.find(".e-targetclone").remove(),p.height(l.find(r).parents(".e-rowcell").height()-u._tdHeightDiff),u._on(u.element,"mouseenter mouseleave",".e-columnrow .e-kanbancard",u._cardHover),$(t).length>0&&$(t).remove(),u._renderLimit(),u._totalCount(),u._eventBindings(),u.model.minWidth&&u.model.isResponsive&&u._kanbanWindowResize(),h=u.element.find("#"+n.element.attr("id")),$(h).hasClass("e-cardselection")&&(h=$(h).parents(".e-columnrow").find(".e-cardselection:visible")),c.draggedElement=h,u._trigger("cardDrop",c))?!1:!0},t.prototype._getCursorElement=function(n){var i=$(n.target).closest(".dragClone"),t=n.event;return i.length>0&&(i.hide(),n.target=t.type=="touchmove"||t.type=="touchstart"||t.type=="touchend"?document.elementFromPoint(t.originalEvent.changedTouches[0].pageX,t.originalEvent.changedTouches[0].pageY):document.elementFromPoint(t.clientX,t.clientY),i.show()),n.target},t.prototype._getSelectedCards=function(n){for(var r,t=this.kanbanObj,i=0;i<t._selectedCards.length;i++)if($(t._selectedCards[i]).length>1)for(r=0;r<t._selectedCards[i].length;r++)$(t._selectedCards[i][r])[0]==n[0]&&(t._selectedCards[i].splice(r,1),t._selectedCards[i].splice(0,0,n[0]),t._selectedCards.splice(0,0,t._selectedCards[i]),t._selectedCards.splice(i+1,1));else $(t._selectedCards[i])[0]==n[0]&&(t._selectedCards.splice(0,0,t._selectedCards[i]),t._selectedCards.splice(i+1,1));return t._selectedCards},t.prototype._kanbanAutoScroll=function(n){var g=this,t=this.kanbanObj,o=t.getContent(),r=o.data("ejScroller"),u=null,f=null,e=null,i=null,s=t.element.find(".e-draggedcard"),w,l,b,a,v,h,k,y,c,d,p;a=n.event.clientX;v=n.event.clientY;w=t.element.width();l=t.element.offset().left;b=t.element.offset().top;y=o.find(".e-hup");k=o.find(".e-hdown");p=o.find(".e-vup");d=o.find(".e-vdown");h=o.find(".e-hhandle.e-box");c=o.find(".e-vhandle.e-box");a>l+w-10?(t.element.removeClass("e-view-horizontal"),f=window.setInterval(function(){h.width()+h.offset().left<=k.offset().left&&!t.element.hasClass("e-view-horizontal")?r.scrollX(r.scrollLeft()+5,!0):f&&(f=window.clearInterval(f));s.length<=0&&f&&(f=window.clearInterval(f))},100)):a-10<l?(t.element.removeClass("e-view-horizontal"),r.scrollLeft()>0&&(u=window.setInterval(function(){h.offset().left>=y.offset().left+y.width()&&!t.element.hasClass("e-view-horizontal")?r.scrollX(r.scrollLeft()-5,!0):u&&(u=window.clearInterval(u));s.length<=0&&u&&(u=window.clearInterval(u))},100))):(t.element.addClass("e-view-horizontal"),f&&(f=window.clearInterval(f)),u&&(u=window.clearInterval(u)));v>b+t.getHeaderContent().height()+(o.height()-15)?(t.element.removeClass("e-view-vertical"),i=window.setInterval(function(){c.height()+c.offset().top<=d.offset().top&&!t.element.hasClass("e-view-vertical")?r.scrollY(r.scrollTop()+5,!0):i&&(i=window.clearInterval(i));s.length<=0&&i&&(i=window.clearInterval(i))},100)):v-10<t.element.find(".e-kanbancontent").offset().top?r.scrollTop()>0&&(t.element.removeClass("e-view-vertical"),e=window.setInterval(function(){i&&(i=window.clearInterval(i));c.offset().top>=p.offset().top+p.height()&&!t.element.hasClass("e-view-vertical")?r.scrollY(r.scrollTop()-5,!0):e&&(e=window.clearInterval(e));s.length<=0&&e&&(i=window.clearInterval(e))},100)):(t.element.addClass("e-view-vertical"),i&&(i=window.clearInterval(i)),e&&(e=window.clearInterval(e)))},t.prototype._changeKanbanCursor=function(n,t,i){var u=$(n).parents(".e-kanbancard"),f=$(n).hasClass("e-kanbancard"),r,e;u.length>0||f?(e=f?$(n):u,e[0].style.cursor="not-allowed"):($(n).parents(".e-columnrow").has(i.element).length==0||$(n).parents(".e-swimlanerow").length>0)&&(document.body.style.cursor="not-allowed");r=$(t).find(".e-kanbancard");r.length>0&&(r[0].style.cursor="not-allowed")},t.prototype._removeKanbanCursor=function(){document.body.style.cursor="";this.kanbanObj.element.find(".e-kanbancard").css("cursor","")},t.prototype._drag=function(){var u=this,i=null,r=null,c=null,l=null,a=null,v,s,e,o=[],f,h,t=this.kanbanObj;t.element!=null&&(c=t.getContent().find("div:first"));$(t.getContent()).find("div.e-kanbancard").not(".e-js").ejDraggable({dragArea:c,clone:!0,cursorAt:{left:-20,top:-20},dragStart:function(f){var c,s;if(t.model.enableTouch&&!n.isNullOrUndefined(t._cardSelect)&&t._cardSelect=="touch")return!1;for(t._off(t.element,"mouseenter mouseleave",".e-columnrow .e-kanbancard"),h=t.element.find(".e-draggedcard"),r=$(f.element).hasClass("e-cardselection")?$(f.element).parents(".e-columnrow").find(".e-cardselection:visible"):$(f.element),r.length>1&&(c=n.buildTag("div.e-dragmultiple"),c.append(r.length+t.localizedLabels.Cards),h.children().remove(),h.append(c).css("width","90px")),s=0;s<r.length;s++)r[s].id!=""&&(v=new n.DataManager(t._currentJsonData),o.push(v.executeLocal((new n.Query).where(t.model.fields.primaryKey,n.FilterOperators.equal,n.parseInt(r[s].id)))));if(u&&!n.isNullOrUndefined(f.target)){if(e={draggedElement:r,dragTarget:f.target,data:o,event:f.event},t._trigger("cardDragStart",e))return f.cancel=!0,i&&i.remove(),!1}else return!1;return!0},drag:function(n){var h,c,b,w,v,y,p;return(s=!1,t._cardSelect=null,t.element.find(".e-kanbantooltip").hide(),$(".e-kanban-context").length>0&&$(".e-kanban-context").css("visibility","hidden"),t._kTouchBar.hide(),(t.model.allowScrolling||t.model.isResponsive)&&u._kanbanAutoScroll(n),$(n.target).closest(".dragClone").length>0&&(n.target=l,clearTimeout(a),a=setTimeout(function(){n.target=u._getCursorElement(n)},10)),$(n.target).hasClass("e-targetclone")||$(n.target).hasClass("e-rowcell")||$(f).remove(),h=$(n.target).closest(".e-kanbancard").length>0?$(n.target).closest(".e-kanbancard")[0]:n.target,b=$(n.element).closest("td.e-rowcell").addClass("e-dragged"),b.siblings().addClass("e-dropping"),e={draggedElement:r,data:o,dragTarget:h,event:n.event},l=c=$(h).closest("td.e-rowcell"),w=c.parents(".e-columnrow").find(".e-cardselection"),c&&c.hasClass("e-droppable")&&$(c).parent().has(n.element[0]).length>0&&(h!=n.element[0]||w.length>1)?(document.body.style.cursor="",$(f).parents(".e-rowcell").index()!=c.index()&&$(f).remove(),c.find(".e-kanbancard").removeClass("e-hover"),v=c.children().last(),v.hasClass("e-shrinkheader")&&(v=v.prev()),$(h).hasClass("e-rowcell")&&(n.element[0]!=v[0]||w.length>1)&&!$(h).hasClass("e-shrink")?(v.length==0||c.children().length==0||v.offset().top+v.height()<$(i).offset().top)&&(y=$(h).height(),c.append($(f).height($(n.element[0]).height()).width($(h).width()-28)),y<$(h).height()&&(c.height(c.height()),t._tdHeightDiff=$(h).height()-y)):($(h).hasClass("e-kanbancard")||$(h).hasClass("e-targetclone"))&&(p=$(h).parents(".e-rowcell"),y=p.height(),$(h).offset().top+$(h).height()/2>=n.event.pageY?$(h).prev()[0]!=n.element[0]||w.length>1?$(h).hasClass("e-targetclone")||(u._removeKanbanCursor(),$(f).insertBefore($(h)).height($(n.element[0]).height()).width($(h).width()).removeClass("e-targetappend")):u._changeKanbanCursor(h,i,n):$(h).next()[0]!=n.element[0]||w.length>1?(y=$(h).parents(".e-rowcell").height(),$(h).hasClass("e-targetclone")||(s=!0,u._removeKanbanCursor(),$(f).insertAfter($(h)).height($(n.element[0]).height()).width($(h).width()).addClass("e-targetappend"))):u._changeKanbanCursor(h,i,n),y<p.height()&&(p.height(p.height()),t._tdHeightDiff=p.height()-y))):u._changeKanbanCursor(h,i,n),t._trigger("cardDrag",e))?!1:!0},dragStop:function(n){t._cardSelect=null;n.dragData=o;n.dragEle=r;u._dragStop(n,i,s)},helper:function(u){return t.model.enableTouch&&!n.isNullOrUndefined(t._cardSelect)&&t._cardSelect=="touch"?!1:(!n.isNullOrUndefined(u.element)&&$(u.element).hasClass("e-draggable")&&(i=n.buildTag("div.e-draggedcard"),i.addClass(t.model.cssClass),r=$(u.element).clone().addClass("dragClone"),$(i).css({width:u.element.width()}),i.append(r),$(i).find("div:first").removeClass("e-hover"),i.appendTo(t.element),f=n.buildTag("div.e-targetclone"),$(f).css({width:u.element.width(),height:u.element.height()})),i)}})},t}();t.DragAndDrop=i;n.createObject("ej.KanbanFeatures.DragAndDrop",i,window)})(t=n.KanbanFeatures||(n.KanbanFeatures={}))})(n||(n={})),function(n){var t;(function(t){var i=function(){function t(n){this.kanbanObj=null;this._dropDownManager=null;this._editForm=null;this.kanbanObj=n}return t.prototype._processEditing=function(){var t=this.kanbanObj,i=this._columnToSelect(),r=this,u;t.model.query._fromTable!=""&&i.from(t.model.query._fromTable);t._dataSource()instanceof n.DataManager&&i.queries.length&&!t._dataManager.dataSource.offline?(u=t._dataSource().executeQuery(i),u.done(n.proxy(function(t){r._dropDownManager=new n.DataManager(t.result);r._addDialogEditingTemplate()}))):r._addDialogEditingTemplate()},t.prototype._renderDialog=function(){return n.buildTag("div.e-dialog e-kanbandialog e-dialog-content e-shadow e-widget-content","",{display:"none"},{id:this.kanbanObj._id+"_dialogEdit"})},t.prototype._columnToSelect=function(){for(var r=[],i=this.kanbanObj,t=0;t<i.model.editSettings.editItems.length;t++)i.model.editSettings.editItems[t].editType=="dropdownedit"&&n.isNullOrUndefined(i.model.editSettings.editItems[t].dataSource)&&r.push(i.model.editSettings.editItems[t].field);return r.length?(new n.Query).select(r):new n.Query},t.prototype.cancelEdit=function(){var n=this.kanbanObj,t;(n.model.editSettings.allowEditing||n.model.editSettings.allowAdding)&&(n.model.editSettings.editMode=="dialog"||n.model.editSettings.editMode=="dialogtemplate"?$("#"+n._id+"_dialogEdit").ejDialog("close"):(n.model.editSettings.editMode=="externalform"||n.model.editSettings.editMode=="externalformtemplate")&&(n.model.editSettings.formPosition=="topright"&&$(n.element).children().css("width","100%"),$("#"+n._id+"_externalEdit").css("display","none")),n.refreshTemplate(),t={requestType:"cancel"},n._processBindings(t))},t.prototype._renderExternalForm=function(){var t=this.kanbanObj,e=n.buildTag("div","",{display:"none"},{id:t._id+"_externalEdit","class":"e-form-container"}),i=n.buildTag("div","","",{id:t._id+"_eFormHeader","class":"e-form-titlebar"}),o=n.buildTag("span","","",{"class":"e-form-title"}),r=n.buildTag("div","","",{id:t._id+"_closebutton","class":"e-externalform-icon"}),s=n.buildTag("span","","",{"class":"e-icon e-externaledit e-cancel"});r.append(s);i.append(o).append(r);var u=n.buildTag("div","","",{id:t._id+"_eFormContent","class":"e-form-content"}),f=n.buildTag("div","","",{id:t._id+"_externalForm","class":"e-externalform"}),h=n.buildTag("div","","",{"class":"e-externalformedit"});return f.append(h),u.append(f),e.append(i).append(u)},t.prototype._maxZindex=function(){var t=1;return t=Math.max.apply(null,$.map($("body *"),function(t){if($(t).css("position")=="absolute")return n.parseInt($(t).css("z-index"))||1})),(t==undefined||t==null)&&(t=1),t},t.prototype.addCard=function(t,i){var r=this.kanbanObj,e,u,s,h,o,f;if(r.model.editSettings.allowAdding)if(u=r.model.fields.primaryKey,t&&i)s=r.model.query,h=s.clone(),$.type(r._currentJsonData[0][u])=="number"&&(t=n.parseInt(t)),e={data:i,requestType:"save",action:"add",primaryKeyValue:t},r._cAddedRecord=i,new n.DataManager(r._currentJsonData).insert(i),r._saveArgs=e,r._updateGroup(e.primaryKeyValue,e.data),r.getContentTable().find("colgroup").first().replaceWith(r._getMetaColGroup()),n.isNullOrUndefined(r.model.fields.swimlaneKey)||(s=s.group(r.model.fields.swimlaneKey),r.model.currentViewData=new n.DataManager(r._currentJsonData).executeLocal(s).result),r._renderAllCard(),r._enableDragandScroll(),r._dataSource()instanceof n.DataManager?r._dataSource().dataSource.json.push(i):r._dataSource(undefined,!0).splice(r._dataSource().length,0,i),r._cAddedRecord=null,r._renderLimit(),r._totalCount(),r._eventBindings(),s.queries=h.queries;else{for(o=r.model.editSettings.editItems,e={requestType:"add"},r._currentData={},r._isAddNewClick&&(r.model.fields.swimlaneKey&&(r._currentData[r.model.fields.swimlaneKey]=$(r._newCard).parent().prev(".e-swimlanerow").find(".e-slkey").text()),r.model.keyField&&(r._currentData[r.model.keyField]=r.model.columns[$(r._newCard).index()].key)),f=0;f<o.length;f++)r._currentData[o[f].field]=n.isNullOrUndefined(o[f].defaultValue)?n.isNullOrUndefined(r._currentData[o[f].field])?"":r._currentData[o[f].field]:o[f].defaultValue;r._currentData[u]=r._currentJsonData[r._currentJsonData.length-1][u];$.type(r._currentJsonData[0][u])=="string"&&(r._currentData[u]=n.parseInt(r._currentData[u]));r._currentData[u]=r._currentData[u]+1;$.type(r._currentJsonData[0][u])=="string"&&(r._currentData[u]=r._currentData[u].toString());e.data=r._currentData;r.element.find(".e-kanbandialog").removeAttr("data-id");r._processBindings(e)}},t.prototype.deleteCard=function(t){var r,i=this.kanbanObj,o,e,s,f,u,h=i.model.fields.primaryKey,i=this.kanbanObj,c;if(o=i.element.find("#"+t),s=new n.DataManager(i._currentJsonData),f=new n.Query,f=f.where(i.model.fields.primaryKey,n.FilterOperators.equal,t),e=s.executeLocal(f),$.type(i._currentJsonData[0][h])=="number"&&(t=n.parseInt(t)),r={div:o,data:e[0],requestType:"delete",primaryKeyValue:t},i._trigger("actionBegin",r))return!0;i._cDeleteData=e;i._dataSource()instanceof n.DataManager&&!i._dataManager.dataSource.offline&&i._dataManager.dataSource.json!==undefined||i._dataSource().adaptor instanceof n.remoteSaveAdaptor?(u=i._dataManager.remove(i.model.fields.primaryKey,t),c=this,$.isFunction(u.promise)?(u.done(function(){i._processBindings(r);i._cDeleteData=null}),u.fail(function(n){r.error=n;i._trigger("actionFailure",r)})):i._processBindings(r)):i._processBindings(r);u!=undefined&&$.isFunction(u.promise)||(i._cDeleteData=null)},t.prototype.startEdit=function(t){var i=this.kanbanObj;if($.type(t)!="object"&&(t=i.element.find("#"+t)),i.model.editSettings.allowEditing&&t.hasClass("e-kanbancard")){var e,r,o=i.model.fields.primaryKey,u=t.attr("id"),h=t.hasClass("e-rowcell")?t.index():t.closest(".e-rowcell").index(),c=i.getIndexByRow(t.closest("tr")),s,f=new n.Query;e=t.closest(".e-kanbancard");s=new n.DataManager(i._currentJsonData);f=f.where(o,n.FilterOperators.equal,t.attr("id"));i._currentData=s.executeLocal(f);!n.isNullOrUndefined(i._cardEditClick)&&i._cardEditClick&&(i._dblArgs.data=i._currentData[0],i._trigger("cardDoubleClick",i._dblArgs));$.type(i._currentJsonData[0][o])=="number"&&(u=n.parseInt(u));r={target:t,rowIndex:c,data:i._currentData[0],columnIndex:h,cardIndex:e.index(),primaryKeyValue:u};i._trigger("beginEdit",r);r.requestType="beginedit";i._processBindings(r)}},t.prototype._refreshEditForm=function(){var t=this.kanbanObj,c,e,y,w,l,s,h,a,u,r,p,v,i,f,o;for(t.model.editSettings.editMode=="dialog"||t.model.editSettings.editMode=="dialogtemplate"?(y=t.element.find("#"+t._id+"_dialogEdit_wrapper"),l=95,y.show(),s=$("#"+t._id+"_dialogEdit"),c=s.find("tr").find(".e-rowcell")):(t.model.editSettings.editMode=="externalform"||t.model.editSettings.editMode=="externalformtemplate")&&(w=t.element.find("#"+t._id+"_externalEdit"),l=133,w.show(),s=$("#"+t._id+"_externalForm"),c=s.find("div").find(".e-rowcell")),h=0;h<c.length;h++)t._tdsOffsetWidth[h]=c.get(h).offsetWidth;for((t.model.editSettings.editMode=="dialog"||t.model.editSettings.editMode=="dialogtemplate")&&(e=n.max(t._tdsOffsetWidth)*(l/100)),a=0;a<t.model.editSettings.editItems.length;a++)u=t.model.editSettings.editItems[a],r=s.find("#"+t._id+"_"+u.field),(t.model.editSettings.editMode=="externalform"||t.model.editSettings.editMode=="externalformtemplate")&&(e=n.max(t._tdsOffsetWidth)*(l/100),$(r).parent().css("width",e+"px")),u.editType=="stringedit"&&r.width(e-4),p=u.editType=="textarea",v=t.model.editSettings.editMode=="dialog"||t.model.editSettings.editMode=="dialogtemplate",u.editType=="textarea"&&(t.model.editSettings.editMode=="dialog"||t.model.editSettings.editMode=="dialogtemplate")?r.width(250).height(95):p&&v&&t.model.editSettings.formPosition=="bottomleft"?(r.height(95),$(r).css({width:"400px"}),$(r).parent().css({width:"500px"})):p&&v&&t.model.editSettings.formPosition=="topright"&&(r.css({width:e-8}),r.height(150),$(r).parent().css("width",e+8)),u.editType=="rteedit"?(i={width:"450px",height:"260px",minHeight:"240px",locale:t.model.locale,enableRTL:t.model.enableRTL},f=u.editParams,i.toolsList=["style","links"],i.tools={style:["bold","italic","underline"],casing:["upperCase","lowerCase"],links:["createLink"]},n.isNullOrUndefined(f)||$.extend(i,f),s.find("#"+t._id+"_"+u.field).ejRTE(i)):u.editType=="dropdownedit"?(i={width:e,enableIncrementalSearch:!0,enableRTL:t.model.enableRTL},o=r.val(),f=u.editParams,r.hasClass("e-disable")&&(i.enabled=!1),n.isNullOrUndefined(f)||$.extend(i,f),r.ejDropDownList(i),r.ejDropDownList("setSelectedValue",r.val())):u.editType=="numericedit"?(i={width:e},o=r.val(),f=u.editParams,i.cssClass=t.model.cssClass,i.showSpinButton=!0,i.enableRTL=t.model.enableRTL,i.locale=t.model.locale,o.length&&(i.value=n.parseFloat(o)),r.hasClass("e-disable")&&(i.enabled=!1),n.isNullOrUndefined(f)||$.extend(i,f),r.ejNumericTextbox(i)):u.editType=="datepicker"?(i={width:e},o=r.val(),f=u.editParams,i.cssClass=t.model.cssClass,i.displayDefaultDate=!0,i.enableRTL=t.model.enableRTL,i.locale=t.model.locale,o.length&&(i.value=new Date(o)),r.hasClass("e-disable")&&(i.enabled=!1),n.isNullOrUndefined(f)||$.extend(i,f),r.ejDatePicker(i)):u.editType=="datetimepicker"&&(i={width:e,cssClass:t.model.cssClass,locale:t.model.locale,showPopupButton:!1,enableRTL:t.model.enableRTL},o=r.val(),f=u.editParams,o.length&&(i.value=new Date(o)),r.hasClass("e-disable")&&(i.enabled=!1),n.isNullOrUndefined(f)||$.extend(i,f),r.ejDateTimePicker(i)),u.editType!="textarea"&&$(r.outerWidth(e)).height(28),n.browserInfo().name=="msie"&&n.parseInt(n.browserInfo().version,10)==8&&r.css("line-height","26px");v&&(t._editForm=t.element.find(".e-externalform"));(t.model.editSettings.editMode=="dialog"||t.model.editSettings.editMode=="dialogtemplate")&&(t._editForm=t.element.find(".kanbanform"),y.hide());this._formFocus()},t.prototype._setKanbanDdlValue=function(t){for(var o,r,u=t.find("select.e-field"),f,e=t.find("input.e-field.e-dropdownlist"),i=0;i<u.length;i++)o={},o[this.kanbanObj._id+"drpDownTempl"]="{{:"+u[i].name.replace(/[^a-z0-9\s]/gi,"")+"}}",$.templates(o),f=$.render[this.kanbanObj._id+"drpDownTempl"](this.kanbanObj._currentData),t.find("select").eq(i).val(f).attr("selected","selected"),u.eq(i).val(f);for(r=0;r<e.length;r++)e.eq(r).val(n.getObject(e.eq(r).attr("name"),this.kanbanObj._currentData[0]))},t.prototype._editAdd=function(t){var o,i=this.kanbanObj,w=i.element.find(".e-kanbandialog"),s=$(t.target),y,a=new n.Query,f=i.model.fields.primaryKey,h=document.createElement("div"),v=$(h),u,e,r,c,l,p;t.requestType=="add"?v.addClass("e-addedrow"):(i._currentData={},s.hasClass("e-kanbancard")?u=s.attr("id"):s.parents(".e-kanbancard").length>0&&(u=s.parents(".e-kanbancard").attr("id")),$.type(i._currentJsonData[0][f])=="number"&&(u=n.parseInt(u)),y=new n.DataManager(i._currentJsonData),a=a.where(f,n.FilterOperators.equal,u),i._currentData=y.executeLocal(a),v.addClass("e-editedrow"));h.innerHTML=$.render[i._id+"_dialogEditingTemplate"](i._currentData);this._setKanbanDdlValue(v);i.model.editSettings.editMode=="dialog"||i.model.editSettings.editMode=="dialogtemplate"?(o=$("#"+i._id+"_dialogEdit"),o.html($(h)),e={cssClass:i.model.cssClass,enableRTL:i.model.enableRTL,width:"auto",content:"#"+i._id,close:$.proxy(this.cancelEdit,this),open:$.proxy(this._onKbnDialogOpen,this),enableModal:!0,enableResize:!1},t.requestType==n.Kanban.Actions.Add?n.isNullOrUndefined(i.model.fields.title)||$.isEmptyObject(i._newData)?e.title=i.localizedLabels.AddFormTitle:(r=i.model.fields.title,e.title=i.localizedLabels.EditFormTitle+i._newData[r]):(r=f,n.isNullOrUndefined(i.model.fields.title)||(r=i.model.fields.title),e.title=i.localizedLabels.EditFormTitle+i._currentData[0][r]),o.ejDialog(e),o.ejDialog("open"),w.attr("data-id",u),l=i.element.find("#"+i._id+"_dialogEdit_wrapper"),l.css("left","0"),p=self!=parent?n.browserInfo().name=="chrome"?$(window).scrollTop():-$(window.frameElement).offset().top:$(window).scrollTop(),l.css("top",p),l.hide()):(i.model.editSettings.editMode=="externalform"||i.model.editSettings.editMode=="externalformtemplate")&&($("#"+i._id+"_externalEdit").css("display","block").css("z-index",this._maxZindex()+1),$("#"+i._id+"_externalForm").find(".e-externalformedit").html($(h).html()),r=f,t.requestType==n.Kanban.Actions.Add?n.isNullOrUndefined(i.model.fields.title)||$.isEmptyObject(i._newData)?c=i.localizedLabels.AddFormTitle:(r=i.model.fields.title,c=i.localizedLabels.EditFormTitle+i._newData[r]):(r=f,n.isNullOrUndefined(i.model.fields.title)||(r=i.model.fields.title),c=i.localizedLabels.EditFormTitle+i._currentData[0][r]),$("#"+i._id+"_eFormHeader").find(".e-form-title").text(c),$("#"+i._id+"_externalForm").attr("data-id",u),this._externalFormPosition());this.initValidator();this.setValidation()},t.prototype._onKbnDialogOpen=function(){var f=this.kanbanObj,n=f.element.find("#"+f._id+"_dialogEdit_wrapper"),t,i,e,r,u,o,s;n.css("position","absolute");e=$(f.element)[0];r=e.offsetTop;u=e.offsetLeft;o=e.offsetWidth;s=e.offsetHeight;window.pageYOffset>r?(t=r+s>window.pageYOffset+window.innerHeight?Math.max(0,(window.innerHeight-n.outerHeight())/2):Math.max(0,(r+s-window.pageYOffset-n.outerHeight())/2),t=window.pageYOffset+t):(t=r+s>window.pageYOffset+window.innerHeight?Math.max(0,(window.innerHeight-(r-window.pageYOffset)-n.outerHeight())/2):Math.max(0,(s-n.outerHeight())/2),t=r+t);window.pageXOffset>u?(i=u+o>window.pageXOffset+window.innerWidth?Math.max(0,(window.innerWidth-n.outerWidth())/2):Math.max(0,(u+o-window.pageXOffset-n.outerWidth())/2),i=window.pageXOffset+i):(i=u+o>window.pageXOffset+window.innerWidth?Math.max(0,(window.innerWidth-(u-window.pageXOffset)-n.outerWidth())/2):Math.max(0,(o-n.outerWidth())/2),i=u+i);n.css("top",t+"px");n.css("left",i+"px");n.show();this._formFocus();f._editForm.find(".e-rte").length>0&&f.element.find("#"+f._id+"_dialogEdit").data("ejDialog")._resetScroller()},t.prototype._externalFormPosition=function(){var n=this.kanbanObj,t=$(n.element).offset(),r=$(n.element).width(),u=$(n.element).height(),i=$("#"+n._id+"_externalEdit");switch(n.model.editSettings.formPosition){case"topright":$(i).find(".e-close").removeClass("e-bottomleft").addClass("e-topright");$("#"+n._id+"_eFormContent").height("auto");n.model.allowScrolling||n.model.isResponsive?($(i).css({left:t.left+r+2+"px",top:t.top+"px",position:"absolute",width:"25%"}),$(".e-externalrow").css("padding-right","0px")):($(n.element).css({width:"100%"}),$(n.element).children().not(".e-form-container").css("width","73%"),$(i).css({left:t.left+$(n.element).children().width()+2+"px",top:t.top+"px",position:"absolute",width:"25%"}));break;case"bottomleft":$(i).find(".e-close").removeClass("e-topright").addClass("e-bottomleft");$(i).css({left:t.left+"px",top:t.top+u+1+"px"});$("#"+n._id+"_eFormContent").width("100%");(n.element.find(".e-scrollbar").hasClass("e-hscrollbar")||n.model.isResponsive)&&$("#"+n._id+"_externalEdit").css({border:"none","border-top":"1px solid"})}},t.prototype._formFocus=function(){for(var n,i=$(this.kanbanObj._editForm).find("input,select,div.e-field,textarea.e-field"),r=!1,t=0;t<i.length;t++)n=i.eq(t),(n.is(":disabled")||r||n.is(":hidden")&&typeof(n.data("ejDropDownList")||n.data("ejNumericTextbox"))!="object")&&!n.hasClass("e-rte")||(this._focusKbnDialogEle(n),r=!0)},t.prototype._focusKbnDialogEle=function(n){if(n.length)if((n[0].tagName.toLowerCase()!="select"||n.hasClass("e-field e-dropdownlist"))&&n[0].tagName.toLowerCase()!="input"&&(n[0].tagName.toLowerCase()!="textarea"||n.hasClass("e-numerictextbox")))n.hasClass("e-field e-dropdownlist")?n.closest(".e-ddl").focus():n.hasClass("e-numerictextbox")?n.siblings("input:visible").first().select().focus():n.find("input:visible,select").first().select().focus();else if(n.hasClass("e-rte")){var t=n.data("ejRTE");$(t).focus();t.selectAll()}else n.focus().select(),n[0].focus()},t.prototype.endEdit=function(){var t=this.kanbanObj,f,l,i,a,v,r,e,u,o,s,h,y,c;if(t.model.editSettings.allowEditing||t.model.editSettings.allowAdding){if(f=t.model.fields.primaryKey,l=t.model.editSettings.editMode=="dialog"||t.model.editSettings.editMode=="dialogtemplate"?t.element.find(".e-kanbandialog"):t.element.find(".e-externalform"),e={},!this.editFormValidate())return!0;for(i=document.getElementById(t._id+"EditForm"),a=$(i),v=a.closest("div"),n.isNullOrUndefined(l.attr("data-id"))?(r=t._currentJsonData[t._currentJsonData.length-1][f],$.type(t._currentJsonData[0][f])=="string"&&(r=n.parseInt(r)),r=r+1,$.type(t._currentJsonData[0][f])=="string"&&(r=r.toString()),e[f]=r):(r=l.attr("data-id"),$.type(t._currentJsonData[0][f])=="number"&&(r=n.parseInt(r))),u=0;u<i.length;u++)if(!v.hasClass("e-addedrow")||!$(i[u]).hasClass("e-identity")){if(o=i[u].name,s=$(i[u]),s.hasClass("e-dropdownlist e-input")&&s.attr("id").indexOf("_input")!=-1||s.hasClass("e-dropdownlist")&&s.is(":hidden")){!n.isNullOrUndefined(a[1])&&n.isNullOrUndefined(i[u+1])&&(i=a[1],u=-1);continue}o!=undefined&&(o==""&&(i[u].id.indexOf("Save")!=-1||i[u].id.indexOf("Cancel")!=-1?o="":(o=i[u].id.replace(t._id+"_",""),o=o.replace("_hidden",""))),o!=""&&e[o]==null?(h=i[u].value,$(i[u]).hasClass("e-datepicker")?h=s.ejDatePicker("model.value"):$(i[u]).hasClass("e-datetimepicker")?h=s.ejDateTimePicker("model.value"):s.is(".e-numerictextbox")?(h=s.ejNumericTextbox("getValue"),h=h||""):s.data("ejDropDownList")&&(h=s.ejDropDownList("getSelectedValue")),y=i[u].type!="checkbox"?h:$(i[u]).is(":checked"),e[o]=y):o==f&&(e[f]=i[u].value))}if(t._editForm=t.element.find(".kanbanform"),e[f]=isNaN(e[f])?r:$.type(t._currentJsonData[0][f])=="number"?r=n.parseInt(e[f]):r=e[f],c={data:e,requestType:"save"},t._trigger("actionBegin",c))return!0;$(t._editForm).hasClass("e-formdestroy")?t.refresh(!0):n.isNullOrUndefined(l.attr("data-id"))?(c.action=n.Kanban.Actions.Add,c.primaryKeyValue=r,t._cAddedRecord=e):(c.action="edit",c.primaryKeyValue=r,t._cModifiedData=e);c.primaryKey=f;t._saveArgs=c;t.updateCard(r,e);t.model.editSettings.editMode=="dialog"||t.model.editSettings.editMode=="dialogtemplate"?(t.element.find(".e-kanbandialog").removeAttr("data-id"),$("#"+t._id+"_dialogEdit").ejDialog("close")):(t.model.editSettings.editMode=="externalform"||t.model.editSettings.editMode=="externalformtemplate")&&(t.model.editSettings.formPosition=="topright"&&$(t.element).children().css("width","100%"),l.removeAttr("data-id"),$("#"+t._id+"_externalEdit").css("display","none"))}},t.prototype.initValidator=function(){for(var t=this.kanbanObj,r=t.element.find(".kanbanform"),i=0;i<r.length;i++)r.eq(i).validate({ignore:".e-hide,:hidden",errorClass:"e-field-validation-error",errorElement:"div",wrapper:"div",errorPlacement:function(i,r){r.is(":hidden")&&(r=r.siblings("input:visible"));var f=r.closest("td"),u=$(i).addClass("e-error"),e=n.buildTag("div.e-errortail e-toparrow");t.model.editSettings.editMode!="dialog"&&f.find(".e-error").remove();r.parent().hasClass("e-in-wrap")?u.insertAfter(r.closest(".e-widget")):u.insertAfter(r);u.prepend(e);t.model.enableRTL?t.model.editSettings.editMode!="dialog"&&u.offset({left:r.offset().left,top:r.offset().top+r.height()}):t.model.editSettings.editMode!="dialog"&&u.offset({left:r.offset().left,top:r.offset().top+r.height()});u.fadeIn("slow")}})},t.prototype.setValidation=function(){for(var i=this.kanbanObj,t=0;t<i.model.editSettings.editItems.length;t++)n.isNullOrUndefined(i.model.editSettings.editItems[t].validationRules)||this.setValidationToField(i.model.editSettings.editItems[t].field,i.model.editSettings.editItems[t].validationRules)},t.prototype.setValidationToField=function(t,i){var r=t,f,u,e=this.kanbanObj,o,s;n.isNullOrUndefined(t)||(r=r.replace(/[^a-z0-9\s_]/gi,""));o=e.element.find(".kanbanform");f=o.find("#"+e._id+"_"+r).length>0?o.find("#"+e._id+"_"+r):o.find("#"+r);f.attr("name")||f.attr("name",t);f.rules(n.Kanban.Actions.Add,i);s=e.element.find(".kanbanform").validate();s.settings.messages[t]=s.settings.messages[t]||{};n.isNullOrUndefined(i.required)||(u=n.isNullOrUndefined(i.messages&&i.messages.required)?$.validator.messages.required:i.messages.required,u.indexOf("This field")==0&&(u=u.replace("This field",t)),s.settings.messages[t].required=u)},t.prototype.editFormValidate=function(){return $.isFunction($.validator)?this.kanbanObj.element.find(".kanbanform").validate().form():!0},t.prototype._addDialogEditingTemplate=function(){var t=this.kanbanObj,h=n.buildTag("div"),f,p,e,w,u,b,k,o,d,c,l,r,i,a,it,g,rt,nt,v,y,ut,s,tt;if(t.model.columns.length!=0){if(f=n.buildTag("form.kanbanform","",{},{id:t._id+"EditForm"}),p=n.buildTag("table","",{},{cellspacing:"14px"}),n.isNullOrUndefined(t.model.editSettings.editMode)&&(t.model.editSettings.editMode="dialog"),t.model.editSettings.editMode=="dialog"||t.model.editSettings.editMode=="externalform")for(l=0;l<t.model.editSettings.editItems.length;l++){r=t.model.editSettings.editItems[l];i=r.field;t.model.editSettings.editMode=="dialog"?(d="tr",c="td"):(d="div.e-externalrow",c="div");e=n.buildTag(d);w=n.buildTag(c,"",{"text-align":"right"}).addClass("e-label");u=n.buildTag(c,"",{"text-align":"left"}).addClass("e-rowcell");e.append(w.get(0)).append(u.get(0));w.append("<label style='text-transform:capitalize' for='"+i+"'>"+i+"<\/label>");t.model.editSettings.editMode==n.Kanban.EditMode.ExternalForm&&t.model.editSettings.formPosition==n.Kanban.FormPosition.TopRight&&e.css({width:"300px","padding-right":"0px"});n.isNullOrUndefined(r.editType)&&(r.editType="stringedit");n.isNullOrUndefined(i)||(i=i.replace(/[^a-z0-9\s_]/gi,""));switch(r.editType){case"stringedit":t.model.fields.primaryKey==i?u.html(n.buildTag("input.e-field e-ejinputtext e-disable","",{},{value:"{{html:#data['"+i+"']}}",id:t._id+"_"+i,name:i,disabled:"disabled"})):u.html(n.buildTag("input.e-field e-ejinputtext","",{},{value:"{{html:#data['"+i+"']}}",id:t._id+"_"+i,name:i}));break;case"numericedit":u.html(n.buildTag("input.e-numerictextbox e-field","",{},{type:"text",value:"{{:#data['"+i+"']}}",id:t._id+"_"+i,name:i}));break;case"dropdownedit":if(a=[],n.isNullOrUndefined(r.dataSource))for(y=(new n.Query).where(n.Predicate.or(t.keyPredicates)).select(r.field),n.isNullOrUndefined(this._dropDownManager)||!t._dataManager.dataSource.offline&&t._dataManager.dataSource.json.length?nt=t._dataManager.executeLocal(y):(t._dataManager.adaptor instanceof n.JsonAdaptor&&r.field.indexOf(".")!=-1&&(ut=r.field.replace(/\./g,n.pvt.consts.complexPropertyMerge),y=(new n.Query).select(ut)),nt=this._dropDownManager.executeLocal(y)),v=n.dataUtil.mergeSort(n.dataUtil.distinct(nt)),s=0;s<v.length;s++)a.push({text:v[s],value:v[s]});else a=r.dataSource;g=n.buildTag("select");rt=n.buildTag("option","{{:text}}",{},{value:"{{html:#data['value']}}"});g.append(rt);it=$.templates(g.html());u.get(0).innerHTML=n.isNullOrUndefined(r.editParams)||n.isNullOrUndefined(r.dataSource)?["<select>",it.render(a),"<\/select>"].join(""):"<input>";u.find("select,input").prop({id:t._id+"_"+i,name:i}).addClass("e-field e-dropdownlist");break;case"rteedit":u.html(n.buildTag("textarea.e-field e-rte","{{html:#data['"+i+"']}}",{},{id:t._id+"_"+i,name:i}));break;case"textarea":u.html(n.buildTag("textarea.e-field e-kanbantextarea e-ejinputtext","{{html:#data['"+i+"']}}",{},{id:t._id+"_"+i,name:i}));break;case"datepicker":case"datetimepicker":u.html(n.buildTag("input.e-"+r.editType+" e-field","",{},{type:"text",value:"{{:#data['"+i+"']}}",id:t._id+"_"+i,name:i}))}t.model.editSettings.editMode=="dialog"?(f.append(p),p.append(e)):f.append(e);f.appendTo(h)}else t.model.editSettings.editMode=="dialogtemplate"&&t.model.editSettings.dialogTemplate!=null&&(tt=t.model.editSettings.dialogTemplate),t.model.editSettings.editMode=="externalformtemplate"&&t.model.editSettings.externalFormTemplate!=null&&(tt=t.model.editSettings.externalFormTemplate),f.html($(tt).html()),f.appendTo(h);b=n.buildTag("input.e-save","",{},{type:"button",id:t._id+"_Save"});b.ejButton({text:t.localizedLabels.SaveButton,width:"100"});k=t.model.editSettings.formPosition!="topright"?n.buildTag("input.e-cancel","",{"margin-left":"15px","margin-right":"13px"},{type:"button",id:t._id+"_Cancel"}):n.buildTag("input.e-cancel","",{"margin-left":"15px","margin-right":"8px"},{type:"button",id:t._id+"_Cancel"});k.ejButton({text:t.localizedLabels.CancelButton,width:"100"});o=t.model.editSettings.editMode!="dialog"&&t.model.editSettings.editMode!="dialogtemplate"?n.buildTag("div","","",{"class":"e-editform-btn"}):n.buildTag("div#"+t._id+"_EditBtnDiv","",{},{"class":"e-kanban-editdiv"});o.append(b);o.append(k);t.model.editSettings.editMode!="dialog"&&t.model.editSettings.editMode!="dialogtemplate"?o.appendTo(h):f.append(o);$.templates(t._id+"_dialogEditingTemplate",h.html())}},t}();t.Edit=i;n.createObject("ej.KanbanFeatures.Edit",i,window)})(t=n.KanbanFeatures||(n.KanbanFeatures={}))}(n||(n={}));t=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var i=function(i){function r(t,r){return i.call(this),this.element=null,this.PluginName="ejKanban",this.id="null",this.validTags=["div"],this.observables=["dataSource"],this._tags=[{tag:"columns",attr:["headerTemplate","headerText","key","isCollapsed","showAddButton","visible","constraints.type","constraints.min","constraints.max"]},{tag:"stackedHeaderRows",attr:[[{tag:"stackedHeaderColumns",attr:["headerText","column"]}]]},{tag:"contextMenuSettings",attr:["customMenuItems","menuItems","disableDefaultItems"]},{tag:"filterSettings",attr:["text","query","description"]},{tag:"editSettings.editItems",attr:["field","editType","validationRules","editParams","defaultValue"]}],this.localizedLabels=null,this.currentViewData=null,this.keyConfigs={focus:"e",insertCard:"45",deleteCard:"46",editCard:"113",saveRequest:"13",cancelRequest:"27",firstCardSelection:"36",lastCardSelection:"35",upArrow:"38",downArrow:"40",rightArrow:"39",leftArrow:"37",swimlaneExpandAll:"ctrl+40",swimlaneCollapseAll:"ctrl+38",selectedSwimlaneExpand:"alt+40",selectedSwimlaneCollapse:"alt+38",selectedColumnCollapse:"ctrl+37",selectedColumnExpand:"ctrl+39",multiSelectionByUpArrow:"shift+38",multiSelectionByDownArrow:"shift+40",multiSelectionByLeftArrow:"shift+37",multiSelectionByRightArrow:"shift+39"},this.dataTypes={dataSource:"data",query:"data",columns:"array",stackedHeaderRows:"array",contextMenuSettings:{disableDefaultItems:"array",menuItems:"array",customMenuItems:"array"},filterSettings:"array",editSettings:{editMode:"enum",editItems:"array"},searchSettings:{fields:"array"}},this.defaults={dataSource:null,keyField:null,keySettings:null,allowTitle:!1,cssClass:"",allowSelection:!0,selectionType:"single",allowKeyboardNavigation:!1,allowDragAndDrop:!0,allowHover:!0,allowScrolling:!1,enableRTL:!1,stackedHeaderRows:[],filterSettings:[],scrollSettings:{width:"auto",height:0,allowFreezeSwimlane:!1},swimlaneSettings:{showCount:!0},fields:{content:null,tag:null,color:null,imageUrl:null,swimlaneKey:null,primaryKey:null,priority:null},cardSettings:{colorMapping:{},template:null},columns:[],contextMenuSettings:{enable:!1,menuItems:[{menuItem:"Add Card"},{menuItem:"Edit Card"},{menuItem:"Delete Card"},{menuItem:"Top of Row"},{menuItem:"Bottom of Row"},{menuItem:"Move Up"},{menuItem:"Move Down"},{menuItem:"Move Left"},{menuItem:"Move Right"},{menuItem:"Move Swimlane"},{menuItem:"Hide Column"},{menuItem:"Visible Columns"}],customMenuItems:[]},editSettings:{editItems:[],allowEditing:!1,allowAdding:!1,dialogTemplate:null,externalFormTemplate:null,formPosition:"bottomleft"},searchSettings:{fields:[],key:"",operator:"contains",ignoreCase:!0},tooltipSettings:{enable:!1,template:null},locale:"en-US",query:null,create:null,actionBegin:null,actionComplete:null,actionFailure:null,load:null,destroy:null,beginEdit:null,endEdit:null,endAdd:null,endDelete:null,beforeCardSelect:null,cardSelect:null,toolbarClick:null,cardDoubleClick:null,cardDragStart:null,cardDrag:null,cardDragStop:null,cardDrop:null},this._dataSource=n.util.valueFunction("dataSource"),this._rootCSS="e-kanban",this._requiresID=!0,this._id=null,this.KanbanDragAndDrop=null,this.KanbanEdit=null,this._currentJsonData=null,this._kanbanRows=null,this._columnRows=null,this._swimlaneRows=null,this._filterToolBar=null,this._filteredRecordsCount=0,this._filteredRecords=null,this._contexttarget=null,this._editForm=null,this._newData=null,this._isAddNew=!1,this._isRemoteSaveAdaptor=!1,this._queryPromise=null,this._kanbanWidth=null,this.keyPredicates=null,this._cloneQuery=null,this._isLocalData=!0,this._previousRowCellIndex=[],this.selectedRowCellIndexes=[],this._bulkUpdateData=[],this._cardSelect=null,this._conmenu=null,this._rowIndexesColl=[],this.templates={},this.initialRender=!1,this._columnsWidthCollection=[],this._slTemplate="",this._cardTemplate="",this._tdsOffsetWidth=[],this._scrollObject=null,this._templateRefresh=!1,this._action="",this._hiddenColumns=[],this._visibleColumns=[],this._filterCollection=[],this.collapsedColumns=null,this._expandedColumns=null,this._headerColumnNames=null,this._isWatermark=null,this._searchInput=null,this._hiddenSpan=null,this._currentRowCellIndex=[],this._recordsCount=0,this._selectedCards=[],this._selectedCardData=[],this._tableBEle=null,this._saveArgs=null,this._cModifiedData=null,this._dropped=null,this._cAddedRecord=null,this._cDeleteData=null,this._isAddNewClick=!1,this._currentData=null,this._newCard=null,this._cardEditClick=null,this._collapsedCards=[],this._dblArgs=null,this._freezeSwimlaneRow={},this._freezeScrollTop=0,this._freezeSlOrder=0,this._originalWidth=null,this._originalScrollWidth=0,this._collapsedColumns=[],this._enableMultiTouch=!1,this._enableSwimlaneCount=!0,this._kTouchBar=null,this._initialData=null,this._searchBar=null,this._originalScrollHeight=null,this._dataManager=null,t&&(this._id=t[0].id,t.jquery||(t=$("#"+t)),t.length)?$(t).ejKanban(r).data(this.PluginName):void 0}return t(r,i),r.prototype.getHeaderTable=function(){return this.headerTable},r.prototype.setHeaderTable=function(n){this.headerTable=n},r.prototype.getColumnByHeaderText=function(n){for(var i=this.model.columns,t=0;t<i.length;t++)if(i[t].headerText==n)break;return t==i.length?null:i[t]},r.prototype._destroy=function(){var r,t,u,i;if(this.element.off(),this.element.find(".e-kanbanheader").find(".e-headercontent").add(this.getContent().find(".e-content")).unbind("scroll"),n.isNullOrUndefined(this._filterToolBar)||this._filterToolBar.ejToolbar("destroy"),!n.isNullOrUndefined(this._editForm)){for(r=this._editForm.find(".e-field"),i=0;i<r.length;i++)t=$(r[i]),t.hasClass("e-ejinputtext")&&this.element.find(".e-ejinputtext").remove(),t.hasClass("e-kanbantextarea")&&this.element.find(".e-kanbantextarea").remove(),t.hasClass("e-dropdownlist")&&t.ejDropDownList("destroy"),t.hasClass("e-numerictextbox")&&t.ejNumericTextbox("destroy"),u=t.parent("div").find("textarea.e-rte"),u.length&&(u.ejRTE("destroy"),t.parent().find("textarea").remove());$("#"+this._id+"_dialogEdit").ejDialog("destroy")}this.element.ejWaitingPopup("destroy");this.model.contextMenuSettings.enable&&($("#"+this._id+"_Context").ejMenu("destroy"),$("#"+this._id+"_Context").remove());this.element.children().remove()},r.prototype._kbnTouchClick=function(n){this.model.selectionType=="multiple"&&this._kTouchBar.is(":visible")&&!$(n.target).hasClass("e-cardselection")&&$(n.target).parents(".e-cardselection").length<=0&&!$(n.target).hasClass("e-cardtouch")&&$(n.target).parents(".e-cardtouch").length<=0&&!this._kTouchBar.find(".e-cardtouch").hasClass("e-spanclicked")&&this._kTouchBar.hide();n.type=="touchstart"&&(this._cardSelect="touch")},r.prototype._kbnHoldHandler=function(){this.model.enableTouch&&(this._cardSelect="hold")},r.prototype.showColumns=function(n){var t,i="_visibleColumns";t=typeof n=="string"?this.getColumnByHeaderText(n):this.getColumnByHeaderText(n[0]);this._showExpandColumns(t,n,"_hiddenColumns",i);this._showhide(this[i],"show");this._renderLimit();this._totalCount();this.model.stackedHeaderRows.length>0&&this._refreshStackedHeader()},r.prototype._showhide=function(t,i){var r,y=0,h,e=this.model.columns,o,u,s;h=i==="show"?"_visibleColumns":"_hiddenColumns";var p=this.getHeaderTable().find("thead"),c=p.find("tr").not(".e-stackedHeaderRow").find(".e-headercell"),l=this.getHeaderTable().find("colgroup").find("col"),a,v=this.getContentTable().find("colgroup").find("col"),f=this._columnRows;for(r=0;r<e.length;r++)$.inArray(e[r].headerText,this[h])!=-1&&(e[r].visible=i==="show"?!0:!1,y++),a=this.getColumnByHeaderText(t[r]),o=$.inArray(a,this.model.columns),o!=-1&&(i=="show"?(c.eq(o).removeClass("e-hide"),l.eq(o).css("display","")):(c.eq(o).addClass("e-hide"),l.eq(o).css("display","none")));for(r=0;r<e.length;r++)for(u=0;u<f.length;u++)n.isNullOrUndefined(this.model.fields.swimlaneKey)||($(f[u]).is(":visible")?f.eq(u).prev().find(".e-rowcell").attr("colspan",this.getVisibleColumnNames().length):(f.eq(u).prev().prev(".e-swimlanerow").find(".e-rowcell").attr("colspan",this.getVisibleColumnNames().length),e[r].visible?f.eq(u).prev(".e-collapsedrow").find("td.e-rowcell").eq(r).removeClass("e-hide"):f.eq(u).prev(".e-collapsedrow").find("td.e-rowcell").eq(r).addClass("e-hide"))),s=f.eq(u).find("td.e-rowcell[ej-mappingkey='"+this.model.columns[r].key+"']"),e[r].visible?(s.removeClass("e-hide"),v.eq(r).removeClass("e-hide")):(s.addClass("e-hide"),v.eq(r).addClass("e-hide"))},r.prototype.searchCards=function(n){var i,t=$("#"+this._id+"_toolbarItems_search");t.find("input").val()!=n&&t.find("input").val(n);i={requestType:"search",keyValue:n};(n!=""||this.model.searchSettings.key!="")&&(this.model.searchSettings.key=n,t.find(".e-searchfind").length>0&&(this._initialData=this._currentJsonData),this._processBindings(i))},r.prototype.clearSearch=function(){this.element.find(".e-kanbantoolbar #"+this._id+"_toolbarItems_search").val("");this.searchCards("");$.extend(this.model.searchSettings,this.defaults.searchSettings)},r.prototype._onToolbarClick=function(n){var h=$(this.itemsContainer).closest(".e-kanban"),t=h.ejKanban("instance"),i=n.currentTarget,r=n.target,o,f,s,e,u;if((r.tagName=="INPUT"&&(n.keyCode==13||$(r).parent().next().hasClass("e-cancel"))&&(n.keyCode==13&&$(r).val()!=""?(this.searchCards($(r).val()),u=this._searchBar.find(".e-toolbaricons"),u.removeClass("e-searchfind").addClass("e-cancel")):$(r).val().length==0&&(this.clearSearch(),u=this._searchBar.find(".e-toolbaricons"),u.removeClass("e-cancel").addClass("e-searchfind"))),n.event==undefined)||$(i).hasClass("e-quickfilter"))return!1;for(o=$(i).text(),f=0;f<t.model.filterSettings.length;f++)if(t.model.filterSettings[f].text==o)break;return(s=f==t.model.filterSettings.length?null:t.model.filterSettings[f],e={itemName:i.title,itemId:i.id,target:r,currentTarget:i,itemIndex:$(i).index(),toolbarData:n,itemText:o,model:t.model,cancel:!1,type:"toolbarClick"},t._trigger("toolbarClick",e))?!1:(e.itemId==this._id+"_search"?(e.target.nodeName=="A"&&(t.searchCards($(e.currentTarget).find("input").val()),t.model.allowSearching&&t._searchBar!=null&&t.model.searchSettings.key.length!=0&&(u=t._searchBar.find(".e-toolbaricons"),$(r).is(t._searchBar.find(".e-searchfind"))?u.removeClass("e-searchfind").addClass("e-cancel"):$(r).is(t._searchBar.find(".e-cancel"))&&(u.removeClass("e-cancel").addClass("e-searchfind"),t["clearSearch()"]))),t._isWatermark||(t._searchInput.blur(function(){t._searchInput.val()||t._hiddenSpan.css("display","block")}),t._hiddenSpan.css("display","none"))):$(i).parent().hasClass("e-customtoolbar")||t._filterHandler(s,i),!1)},r.prototype._filterHandler=function(t,i){var r={requestType:"filtering",currentFilterObject:[],filterCollection:this._filterCollection},u,f,e;for(r.currentFilterObject.push(t),this._initialData=this._currentJsonData,u=0;u<this.model.filterSettings.length;u++)if(this.model.filterSettings[u].text==r.currentFilterObject[0].text){f=this.model.filterSettings[u].query.queries[0].e;n.isNullOrUndefined(r.filterCollection[0])?(r.filterCollection.push(f),$(i).addClass("e-select")):$(i).hasClass("e-select")?($(i).removeClass("e-select"),e=$.inArray(f,r.filterCollection),r.filterCollection.splice(e,1)):($(i).addClass("e-select"),r.filterCollection.push(f));break}this._processBindings(r)},r.prototype.filterCards=function(n){var t={requestType:"filtering",filterCollection:this._filterCollection},n=n.queries[0].e;t.filterCollection.push(n);this._processBindings(t)},r.prototype.clearFilter=function(){if(this._filterCollection.length!=0)this._filterCollection=[],this.element.find(".e-kanbantoolbar .e-tooltxt").removeClass("e-select"),this._processBindings({requestType:"filtering"})},r.prototype._wireEvents=function(){this._on(this.element,$.isFunction($.fn.tap)&&this.model.enableTouch?"tap":"click","",this._clickHandler);this._on($("#"+this._id+"_searchbar"),"keyup","",this._onToolbarClick);this._on(this.element,"taphold","",this._kbnHoldHandler);this._on($(document),"click touchstart","",this._kbnTouchClick);this.KanbanEdit&&this._enableEditingEvents();this._enableCardHover();this.model.tooltipSettings.enable&&(this._on(this.element,"mouseover",".e-kanbancard",this._showToolTip),this._on(this.element,"mouseout",".e-kanbancard",this._hideToolTip));this.model.allowKeyboardNavigation&&(this.element[0].tabIndex=this.element[0].tabIndex==-1?0:this.element[0].tabIndex,this.element[0].accessKey=!n.isNullOrUndefined(this.element[0].accessKey)&&this.element[0].accessKey!=""?this.element[0].accessKey:"e",this._on(this.element,"keyup","",this._keyPressed));this._enableCardHover()},r.prototype._enableEditingEvents=function(){this.model.editSettings.allowEditing?this._on(this.element,"dblclick doubletap",".e-kanbancard",this._cardDblClickHandler):this._off(this.element,"dblclick doubletap",".e-kanbancard");this.model.editSettings.allowAdding?this._on(this.element,"dblclick",".e-kanbancontent .e-columnrow .e-rowcell",this._cellDblClickHandler):this._off(this.element,"dblclick",".e-kanbancontent .e-columnrow .e-rowcell");this.model.editSettings.allowEditing||this.model.editSettings.allowAdding?this._on($("#"+this._id+"_dialogEdit"),"click keypress","#EditDialog_"+this._id+"_Save ,#EditDialog_"+this._id+"_Cancel",this._clickHandler):this._off($("#"+this._id+"_dialogEdit"),"click","#EditDialog_"+this._id+"_Save ,#EditDialog_"+this._id+"_Cancel")},r.prototype._cardDblClickHandler=function(n){this._cardEditClick=!0;this._dblArgs=n;this.KanbanEdit.startEdit($(n.target).closest(".e-kanbancard"))},r.prototype._cellDblClickHandler=function(n){$(n.target).hasClass("e-rowcell")&&(this._isAddNewClick=!0,this._newCard=$(n.target),this.KanbanEdit.addCard())},r.prototype._enableCardHover=function(){this.model.allowHover?this._on(this.element,"mouseenter mouseleave",".e-columnrow .e-kanbancard",this._cardHover):this._off(this.element,"mouseenter mouseleave",".e-columnrow .e-kanbancard")},r.prototype._showToolTip=function(t){var o,s,f,e;if(this.model.tooltipSettings.enable){if($(t.target).hasClass("e-kanbantooltip"))return;if(f=this.element.find(".e-kanbantooltip"),e=n.isNullOrUndefined(this.model.tooltipSettings.template),e&&!($(t.target).hasClass("e-tag")||$(t.target).hasClass("e-text")||$(t.target).closest(".e-primarykey").length>0))return;e?f.html($(t.target).text()).removeClass("e-tooltiptemplate"):(f.addClass("e-tooltiptemplate"),s=new n.DataManager(this._currentJsonData),o=s.executeLocal((new n.Query).where(this.model.fields.primaryKey,n.FilterOperators.equal,$(t.currentTarget).attr("id"))),f.html($(this.model.tooltipSettings.template).render(o[0])));var r=t.pageX,u=t.pageY,i=$(this.element).find(".e-kanbantooltip");r=r+i.width()<$(this.element).width()?r:r-i.width();u=u+i.height()<$(this.element).height()?u:u-i.height();i.css("left",r);i.css("top",u);this.model.enableRTL==!0&&i.addClass("e-rtl");$(this.element).find(".e-kanbantooltip").show()}},r.prototype._hideToolTip=function(){this.model.tooltipSettings.enable&&this.element.find(".e-kanbantooltip").hide()},r.prototype.expandAll=function(){var t=this.element.find(".e-swimlanerow .e-slcollapse"),n;if(t.length!=0)for(n=0;n<t.length;n++)this.toggleSwimlane($(t[n]))},r.prototype.collapseAll=function(){var t=this.element.find(".e-swimlanerow .e-slexpand"),n;if(t.length!=0)for(n=0;n<t.length;n++)this.toggleSwimlane($(t[n]))},r.prototype._moveCurrentCard=function(t,i,r){var h,u,e,f,s,c,b,l,y,p,k,a,v,w,o;if(u=this.selectedRowCellIndexes[0],a=u.cardIndex,h=u.cellIndex[u.cellIndex.length-1],i=="down"||i=="up"){if(k=$(this._columnRows[t]).find("td.e-rowcell").eq(h),s=k.find(".e-kanbancard"),f=$(s).index(k.find(".e-cardselection")),l=s.length,i=="down")if(n.isNullOrUndefined(this.model.fields.swimlaneKey)?f=this.model.selectionType=="multiple"?a[u.cellIndex.length-1][a[u.cellIndex.length-1].length-1]:a[u.cellIndex.length-1]:(r.shiftKey||r.ctrlKey)&&this.model.selectionType=="multiple"&&(f=a[u.cellIndex.length-1][a[u.cellIndex.length-1].length-1]),f==l-1||l==0){if(t==this._columnRows.length-1)return;if((r.shiftKey||r.ctrlKey)&&this.model.selectionType!="single")return;this._moveCurrentCard(t+1,i,r)}else s.eq(f+1).hasClass("e-cardselection")?this._cardSelection([[t,[h],[f]]],$(s[f]),r):this._cardSelection([[t,[h],[f+1]]],$(s[f+1]),r);else if(i=="up")if(n.isNullOrUndefined(this.model.fields.swimlaneKey)?f=this.model.selectionType=="multiple"?u.cardIndex[u.cellIndex.length-1][u.cardIndex[u.cellIndex.length-1].length-1]:u.cardIndex[u.cellIndex.length-1]:(r.shiftKey||r.ctrlKey)&&this.model.selectionType=="multiple"&&(f=u.cardIndex[u.cellIndex.length-1][u.cardIndex[u.cellIndex.length-1].length-1]),l==0||f==0){if(t==0)return;if((r.shiftKey||r.ctrlKey)&&this.model.selectionType!="single")return;this._moveCurrentCard(t-1,i,r)}else s.eq(f-1).hasClass("e-cardselection")?this._cardSelection([[t,[h],[f]]],$(s[f]),r):f!=-1?this._cardSelection([[t,[h],[f-1]]],$(s[f-1]),r):this._cardSelection([[t,[h],[l-1]]],$(s[l-1]),r);(r.shiftKey||r.ctrlKey)&&!1||this.element.find(".e-cardselection").closest("tr.e-columnrow:visible").length==0&&this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().prev(".e-swimlanerow").find(".e-slcollapse"))}else if(b=$(this._columnRows[u.rowIndex]),c=b.find("td.e-rowcell"),s=c.eq(t).find(".e-kanbancard"),e=c.eq(t).find(".e-kanbancard"),y=c.eq(t+1),p=c.eq(t-1),v=this.element.find(".e-kanbancard"),w=this.element.find(".e-cardselection"),p.is(":visible")&&y.is(":visible")||n.isNullOrUndefined(this.model.fields.swimlaneKey)||this.element.find(".e-cardselection").closest("tr.e-columnrow:visible").length==0&&this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().prev(".e-swimlanerow").find(".e-slcollapse")),f=(r.shiftKey||r.ctrlKey)&&this.model.selectionType=="multiple"?u.cardIndex[u.cellIndex.length-1][u.cardIndex[u.cellIndex.length-1].length-1]:this.model.selectionType=="single"?u.cardIndex[0]:u.cardIndex[0][0],i=="right"){if(o=v.eq(v.index(w)+1),t==c.length-1){o.length>0&&(!r.shiftKey&&!r.ctrlKey||this.model.selectionType=="single")&&!n.isNullOrUndefined(this.model.fields.swimlaneKey)&&(this._cardSelection([[this._columnRows.index(o.closest("tr.e-columnrow")),[o.closest("tr.e-columnrow").find("td.e-rowcell").index(o.closest("td.e-rowcell"))],[0]]],o,r),this.element.find(".e-cardselection").closest("tr:visible").length==0&&this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().prev(".e-swimlanerow").find(".e-slcollapse")));return}y.find(".e-kanbancard:visible").length>0?(e=y.find(".e-kanbancard"),e.eq(f).length>0?this._cardSelection([[u.rowIndex,[t+1],[f]]],$(e[f]),r):this._cardSelection([[u.rowIndex,[t+1],[e.length-1]]],$(e[e.length-1]),r),(r.shiftKey||r.ctrlKey)&&this.model.selectionType!="single"||n.isNullOrUndefined(this.model.fields.swimlaneKey)||this.element.find(".e-cardselection").closest("tr.e-columnrow:visible").length==0&&this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().prev(".e-swimlanerow").find(".e-slcollapse"))):this._moveCurrentCard(t+1,i,r)}else if(i=="left"){if(v.index(w)!=0&&(o=v.eq(v.index(w)-1)),t==0){if(!r.shiftKey&&!r.ctrlKey&&!n.isNullOrUndefined(this.model.fields.swimlaneKey)){if(this.toggleSwimlane($(b).prev().find(".e-slexpand")),n.isNullOrUndefined(o))return;(o.length>0&&!r.shiftKey&&!r.ctrlKey||this.model.selectionType=="single")&&(this._cardSelection([[this._columnRows.index(o.closest("tr.e-columnrow")),[o.closest("tr.e-columnrow").find("td.e-rowcell").index(o.closest("td.e-rowcell"))],[0]]],o,r),this.element.find(".e-cardselection").closest("tr.e-columnrow:visible").length==0&&this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().prev(".e-swimlanerow").find(".e-slcollapse")))}return}p.find(".e-kanbancard:visible").length>0?(e=p.find(".e-kanbancard"),e.eq(f).length>0?this._cardSelection([[u.rowIndex,[t-1],[f]]],$(e[f]),r):this._cardSelection([[u.rowIndex,[t-1],[e.length-1]]],$(e[e.length-1]),r),(r.shiftKey||r.ctrlKey)&&this.model.selectionType!="single"||n.isNullOrUndefined(this.model.fields.swimlaneKey)||this.element.find(".e-cardselection").closest("tr.e-columnrow:visible").length==0&&this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().prev(".e-swimlanerow").find(".e-slexpand"))):this._moveCurrentCard(t-1,i,r)}},r.prototype.clearSelection=function(){if(this.model.allowSelection){var n=$(this._kanbanRows).not(".e-swimlanerow");$(n).find(".e-rowcell .e-kanbancard").removeClass("e-cardselection");this.selectedRowCellIndexes=[];this._selectedCardData=[];this._selectedCards=[];this._previousRowCellIndex=[];this._currentRowCellIndex=[]}},r.prototype._keyPressed=function(t,i,r,u){var f,h,e,c,l,o,s;f=this.element.find(".e-cardselection");h=this.element.find(".e-kanbancard:visible");e=this.selectedRowCellIndexes[0];l=!n.isNullOrUndefined(this.model.fields.swimlaneKey);switch(t){case"editCard":f.length>0&&this.model.editSettings.allowEditing&&(c=e.cellIndex,f=this._columnRows.eq(e.rowIndex).find("td.e-rowcell").eq(c[c.length-1]).find(".e-kanbancard").eq(e.cardIndex[c.length-1]),this.KanbanEdit.startEdit(f));break;case"insertCard":this.model.editSettings.allowAdding&&this.KanbanEdit.addCard();break;case"swimlaneExpandAll":this.expandAll();break;case"swimlaneCollapseAll":this.collapseAll();break;case"downArrow":f.length>0&&document.activeElement.id==this._id&&this._moveCurrentCard(e.rowIndex,"down",u);break;case"upArrow":f.length>0&&document.activeElement.id==this._id&&this._moveCurrentCard(e.rowIndex,"up",u);break;case"leftArrow":f.length>0&&document.activeElement.id==this._id&&this._moveCurrentCard(e.cellIndex[e.cellIndex.length-1],"left",u);break;case"rightArrow":f.length>0&&document.activeElement.id==this._id&&this._moveCurrentCard(e.cellIndex[e.cellIndex.length-1],"right",u);break;case"multiSelectionByDownArrow":u.ctrlKey=!0;f.length>0&&this._moveCurrentCard(e.rowIndex,"down",u);break;case"multiSelectionByUpArrow":u.ctrlKey=!0;f.length>0&&this._moveCurrentCard(e.rowIndex,"up",u);break;case"multiSelectionByRightArrow":u.shiftKey=!0;f.length>0&&this._moveCurrentCard(e.cellIndex[e.cellIndex.length-1],"right",u);break;case"multiSelectionByLeftArrow":u.shiftKey=!0;f.length>0&&this._moveCurrentCard(e.cellIndex[e.cellIndex.length-1],"left",u);break;case"firstCardSelection":this.model.allowSelection&&(this.clearSelection(),h.eq(0).addClass("e-cardselection"),f=this.element.find(".e-cardselection"),o=$(this._columnRows).find(".e-cardselection").index(),s=$(this._columnRows).find(".e-cardselection").parent().children().eq(0).hasClass("e-limits")?o-1:o,this.model.selectionType=="multiple"?this.selectedRowCellIndexes.push({cardIndex:[[s]],cellIndex:[f.parent().index()],rowIndex:$(this._columnRows).index(f.parents(".e-columnrow"))}):this.selectedRowCellIndexes.push({cardIndex:[s],cellIndex:[f.parent().index()],rowIndex:$(this._columnRows).index(f.parents(".e-columnrow"))}));break;case"lastCardSelection":this.model.allowSelection&&(this.clearSelection(),h.eq(h.length-1).addClass("e-cardselection"),f=this.element.find(".e-cardselection"),f=this.element.find(".e-cardselection"),o=$(this._columnRows).find(".e-cardselection").index(),s=$(this._columnRows).find(".e-cardselection").parent().children().eq(0).hasClass("e-limits")?o-1:o,this.model.selectionType=="multiple"?this.selectedRowCellIndexes.push({cardIndex:[[s]],cellIndex:[f.parent().index()],rowIndex:$(this._columnRows).index(f.parents(".e-columnrow"))}):this.selectedRowCellIndexes.push({cardIndex:[s],cellIndex:[f.parent().index()],rowIndex:$(this._columnRows).index(f.parents(".e-columnrow"))}));break;case"cancelRequest":$("#"+this._id+"_dialogEdit:visible").length>0?this.KanbanEdit.cancelEdit():f.length>0&&this.clearSelection();break;case"saveRequest":$("#"+this._id+"_dialogEdit:visible").length>0&&this.KanbanEdit.endEdit();break;case"deleteCard":f.length>0&&$("#"+this._id+"_dialogEdit:visible").length<0&&!n.isNullOrUndefined(this.model.fields.primaryKey)&&this.KanbanEdit.deleteCard(f.attr("id"));break;case"selectedSwimlaneExpand":f.length>0&&l&&(f.is(":visible")||this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().prev(".e-swimlanerow").find(".e-slexpandcollapse")));break;case"selectedSwimlaneCollapse":f.length>0&&l&&f.is(":visible")&&this.toggleSwimlane($(this._columnRows[this.selectedRowCellIndexes[0].rowIndex]).prev().find(".e-slexpandcollapse"));break;case"selectedColumnCollapse":f.length>0&&this._toggleField(this.model.columns[this.selectedRowCellIndexes[0].cellIndex[0]].headerText);break;case"selectedColumnExpand":this._collapsedColumns.length!=0&&this._toggleField(this._collapsedColumns[this._collapsedColumns.length-1]);break;case"focus":this.element.find(".e-cardselection").focus()}},r.prototype._showExpandColumns=function(t,i,r,u){var f,o,e;if(!n.isNullOrUndefined(t)){if(t!=null)if($.isArray(i))for(f=0;f<i.length;f++)o=this.getColumnByHeaderText(i[f]),i[f]=o!=null?o.headerText:i[f];else i=t.headerText;if($.isArray(i))for(f=0;f<i.length;f++)e=$.inArray(i[f],this[r]),e!=-1?(this[r].splice(e,1),this[u].push(i[f])):e!=-1||$.inArray(i[f],this[u])!=-1||n.isNullOrUndefined(this.getColumnByHeaderText(i[f]))||(this[u].push(this.getColumnByHeaderText(i[f]).key)&&this[u].push(i[f]),this[r].splice($.inArray(this.getColumnByHeaderText(i[f]).key,this[r]),1)&&this[r].splice($.inArray(i[f],this[r]),1));else e=$.inArray(i,this[r]),e!=-1?(this[r].splice(e,1),this[u].push(i)):e!=-1||$.inArray(i,this[u])!=-1||n.isNullOrUndefined(this.getColumnByHeaderText(i))||(this[u].push(this.getColumnByHeaderText(i).key)&&this[u].push(i),this[r].splice($.inArray(this.getColumnByHeaderText(i).key,this[r]),1)&&this[r].splice($.inArray(i,this[r]),1))}},r.prototype._createStackedRow=function(t){for(var l,a,s,e,u,v,r,h,o,f,p,w,y=n.buildTag("tr.e-columnheader e-stackedHeaderRow","",{},{}),i=[],c=0;c<this.model.columns.length;c++)if(l=this.model.columns[c],l.visible!=!1){for(a="",s=t.stackedHeaderColumns,e=0;e<s.length;e++)s[e].column.indexOf(l.headerText)!=-1&&(a=s[e].headerText);i.push(a)}for(u=[],v="",r=0;r<i.length;r++){for(h=1,o=r+1;o<i.length;o++)if(i[r]!=""&&i[o]!=""&&i[r]==i[o])h++;else break;u.push({sapnCount:h,headerText:i[r],css:i[r]!=""?v:"e-sheader"});r+=h-1;v=""}for(f=0;f<u.length;f++)p=n.buildTag("div",u[f].headerText,{},{}),w=n.buildTag("th.e-headercell e-stackedHeaderCell "+u[f].css+"","",{},{colspan:u[f].sapnCount}).append(p),y.append(w);return y},r.prototype._refreshStackedHeader=function(){for(var r,t=this.model.stackedHeaderRows,i=this.element.find(".e-stackedHeaderRow"),n=0;n<t.length;n++)r=this._createStackedRow(t[n]),i.length>0&&i.remove(),$(this.getHeaderTable().find(".e-columnheader").before(r));this.model.allowScrolling&&this._refreshScroller({requestType:"refresh"})},r.prototype._expandColumns=function(n){var t,i="_expandedColumns";t=typeof n=="string"?this.getColumnByHeaderText(n):this.getColumnByHeaderText(n[0]);this._showExpandColumns(t,n,"_collapsedColumns",i);this._expandCollapse(this[i],"expand");this.model.allowScrolling&&this._setWidthToColumns();this.model.stackedHeaderRows.length>0&&this._refreshStackedHeader()},r.prototype._setWidthToColumns=function(){for(var f=this.getContentTable().children("colgroup").find("col"),i=this.getHeaderTable().children("colgroup").find("col"),r=this._originalWidth-this._collapsedColumns.length*50,t=0;t<i.length;t++)if(n.isNullOrUndefined(this._columnsWidthCollection[t])||this.model.allowToggleColumn){if(this.model.allowScrolling){var o=n.parseInt((r/this._expandedColumns.length).toFixed(2)),e=n.parseInt((r/(this.model.scrollSettings.buttonSize||18)/100).toFixed(2)),u=o-e;this.model.columns[t].isCollapsed||(f.eq(t).css("width",u+"px"),i.eq(t).css("width",u+"px"),this.model.columns[t].width=u);this._columnsWidthCollection[t]=n.parseInt((r/this.model.columns.length).toFixed(2))-e}}else f.eq(t).width(this._columnsWidthCollection[t]),i.eq(t).width(this._columnsWidthCollection[t])},r.prototype._filterLimitCard=function(t){for(var e,i,f,u,r=0;r<this.model.columns.length;r++)e=this.model.columns[r],i=this.getHeaderContent().find("span.e-totalcount"),this.model.enableTotalCount&&(i=$(i[r]),f=$(i).text().indexOf(this.localizedLabels.FilterOfText),(!n.isNullOrUndefined(t)&&t.requestType=="filtering"||this.model.enableTotalCount)&&t.filterCollection.length>0?(u=this.getHeaderContent().find(".e-columnheader").not(".e-stackedHeaderRow").find(".e-headercell")[r],$(u).hasClass("e-exceed")?$(u).removeClass("e-exceed"):$(u).hasClass("e-deceed")&&$(u).removeClass("e-deceed"),f!=-1&&$(i).text($(i).text().slice(f+3)),$(i).text($($(this.element.find(".e-columnrow")).find("td[ej-mappingkey="+e.key+"] > div.e-kanbancard")).length+" "+this.localizedLabels.FilterOfText+" "+$(i).text())):n.isNullOrUndefined(e.constraints)?$(i).text($(i).text().slice(f+3)):this._renderLimit())},r.prototype._toggleField=function(t){var u,i,f=0;if($.isArray(t)){for(i=0;i<t.length;i++)u=$.inArray(t[i],this._collapsedColumns),u!=-1&&f++;f==t.length?this._expandColumns(t):this._collapseColumns(t)}else $.inArray(t,this._collapsedColumns)!=-1?this._expandColumns(t):this._collapseColumns(t);if(this.model.allowScrolling){var s=this.getContentTable().children("colgroup").find("col"),e=this.getHeaderTable().children("colgroup").find("col"),o=this._originalWidth-this._collapsedColumns.length*50;for(i=0;i<e.length;i++){var h=n.parseInt((o/this._expandedColumns.length).toFixed(2)),c=n.parseInt((o/(this.model.scrollSettings.buttonSize||18)/100).toFixed(2)),r=h-c;this.model.columns[i].isCollapsed||(s.eq(i).css("width",r+"px"),e.eq(i).css("width",r+"px"),this.model.columns[i].width=r)}}this._refreshScroller({requestType:"refresh"})},r.prototype.refreshColumnConstraints=function(){this._renderLimit();var n={requestType:"refresh"};this._filterCollection.length>0&&(n.filterCollection=this._filterCollection,this._filterLimitCard(n));this._swimlaneLimit(n);this._enableSwimlaneCount=!1},r.prototype._validateLimit=function(t,i,r){var o=t.key,u=$($(this.element.find(".e-columnrow")).find("td[ej-mappingkey="+o+"]")),f,s=!n.isNullOrUndefined(t.constraints.min),h=!n.isNullOrUndefined(t.constraints.max),e=!n.isNullOrUndefined(this.model.fields.swimlaneKey)&&r==0;t.constraints.type=="column"?f=u.find(".e-kanbancard").length:(f=$(u[r]).find(".e-kanbancard").length,u=$(u[r]));s&&(t.constraints.min>f?(u.addClass("e-deceed"),e&&$(i).addClass("e-deceed")):(u.removeClass("e-deceed"),e&&$(i).removeClass("e-deceed")));h&&(t.constraints.max<f?(u.addClass("e-exceed"),e&&$(i).addClass("e-exceed")):(u.removeClass("e-exceed"),e&&$(i).removeClass("e-exceed")));u.find(".e-limits").addClass("e-hide");$(i).find(".e-limits").removeClass("e-hide")},r.prototype._swimlaneLimit=function(t){for(var i,h,e,c,o,l,u,a,s,r=0;r<this.model.columns.length;r++)if(i=this.model.columns[r].constraints,h=this.model.columns[r].key,!n.isNullOrUndefined(i)){var v=!n.isNullOrUndefined(i.min),y=!n.isNullOrUndefined(i.max),f=$($(this.getContent().find(".e-columnrow")).find("td[ej-mappingkey="+h+"]"));if(i.type=="swimlane"&&!n.isNullOrUndefined(this.model.fields.swimlaneKey)&&(this._enableSwimlaneCount&&(t.requestType=="filtering"||t.requestType=="refresh")||this._filterCollection.length>0&&this._enableSwimlaneCount))for(u=0;u<f.length;u++)a=n.buildTag("div.e-limits"),$(f).eq(u).prepend(a),s=$(f).eq(u).find(".e-limits"),v&&(e=n.buildTag("div.e-min",this.localizedLabels.Min+" [","",{}),c=n.buildTag("span.e-minlimit",i.min.toString(),"",{}),e.append(c).append("]"),s.append(e)),y&&(o=n.buildTag("div.e-max",this.localizedLabels.Max+" [","",{}),l=n.buildTag("span.e-maxlimit",i.max.toString(),"",{}),o.append(l).append("]"),s.append(o)),this.getHeaderContent().find(".e-headercell").eq(r).hasClass("e-shrinkcol")&&$(f).eq(u).find(".e-limits").addClass("e-hide")}},r.prototype._hideCollapseColumns=function(t,i,r,u){var f,e;if(!n.isNullOrUndefined(t))if($.isArray(i))for(f=0;f<i.length;f++)e=$.inArray(i[f],this[u]),e!=-1?(this[r].push(i[f]),this[u].splice(e,1)):e!=-1||$.inArray(i[f],this[r])!=-1||n.isNullOrUndefined(this.getColumnByHeaderText(i[f]))||(this[r].push(this.getColumnByHeaderText(i[f]).key)&&this[r].push(this.getColumnByHeaderText(i[f]).key),this[u].splice($.inArray(this.getColumnByHeaderText(i[f]).key,this[u]),1)&&this[u].splice($.inArray(i[f],this[u]),1));else e=$.inArray(i,this[u]),e!=-1?(this[r].push(i),this[u].splice(e,1)):e!=-1||u!=u||$.inArray(i,this[r])!=-1||n.isNullOrUndefined(this.getColumnByHeaderText(i))||(this[r].push(this.getColumnByHeaderText(i).key)&&this[r].push(this.getColumnByHeaderText(i).key),this[u].splice($.inArray(this.getColumnByHeaderText(i).key,this[u]),1)&&this[u].splice($.inArray(i,this[u]),1))},r.prototype.hideColumns=function(n){for(var i,r=0,u,f="_hiddenColumns",t=0;t<this._visibleColumns.length;t++)i=$.inArray(this._collapsedColumns[t],this._visibleColumns),i!=-1&&r++;if(this._visibleColumns.length-1>r)u=typeof n=="string"?this.getColumnByHeaderText(n):this.getColumnByHeaderText(n[0]),this._hideCollapseColumns(u,n,f,"_visibleColumns"),this._showhide(this[f],"hide"),this.model.stackedHeaderRows.length>0&&this._refreshStackedHeader();else{if(this._visibleColumns.length==1)return;this._visibleColumns[0]==n?this._expandColumns(this._visibleColumns[1]):this._expandColumns(this._visibleColumns[0]);this.hideColumns(n)}this._renderLimit();this._totalCount();this._stackedHeadervisible()},r.prototype._expandCollapse=function(n,t){var u,y=0,l,s=this.model.columns,i,h,c,f;l=t==="expand"?"_expandedColumns":"_collapsedColumns";var p=this.getHeaderTable().find("thead"),e=p.find("tr").not(".e-stackedHeaderRow").find(".e-headercell"),o=this.getHeaderTable().find("colgroup").find("col"),a,r,v=this.getContentTable().find("colgroup").find("col");for(u=0;u<s.length;u++)if($.inArray(s[u].headerText,this[l])!=-1&&(s[u].isCollapsed=t==="expand"?!1:!0,y++),a=this.getColumnByHeaderText(n[u]),i=$.inArray(a,this.model.columns),h=t=="expand"?!0:!1,i!=-1&&(h?o.eq(i).hasClass("e-shrinkcol")&&(e.eq(i).find(".e-headercelldiv").removeClass("e-hide"),e.eq(i).removeClass("e-shrinkcol"),o.eq(i).removeClass("e-shrinkcol"),v.eq(i).removeClass("e-shrinkcol"),e.eq(i).find(".e-clcollapse").addClass("e-clexpand").removeClass("e-clcollapse")):o.eq(i).hasClass("e-shrinkcol")||(e.eq(i).find(".e-headercelldiv").addClass("e-hide"),e.eq(i).addClass("e-shrinkcol"),o.eq(i).addClass("e-shrinkcol"),v.eq(i).addClass("e-shrinkcol"),e.eq(i).find(".e-clexpand").addClass("e-clcollapse").removeClass("e-clexpand"))),c=this.model.columns[u].isCollapsed,h){if(!c)for(f=0;f<this._columnRows.length;f++)if(r=this._columnRows.eq(f).find("td.e-rowcell[ej-mappingkey='"+this.model.columns[u].key+"']"),r.hasClass("e-shrink"))r.removeClass("e-shrink").find(".e-shrinkheader").addClass("e-hide").parent().find(".e-kanbancard").removeClass("e-hide"),r.find(".e-customaddbutton").removeClass("e-hide"),r.find(".e-limits").removeClass("e-hide"),r.find(".e-shrinkcount").text(this._columnCardcount(this.currentViewData,this.model.columns[u].key,this.model.fields.swimlaneKey?f:null));else break}else if(c)for(f=0;f<this._columnRows.length;f++)if(r=this._columnRows.eq(f).find("td.e-rowcell[ej-mappingkey='"+this.model.columns[u].key+"']"),r.hasClass("e-shrink"))break;else r.addClass("e-shrink").find(".e-shrinkheader").removeClass("e-hide").parent().find(".e-kanbancard").addClass("e-hide"),r.find(".e-customaddbutton").addClass("e-hide"),r.find(".e-limits").addClass("e-hide"),r.find(".e-shrinkcount").text(this._columnCardcount(this.currentViewData,this.model.columns[u].key,this.model.fields.swimlaneKey?f:null))},r.prototype._collapseColumns=function(n){for(var i,r,u="_collapsedColumns",f=0,t=0;t<n.length;t++)i=$.inArray(n[t],this._expandedColumns),i!=-1&&f++;this._expandedColumns.length==f||this.getVisibleColumnNames().length-this._collapsedColumns.length==1||this.model.columns.length-this._collapsedColumns.length==1?(this._expandColumns(this._collapsedColumns[0]),this._collapseColumns(n)):(r=typeof n=="string"?this.getColumnByHeaderText(n):this.getColumnByHeaderText(n[0]),this._hideCollapseColumns(r,n,u,"_expandedColumns"),this._expandCollapse(this[u],"collapse"),this.model.allowScrolling&&this._setWidthToColumns(),this.model.stackedHeaderRows.length>0&&this._refreshStackedHeader())},r.prototype._cardHover=function(t){var u=$(t.target),r=$(this._kanbanRows),i=$(u).closest(".e-kanbancard");return i.length<0?!1:(this.model.allowHover&&(t.type=="mouseenter"?n.isNullOrUndefined(r)||i.index()!=-1&&i.addClass("e-hover"):r.find(".e-kanbancard").removeClass("e-hover")),!1)},r.prototype.toggleCard=function(n){var t,i;if(typeof n=="string"||typeof n=="number")t=this.element.find("div.e-kanbancard[id="+n+"]"),this._toggleCardByTarget($(t).find(".e-cardheader .e-icon"));else if(typeof n=="object"&&n[0].nodeName!="DIV")for(i=0;i<n.length;i++)t=this.element.find("div.e-kanbancard[id="+n[i]+"]"),this._toggleCardByTarget($(t).find(".e-cardheader .e-icon"));else this._toggleCardByTarget(n)},r.prototype._toggleCardByTarget=function(t){var f;if(t=t.hasClass("e-expandcollapse")?t.find("div:first"):t,t.hasClass("e-cardexpand")||t.hasClass("e-cardcollapse")){var i=t.closest("div.e-cardheader"),r=i.next(),u=i.find(".e-primarykey").text(),e=$(t).closest(".e-kanbancard");t.hasClass("e-cardexpand")?(t.removeClass("e-cardexpand").addClass("e-cardcollapse"),e.addClass("e-collapsedcard"),i.append(r.find(".e-text").clone()),r.hide(),$.inArray(u,this._collapsedCards)==-1&&this._collapsedCards.push(u)):(t.removeClass("e-cardcollapse").addClass("e-cardexpand"),e.removeClass("e-collapsedcard"),i.find(".e-text").remove(),r.show(),f=$.inArray(u,this._collapsedCards),f!=-1&&this._collapsedCards.splice(f));!this.model.allowScrolling||n.isNullOrUndefined(this._scrollObject&&this._scrollObject.model)||t.closest(".e-hscroll").length||this.getScrollObject().refresh()}},r.prototype.toggleColumn=function(n){if(typeof n=="string"||"object"&&n[0].nodeName!="DIV")this._toggleField(n.closest(".e-shrink").find(".e-shrinkheader").text().split("[")[0]);else{var u,i,f,t,r,o=this.model.columns,e;if(this.model.stackedHeaderRows.length&&(r=this.model.stackedHeaderRows[0].stackedHeaderColumns),f=n.closest(".e-headercell").not(".e-stackedHeaderCell"),i=this.element.find(".e-columnheader").not(".e-stackedHeaderRow").find(".e-hide"),f.length>0)this._toggleField(o[f.index()].headerText);else if(n.closest(".e-shrink").find(".e-shrinkheader").length>0)for(t=0;t<i.length;t++)e=$(i[t]).find(".e-headerdiv").text().split("[")[0],e==n.closest(".e-shrink").find(".e-shrinkheader").text().split("[")[0]&&($(i[t]).next().find(".e-clcollapse").addClass("e-clexpand"),$(i[t]).next().find(".e-clexpand").removeClass("e-clcollapse"),this._toggleField(e));else if(n.closest(".e-stackedHeaderRow").length>0)for(u=n.closest(".e-stackedHeaderCell"),t=0;t<r.length;t++)r[t].headerText==$(u).text()&&(u.hasClass("e-collapse")?this.element.find(".e-stackedHeaderCell").eq(t).removeClass("e-collapse"):this.element.find(".e-stackedHeaderCell").eq(t).addClass("e-collapse"),this._toggleField(r[t].column.split(",")))}},r.prototype._clickHandler=function(t){var i=$(t.target),r,e=i.hasClass("e-rowcell")?i.index():i.closest(".e-rowcell").index(),u=this.getIndexByRow(i.closest("tr.e-columnrow")),f;r=i.closest(".e-kanbancard");$(t.target).hasClass("e-columnadd")&&(this._isAddNewClick=!0,this._newCard=$(t.target).parents(".e-rowcell"),this.KanbanEdit.addCard());(i.hasClass("e-cardexpand")||i.hasClass("e-cardcollapse")||i.hasClass("e-expandcollapse"))&&this.toggleCard(i);(i.closest(".e-clexpand").length||i.closest(".e-clcollapse").length||i.closest(".e-shrink").length||i.closest(".e-stackedHeaderRow").length)&&this.model.allowToggleColumn&&this.toggleColumn(i);!n.isNullOrUndefined(this.model.fields.swimlaneKey)&&(i.hasClass("e-slexpandcollapse")||i.hasClass("e-slexpand")||i.hasClass("e-slcollapse"))&&this.toggleSwimlane(i);this.model.allowSelection&&r.length>0&&i.closest(".e-expandcollapse").length<=0&&(f=$(r.parent()).children().eq(0).hasClass("e-limits")?r.index()-1:r.index(),this.model.selectionType=="single"?this._cardSelection([[u,[e],[f]]],r,t):this.model.selectionType=="multiple"&&(t.shiftKey||t.ctrlKey||this._enableMultiTouch?(this._currentRowCellIndex.length==0||u==this._currentRowCellIndex[0][0])&&this._cardSelection([[u,[e],[f]]],r,t):this._cardSelection([[u,[e],[f]]],r,t)));r.length>0&&this._cardClick(i,r);(i.attr("id")==this._id+"_Cancel"||i.parent().attr("id")==this._id+"_closebutton")&&this.KanbanEdit.cancelEdit();i.attr("id")==this._id+"_Save"&&this.KanbanEdit.endEdit();i.hasClass("e-cardtouch")&&(i.hasClass("e-spanclicked")?(i.removeClass("e-spanclicked"),this._enableMultiTouch=!1,this._kTouchBar.hide()):(i.addClass("e-spanclicked"),this._enableMultiTouch=!0));this._kbnHeaderAndCellEvents(i)},r.prototype._kbnHeaderAndCellEvents=function(t){var r={},c=t.find(".e-kanbancard"),u=t,e,s=t.find(".e-cardselection"),h,i=this,f=t.index(),l=t.parents(".e-columnrow"),a,o,y,v;if(a=this.element.find(".e-rowcell.e-droppable"),e=t.attr("ej-mappingkey"),u.parents(".e-headercell").length>0&&(u=t.parents(".e-headercell")),u.hasClass("e-headercell")&&(h=f=u.index(),o=a.eq(h),e=o.attr("ej-mappingkey"),i.model.fields.swimlaneKey&&(o=$("td[ej-mappingkey~='"+e+"']")),c=o.find(".e-kanbancard"),s=o.find(".e-cardselection"),l=o.parents(".e-columnrow")),(t.hasClass("e-rowcell")||!u.hasClass("e-stackedHeaderCell"))&&(y=l.prev(".e-swimlanerow").find(".e-slkey").text(),v=[],r.cardsInfo=function(){var r={},u;return r.cards=c,r.cardsData=i.model.fields.swimlaneKey&&t.hasClass("e-rowcell")?new n.DataManager(i._currentJsonData).executeLocal((new n.Query).where(i.model.keyField,n.FilterOperators.equal,e).where(i.model.fields.swimlaneKey,n.FilterOperators.equal,y)):new n.DataManager(i._currentJsonData).executeLocal((new n.Query).where(i.model.keyField,n.FilterOperators.equal,e)),r.cardsCount=c.length,i._selectedCardData.length>0&&(u=$.inArray(f,i.selectedRowCellIndexes[0].cellIndex),!n.isNullOrUndefined(u)&&u>=0&&v.push(i.selectedRowCellIndexes[0].cardIndex[u])),r.selectedCardsIndexes=v,r.selectedCardsData=new n.DataManager(i._selectedCardData).executeLocal((new n.Query).where(i.model.keyField,n.FilterOperators.equal,e)),r.selectedCards=s,r}),t.hasClass("e-rowcell")&&(r.rowIndex=this.getIndexByRow(l),r.cellIndex=f,this._trigger("cellClick",r)),u.hasClass("e-stackedHeaderCell")){r.text=t.text();var p=[],s,w=[],b=[],k=[],d,g=[],nt=[];d=this.element.find(".e-stackedHeaderRow");r.data=function(){var r,c=0,o,tt=i.model.stackedHeaderRows[d.index(u.parents(".e-stackedHeaderRow"))].stackedHeaderColumns,h,e,l,v,y,t;for(r=tt[u.index()].column,r=r.split(","),h=0;h<r.length;h++)e=new n.DataManager(i.model.columns).executeLocal((new n.Query).where("headerText",n.FilterOperators.equal,r[h])),l=$("td[ej-mappingkey~='"+e[0].key+"']"),v=l.find(".e-kanbancard"),p.push(v),g.push(new n.DataManager(i._currentJsonData).executeLocal((new n.Query).where(i.model.keyField,n.FilterOperators.equal,e[0].key))),f=a.index($("td[ej-mappingkey~='"+e[0].key+"']")[0]),i._selectedCardData.length>0&&(o=$.inArray(f,i.selectedRowCellIndexes[0].cellIndex),!n.isNullOrUndefined(o)&&o>=0&&(y=l.find(".e-cardselection"),s.push(y),nt.push(new n.DataManager(i._selectedCardData).executeLocal((new n.Query).where(i.model.keyField,n.FilterOperators.equal,e[0].key))),y.length>0&&(b.push(f),k.push(i.selectedRowCellIndexes[0].cardIndex[o])))),c=c+v.length,w.push(f);return t={},t.count=c,t.cards=p,t.cardsData=g,t.cellIndexes=w,t.selectedCellCardIndexes={cellIndex:b,cardIndex:k},t.selectedCards=s,t.selectedCardsData=nt,t};this._trigger("headerClick",r)}else u.hasClass("e-headercell")&&(r["text "]=u.text(),r.cellIndex=h,r.columnData=this.model.columns[h],this._trigger("headerClick",r))},r.prototype._cardClick=function(t,i){var r,u=null,f;n.isNullOrUndefined(i.attr("id"))||(f=new n.DataManager(this._currentJsonData),u=f.executeLocal((new n.Query).where(this.model.fields.primaryKey,n.FilterOperators.equal,i.attr("id"))));r={target:t,currentCard:i,data:u};this._trigger("cardClick",r)},r.prototype._getCardData=function(t){return new n.DataManager(this._currentJsonData).executeLocal((new n.Query).where(this.model.fields.primaryKey,n.FilterOperators.equal,t))},r.prototype._getCardbyIndexes=function(n){return $(this.getRowByIndex(n[0][0]).find(".e-rowcell:eq("+n[0][1][0]+")").find("div.e-kanbancard:eq("+n[0][2][0]+")"))},r.prototype.getRowByIndex=function(t){if(!n.isNullOrUndefined(t))return $(this._columnRows[t])},r.prototype._cardSelection=function(t,i,r){var c,h,f=null,o=null,w,l,d,v,y,s,p;if(c=i.parent("td.e-rowcell"),this._currentRowCellIndex.length>0&&!$(i).hasClass("e-cardselection")&&(this._previousRowCellIndex=[[this._currentRowCellIndex[0][0],[this._currentRowCellIndex[0][1][0]],[this._currentRowCellIndex[0][2][0]]]]),n.isNullOrUndefined(i.attr("id"))||(w=new n.DataManager(this._currentJsonData),o=w.executeLocal((new n.Query).where(this.model.fields.primaryKey,n.FilterOperators.equal,i.attr("id")))),n.isNullOrUndefined(this._previousRowCellIndex)||this._previousRowCellIndex.length==0||(f=this._getCardbyIndexes(this._previousRowCellIndex)),h={currentCell:c,target:i,cellIndex:t[0][1][0],cardIndex:t[0][2][0],data:o,previousRowCellIndex:this._previousRowCellIndex,previousCard:f,selectedCardsData:this._selectedCardData},!this._trigger("beforeCardSelect",h)){if($(i).hasClass("e-cardselection")||(this.model.selectionType!="multiple"||this._kTouchBar.find(".e-cardtouch").hasClass("e-spanclicked")||this._kTouchBar.hide(),r.pointerType!="touch"||this._kTouchBar.find(".e-cardtouch").hasClass("e-spanclicked")||this.model.selectionType!="multiple"||(l=$(i).offset(),this._kTouchBar.show(),this._kTouchBar.offset({top:l.top,left:l.left}))),this.model.selectionType=="multiple"&&r.shiftKey){var a,e,u=0,b=0,g=i,k=[];for(n.isNullOrUndefined(f)?e=i.parents(".e-columnrow").find(".e-kanbancard"):(a=f.parents(".e-columnrow"),a.find(".e-cardselection").not(f).removeClass("e-cardselection"),e=a.find(".e-kanbancard"),u=e.index(f)),this._selectedCards=this._selectedCardData=this.selectedRowCellIndexes=[];b<=0;)y=[],d=$(e[u]).parents(".e-columnrow"),v=$(e[u]).parents(".e-rowcell"),$(e[u]).addClass("e-cardselection"),k.push(e[u]),this._selectedCardData.push(this._getKanbanCardData(this._currentJsonData,e[u].id)[0]),y=[[this.element.find(".e-columnrow").index(d),[v.index()],[v.find($(e[u])).index()]]],e[u].id==g.attr("id")&&(b=1),this._pushIntoSelectedArray(y),n.isNullOrUndefined(f)?++u:t[0][1][0]<this._previousRowCellIndex[0][1][0]?--u:t[0][1][0]==this._previousRowCellIndex[0][1][0]?t[0][2][0]<this._previousRowCellIndex[0][2][0]?--u:++u:++u;n.isNullOrUndefined(f)&&(this._previousRowCellIndex=this._currentRowCellIndex=[[0,[0],[0]]],f=this._getCardbyIndexes(this._previousRowCellIndex));this._selectedCards=[];this._selectedCards[this._selectedCards.length]=k;!n.isNullOrUndefined(f)||r.ctrlKey||r.shiftKey||this._enableMultiTouch||($(i).addClass("e-cardselection"),this._selectedCards.push(i[0]),this._selectedCardData.push(this._getKanbanCardData(this._currentJsonData,i.id)[0]),this._pushIntoSelectedArray(t))}if(this.model.selectionType=="multiple"&&(r.ctrlKey||this._enableMultiTouch))if($(i).hasClass("e-cardselection")){for($(i).removeClass("e-cardselection"),this._popFromSelectedArray(t[0][0],t[0][1],t[0][2],r),s=0;s<this._selectedCardData.length;s++)if(o[0][this.model.fields.primaryKey]==this._selectedCardData[0][this.model.fields.primaryKey])break;this._selectedCardData.splice(s,1);this._selectedCards.splice(s,1);this._currentRowCellIndex=t}else $(i).addClass("e-cardselection"),this._selectedCards.push(i[0]),this._pushIntoSelectedArray(t),this._selectedCardData.push(o[0]);else this.model.selectionType=="multiple"&&r.shiftKey||(p=t[0][2],this.element.find(".e-cardselection").removeClass("e-cardselection"),this._selectedCards=[],this.selectedRowCellIndexes=[],$(i).addClass("e-cardselection"),this._selectedCardData=[],this._selectedCardData.push(o[0]),this._selectedCards.push(i[0]),this.model.selectionType=="multiple"&&(p=[t[0][2]]),this.selectedRowCellIndexes.push({rowIndex:t[0][0],cellIndex:t[0][1],cardIndex:p}));(h={currentCell:c,target:i,cellIndex:t[0][1][0],cardIndex:t[0][2][0],data:o,selectedRowCellIndex:this.selectedRowCellIndexes,previousRowCellIndex:this._previousRowCellIndex,previousCard:f,selectedCardsData:this._selectedCardData},this.model.selectionType=="multiple"&&r.shiftKey&&$(i).hasClass("e-cardselection")?(this._previousRowCellIndex.length==0&&(this._currentRowCellIndex=[[i.parents(".e-columnrow").index(),[0],[0]]]),this._currentRowCellIndex.length==0&&(this._currentRowCellIndex=t)):$(i).hasClass("e-cardselection")&&(this._currentRowCellIndex=t),this._trigger("cardSelect",h))||this.element.focus()}},r.prototype._pushIntoSelectedArray=function(n){for(var i=0,u=!0,f=!0,r,e,t=0;t<this.selectedRowCellIndexes.length;t++)if(r=this.selectedRowCellIndexes[t],r.rowIndex==n[0][0]){for(u=!1,i=0;i<r.cellIndex.length;i++)if(e=r.cellIndex[i],e==n[0][1][0]){f=!1;break}break}u&&this.selectedRowCellIndexes.push({rowIndex:n[0][0],cellIndex:n[0][1],cardIndex:[n[0][2]]});f?u||(this.selectedRowCellIndexes[t].cellIndex.push(n[0][1][0]),this.selectedRowCellIndexes[t].cardIndex.push([n[0][2][0]])):this.selectedRowCellIndexes[t].cardIndex[i].push(n[0][2][0])},r.prototype._popFromSelectedArray=function(n,t,i,r){var e,f,o,u,s,h;if(this.model.selectionType=="multiple"&&(r.ctrlKey||r.shiftKey||this._enableMultiTouch))for(e=0;e<this.selectedRowCellIndexes.length;e++)if(u=this.selectedRowCellIndexes[e],u.rowIndex==n)for(f=0;f<u.cellIndex.length;f++)if(s=u.cellIndex[f],s==t[0])if(r.shiftKey){u.cardIndex=[];break}else for(o=0;o<u.cardIndex[f].length;o++)if(h=u.cardIndex[f][o],h==i[0]){u.cardIndex[f].splice(o,1);u.cardIndex[f].length==0&&(u.cardIndex.splice(f,1),u.cellIndex.splice(f,1));u.cellIndex.length==0&&this.selectedRowCellIndexes.splice(e,1);break}},r.prototype.toggleSwimlane=function(n){var t,i,r;if(typeof n=="string"||typeof n=="number")t=this._removeIdSymbols(n),i=this.element.find("tr[id="+t+"]"),this._toggleSwimlaneRow($(i).find(".e-rowcell .e-slexpandcollapse"));else if(typeof n=="object"&&n[0].nodeName!="DIV")for(r=0;r<n.length;r++)t=this._removeIdSymbols(n[r]),i=this.element.find("tr[id="+t+"]"),this._toggleSwimlaneRow($(i).find(".e-rowcell .e-slexpandcollapse"));else this._toggleSwimlaneRow(n)},r.prototype._toggleSwimlaneRow=function(t){var e,r,o,u,f,i,s;if(t=t.hasClass("e-slexpandcollapse")?t.find("div:first"):t,t.hasClass("e-slexpand")||t.hasClass("e-slcollapse")){if(e=t.closest("tr"),e.next(".e-collapsedrow").remove(),r=e.next(),t.hasClass("e-slexpand")){for(r.hide(),o=n.buildTag("tr","",{},{"class":"e-collapsedrow"}),u=this.model.columns,i=0;i<u.length;i++)f=n.buildTag("td","",{},{"class":"e-rowcell",role:"kanbancell"}),u[i].visible||f.addClass("e-hide"),u[i].isCollapsed&&f.addClass("e-shrink"),o.append(f);r.before(o);t.removeClass("e-slexpand").addClass("e-slcollapse")}else r.show(),t.removeClass("e-collapsedrow").removeClass("e-slcollapse").addClass("e-slexpand");this.model.allowScrolling&&(s=this.headerContent.find(".e-hscrollcss"),this._refreshScroller({requestType:"refresh"}),this.getContent().find(".e-vscrollbar").length>0?s.removeClass("e-vscroll-area"):s.addClass("e-vscroll-area"))}},r.prototype.getScrollObject=function(){return(this._scrollObject==null||n.isNullOrUndefined(this._scrollObject.model))&&(this._scrollObject=this.getContent().ejScroller("instance")),this._scrollObject},r.prototype.getIndexByRow=function(n){return $(this._columnRows).index(n)},r.prototype._initialize=function(){},r.prototype._initPrivateProperties=function(){this.currentViewData=null;n.Kanban.Locale["default"]=n.Kanban.Locale["en-US"]={EmptyCard:"No cards to display",SaveButton:"Save",CancelButton:"Cancel",EditFormTitle:"Details of ",AddFormTitle:"Add New Card",SwimlaneCaptionFormat:"- {{:count}}{{if count == 1 }} item {{else}} items {{/if}}",FilterSettings:"Filters:",FilterOfText:"of",Max:"Max",Min:"Min",Cards:"  Cards"};this.localizedLabels=this._getLocalizedLabels()},r.prototype._init=function(){if(this._initPrivateProperties(),this._dataManager=this._dataSource()instanceof n.DataManager?this._dataSource():this._dataSource()!=null?new n.DataManager(this._dataSource()):null,this._trigger("load"),!n.isNullOrUndefined(this.model.query)&&this.model.query instanceof n.Query||(this.model.query=new n.Query),this._initSubModules(),this._initialize(),this.model.columns.length==0)return!1;this.element.removeClass("e-kanbanscroll");this._initScrolling();this._checkDataBinding()},r.prototype._initSubModules=function(){var t=this.model;t.allowDragAndDrop&&(this.KanbanDragAndDrop=new n.KanbanFeatures.DragAndDrop(this));(t.editSettings.allowEditing||t.editSettings.allowAdding)&&(this.KanbanEdit=new n.KanbanFeatures.Edit(this))},r.prototype._initScrolling=function(){(this.model.width||this.model.height)&&(this.model.allowScrolling=!0,this.model.width&&(this.model.scrollSettings.width=this.model.width),this.model.height&&(this.model.scrollSettings.height=this.model.height));this._originalScrollWidth=this.model.scrollSettings.width},r.prototype._setResponsiveHeightWidth=function(){typeof this.model.scrollSettings.width=="string"?this._originalScrollWidth=this.element.width():this.model.scrollSettings.width>0&&(this._originalScrollWidth=this.model.scrollSettings.width);typeof this.model.scrollSettings.height=="string"?this._originalScrollHeight=this.getContent().height():this.model.scrollSettings.height>0&&(this._originalScrollHeight=this.model.scrollSettings.height);this.model.minWidth&&this.model.isResponsive&&($(window).bind("resize",$.proxy(this._kanbanWindowResize,this)),this._kanbanWindowResize())},r.prototype._renderResponsiveKanban=function(t,i,r,u,f){var e;t?(this.model.scrollSettings.width=n.isNullOrUndefined(this._originalScrollWidth)?Math.min(r,f):Math.min(this._originalScrollWidth,Math.min(r,f)),e=Math.min(u,i),e=n.isNullOrUndefined(this._originalScrollHeight)?e:Math.min(this._originalScrollHeight,u),this.model.scrollSettings.height=e,this._originalScrollWidth<f&&(this.model.scrollSettings.width=Math.min(r,f)),this._renderScroller()):(this.model.scrollSettings.width="100%",n.isNullOrUndefined(this._originalScrollWidth)||(this.model.scrollSettings.width=Math.min(this._originalScrollWidth,r)),e=this.element.outerHeight(),n.isNullOrUndefined(this._originalScrollHeight)||(e=Math.min(this._originalScrollHeight,u)),this.model.scrollSettings.height=e,this._renderScroller())},r.prototype._kanbanWindowResize=function(){var t,i,n,r,u=this.element.find(".e-kanbantoolbar"),f;this.model.scrollSettings.width=this._originalScrollWidth;this.element.outerWidth("100%");this.getContentTable().width("100%");this.getHeaderTable().width("100%");t=this.element.outerWidth();i=$(window).width()-this.element.offset().left;n=$(window).height()-this.element.offset().top;u.length>0&&(n=n-(u.outerHeight()+25));r=this.headerContent.outerHeight()+this.getContentTable().height();f=this.model.minWidth>t||i<=t||n<=r;this._renderResponsiveKanban(f,r,t,n,i)},r.prototype._initKanbanRender=function(){this._addInitTemplate();this.model.keySettings&&$.extend(this.model.keyConfigs,this.model.keySettings);this._render();this._trigger("dataBound",{});this.KanbanEdit&&(this.KanbanEdit._processEditing(),this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="dialogtemplate"?this.element.append(this.KanbanEdit._renderDialog()):(this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate")&&this.element.append(this.KanbanEdit._renderExternalForm()));this._setResponsiveHeightWidth();this._renderKanbanTouchBar();this._wireEvents();this.model.tooltipSettings.enable&&(this.element.append($("<div class='e-kanbantooltip'><\/div>")),this.element.find(".e-kanbantooltip").hide());this.initialRender=!1},r.prototype._renderKanbanTouchBar=function(){this._kTouchBar=n.buildTag("div.e-kanbantouchbar","",{display:"none"},{});var t=n.buildTag("div.e-content","",{},{}),i=n.buildTag("div.e-downtail e-tail","",{},{}),r=n.buildTag("span.e-cardtouch e-icon","",{},{});t.append(r);this._kTouchBar.append(t);this._kTouchBar.append(i);this.element.append(this._kTouchBar)},r.prototype._addLastRow=function(){var r=this.getContentTable().find("tr:last").find("td"),i=0,t;if(this.model.allowScrolling&&!n.isNullOrUndefined(this.model.dataSource)&&!n.isNullOrUndefined(this._kanbanRows)){for(t=0;t<this._kanbanRows.length;t++)i+=$(this._kanbanRows[t]).height();i<this.getContent().height()-1&&r.addClass("e-lastrowcell")}},r.prototype._render=function(){this.element.addClass(this.model.cssClass+"e-widget");this._renderContent().insertAfter(this.element.children(".e-kanbanheader"));this._renderLimit();this._enableDragandScroll();this.initialRender&&this._addLastRow()},r.prototype._renderHeader=function(){var e=n.buildTag("div.e-kanbanheader","",{},{}),c=n.buildTag("div","",{},{}),b=$(document.createElement("colgroup")),s,d,i,y,tt,f,it,rt,p,ut,w,ft;n.isNullOrUndefined(this.model.fields.swimlaneKey)||e.addClass("e-slheader");this.model.allowScrolling&&c.addClass("e-headercontent");e.append(c);var o=n.buildTag("table.e-table","",{},{cellspacing:"0.25px",role:"kanban"}),l=n.buildTag("thead","",{},{}),k=n.buildTag("tbody.e-hide","",{},{});for(s=0;s<this.model.stackedHeaderRows.length;s++)d=this._createStackedRow(this.model.stackedHeaderRows[s]),l.append(d);var g=n.buildTag("tr.e-columnheader","",{},{}),nt=$(document.createElement("tr")),r=this.model.columns;for(this._visibleColumns=[],this._expandedColumns=[],this._headerColumnNames={},i=0;i<r.length;i++){var t=r[i],u=n.buildTag("th.e-headercell","",{},{role:"columnheader"}),h=document.createElement("col"),et=document.createElement("td"),a=n.buildTag("div.e-headercelldiv","",{},{}),v=n.buildTag("div.e-headerdiv",t.headerText!=null?t.headerText:t.key,{},{});n.isNullOrUndefined(t.headerTemplate)||v.html($(t.headerTemplate).hide().html());f=null;this.model.enableTotalCount&&(y=n.buildTag("div.e-totalcard","",{},{}),tt=n.buildTag("span.e-totalcount","",{},{}),y.append("[").append(tt).append("]"),v.append(y));n.isNullOrUndefined(t.constraints)||(it=!n.isNullOrUndefined(t.constraints.min),rt=!n.isNullOrUndefined(t.constraints.max),f=n.buildTag("div.e-limits","",{},{}),it&&(p=n.buildTag("div.e-min",this.localizedLabels.Min+" [","",{}),ut=n.buildTag("span.e-minlimit",t.constraints.min.toString(),"",{}),p.append(ut).append("]"),f.append(p)),rt&&(w=n.buildTag("div.e-max",this.localizedLabels.Max+" [","",{}),ft=n.buildTag("span.e-maxlimit",t.constraints.max.toString(),"",{}),w.append(ft).append("]"),f.append(w)));a.append(v).append(f);u.append(a);this.model.allowToggleColumn&&(r[i].isCollapsed===!0?u.append(n.buildTag("div.e-icon e-clcollapse","",{},{})).addClass("e-shrinkcol"):u.append(n.buildTag("div.e-icon e-clexpand","",{},{})));r[i].isCollapsed===!0&&this.model.allowToggleColumn?(u.find(".e-headercelldiv").addClass("e-hide")&&$(h).addClass("e-shrinkcol"),$.inArray(r[i].headerText,this._collapsedColumns)==-1&&this._collapsedColumns.push(r[i].headerText)):(u.find(".e-headercelldiv").removeClass("e-hide")&&$(h).removeClass("e-shrinkcol"),this._expandedColumns.push(r[i].headerText),r[i].isCollapsed=!1);b.append(h);g.append(u);nt.append(et);t.visible===!1?(u.addClass("e-hide")&&$(h).css("display","none"),$.inArray(t.headerText,this._hiddenColumns)==-1&&this._hiddenColumns.push(t.headerText)):(this._visibleColumns.push(t.headerText),t.visible=!0);n.isNullOrUndefined(t.headerTemplate)||a.parent().addClass("e-headertemplate");this.initialRender&&(typeof t.width=="string"&&t.width.indexOf("%")!=-1?this._columnsWidthCollection.push(n.parseInt(t.width)/100*this.element.width()):this._columnsWidthCollection.push(t.width))}return l.append(g),o.append(b).append(l),k.append(nt),o.append(k),c.append(o),this.setHeaderContent(e),this.setHeaderTable(o),e},r.prototype._renderContent=function(){var i=n.buildTag("div.e-kanbancontent","",{},{}),r=n.buildTag("div","",{},{}),f=n.buildTag("tbody","",{},{}),t=n.buildTag("table.e-table","",{},{cellspacing:"0.25px",role:"kanban"}),u;return t.append(this.getHeaderTable().find("colgroup").clone()).append(f),r.append(t),i.append(r),this.setContent(i),this.setContentTable(t),t.attr("role","kanban"),u={requestType:"refresh"},this.sendDataRenderingRequest(u),i},r.prototype.refreshTemplate=function(){this._addInitTemplate();(this.model.editSettings.allowEditing||this.model.editSettings.allowAdding)&&this.KanbanEdit._addDialogEditingTemplate()},r.prototype.getContentTable=function(){return this.contentTable},r.prototype.setContentTable=function(n){this.contentTable=n},r.prototype.getVisibleColumnNames=function(){return this._visibleColumns},r.prototype.getHeaderContent=function(){return this.headerContent},r.prototype.setHeaderContent=function(n){this.headerContent=n},r.prototype.getContent=function(){return this.kanbanContent},r.prototype.setContent=function(n){this.kanbanContent=n},r.prototype._initDataSource=function(){var t=this,i;this._isLocalData=!(this._dataSource()instanceof n.DataManager)||this._dataSource().dataSource.offline;this._ensureDataSource();this._trigger("actionBegin");i=this._dataSource().executeQuery(this.model.query);this.element.is(":visible")||this.element.ejWaitingPopup("hide");i.done(n.proxy(function(n){t.element.ejWaitingPopup("hide");t._currentJsonData=t.currentViewData=n.result;t._recordsCount=n.count==0&&n.result.length?n.result.length:n.count;t._initKanbanRender()}))},r.prototype._stackedHeadervisible=function(){for(var t=this.element.find(".e-columnheader .e-stackedHeaderCell "),n=0;n<t.length;n++)t[n].offsetWidth<t[n].scrollWidth&&t.eq(n).find("div").addClass("e-hide")},r.prototype._renderContext=function(){var h,c,l,o,i,r,t,f,v,a,u,y,s,e;for(h=this.model.contextMenuSettings.menuItems,u=n.buildTag("ul","",{},{id:this._id+"_Context"}),y=this.model.contextMenuSettings.disableDefaultItems,t=0;t<h.length;t++)i=h[t].menuItem,$.inArray(i,y)==-1&&(r=this._items(i,"menuItem")),u.append(r);for(s=this.model.contextMenuSettings.customMenuItems,f=0;f<s.length;f++)v=s[f].text,a=this._items(v,"custom"),s[f].template&&a.append($(s[f].template)),u.append(a);for(e=n.buildTag("ul","",{},{id:this._id+"_SubContext"}),t=0;t<this.model.columns.length;t++)i=this.model.columns[t].headerText,c=n.buildTag("div","",{},{"class":"e-visiblecolumns"}),l=n.buildTag("input","",{},{type:"checkbox",name:i}),r=this._items(i,"subMenuItem"),c.append(l),r.prepend(c),e.append(r),l.ejCheckBox({checked:this.model.columns[t].visible});if($(u).find("li.e-column.e-visiblecolumn").append(e),this.model.fields.swimlaneKey){for(e=n.buildTag("ul","",{},{id:this._id+"_SubContext"}),o=this._dataManager.executeLocal((new n.Query).select(this.model.fields.swimlaneKey)),o=n.dataUtil.mergeSort(n.dataUtil.distinct(o,this.model.fields.swimlaneKey),this.model.fields.swimlaneKey),t=0;t<o.length;t++)i=o[t],r=this._items(i,"subMenuItem"),e.append(r);$(u).find("li.e-move.e-swimlane").append(e)}$(u).ejMenu({menuType:n.MenuType.ContextMenu,openOnClick:!1,contextMenuTarget:"#"+this._id,click:$.proxy(this._clickevent,this),width:"auto",cssClass:"e-kanban-context",beforeOpen:$.proxy(this._menu,this),open:$.proxy(this._contextopen,this)});this._conmenu=u.data("ejMenu")},r.prototype._contextopen=function(){var n=this._conmenu.element;n.length>0&&(n.find("li").is(":visible")||n.css("visibility","hidden"))},r.prototype._clickevent=function(t){var f,u,i,r,e,o,s;if(f=t.parentText!=null?t.parentText:t.events.text,u=$(this._contexttarget),t.targetelement=this._contexttarget,i=u.closest(".e-kanbancard"),r=i.length,!this._trigger("contextClick",t))switch(f){case"Add Card":this._isAddNewClick=!0;this._newCard=$(this._contexttarget);this.KanbanEdit.addCard();break;case"Edit Card":r>0&&!n.isNullOrUndefined(this.model.fields.primaryKey)&&this.KanbanEdit.startEdit(i);break;case"Hide Column":u.closest(".e-headercell").find(".e-headercelldiv").length>0&&this.hideColumns(u.closest(".e-headercell").find(".e-headercelldiv .e-headerdiv").text().trim().split("[")[0]);break;case"Delete Card":!n.isNullOrUndefined(this.model.fields.primaryKey)&&i.length>0&&this.KanbanEdit.deleteCard(i.attr("id"));break;case"Move Right":r>0&&this.KanbanDragAndDrop._dropToColumn($(this._contexttarget).closest("td.e-rowcell").next(),i);break;case"Move Left":r>0&&this.KanbanDragAndDrop._dropToColumn($(this._contexttarget).closest("td.e-rowcell").prev(),i);break;case"Move Up":r>0&&this.KanbanDragAndDrop._dropAsSibling(i.prev(),i,!1);break;case"Move Down":r>0&&this.KanbanDragAndDrop._dropAsSibling(i.next(),i,!0);break;case"Top of Row":r>0&&this.KanbanDragAndDrop._dropAsSibling(u.closest("td.e-rowcell").find(".e-kanbancard").first(),i,!1);break;case"Bottom of Row":r>0&&this.KanbanDragAndDrop._dropAsSibling(u.closest("td.e-rowcell").find(".e-kanbancard").last(),i,!0);break;case"Move Swimlane":f!=t.text&&r>0&&(e=u.closest(".e-kanbancard").attr("id"),o=new n.DataManager(this._currentJsonData).executeLocal((new n.Query).where(this.model.fields.primaryKey,n.FilterOperators.equal,e))[0],o[this.model.fields.swimlaneKey]=t.text,this.updateCard(e,o));break;case"Visible Columns":f!=t.text&&(s=$(t.element.parentElement).find("li").index(t.element),this.model.columns[s].visible?(this.hideColumns(t.text),$($(t.element).find("input.e-checkbox")).ejCheckBox({checked:!1})):(this.showColumns(t.text),$($(t.element).find("input.e-checkbox")).ejCheckBox({checked:!0})))}},r.prototype._menu=function(t){var i,f,l,p,a,e,w,o,u,s,r,v,h,y,c;if(i=this._conmenu.element,this._contexttarget=t.target,f=$(t.target),l=$(this._contexttarget).closest("td.e-rowcell"),p=$(this._contexttarget).closest("tr.e-columnrow"),a=f.closest(".e-rowcell"),e=$(f).closest(".e-kanbancard"),w=this.model.contextMenuSettings.menuItems,i.css("visibility","visible"),i.find("li").hide(),f.closest(".e-kanban").attr("id")!==this._id){i.css("visibility","hidden");return}if(i.find(".e-customitem").length>0)for(o=this.model.contextMenuSettings.customMenuItems,u=i.find(".e-customitem"),r=0;r<u.length;r++)if(o[r].target||(o[r].target="all"),o[r].target&&o[r].text==i.find(".e-customitem").children("a").eq(r).text())switch(o[r].target){case"content":this.getContentTable().find(f).length>0?($(u[r]).show(),$(u[r]).find("li").length>0&&$(u[r]).find("li").show()):$(u[r]).hide();break;case"header":this.getHeaderContent().find(f).length>0?($(u[r]).show(),$(u[r]).find("li").length>0&&$(u[r]).find("li").show()):$(u[r]).hide();break;case"card":this.element.find(".e-kanbancard").find(f).length>0?($(u[r]).show(),$(u[r]).find("li").length>0&&$(u[r]).find("li").show()):$(u[r]).hide();break;case"all":$(u[r]).show();$(u[r]).find("li").length>0&&$(u[r]).find("li").show()}if(this.getContentTable().find(f).length>0){if(a.length==0){i.css("visibility","hidden");return}if($(f).closest(".e-swimlanerow").length>0){i.css("visibility","hidden");return}e.length>0?(y=$(f).closest("td.e-rowcell").find(".e-kanbancard"),h=y.index(e),v=y.length,$(i.find("li").not(".e-customitem")).hide(),$(i.find(".e-customitem li")).show(),!n.isNullOrUndefined(this.model.fields.primaryKey)&&this.model.editSettings.allowEditing&&i.find(".e-content.e-cardedit").show(),h>1&&i.find(".e-move.e-up").show(),h!=v-1&&i.find(".e-row.e-bottom").show(),h!=0&&i.find(".e-row.e-top").show(),v-1-h>1&&i.find(".e-move.e-down").show(),l.next().length>0&&i.find(".e-move.e-right").show(),l.prev().length>0&&i.find(".e-move.e-left").show(),n.isNullOrUndefined(this.model.fields.primaryKey)||i.find(".e-content.delete").show(),this.model.fields.swimlaneKey&&this.model.fields.primaryKey&&i.find(".e-move.e-swimlane.e-target").length<0&&(i.find(".e-move.e-swimlane").show(),i.find(".e-move.e-swimlane").find("li").show(),i.find(".e-move.e-swimlane").find("li").eq(this._columnRows.index(p)).hide())):a.length>0&&($(i.find("li").not(".e-customitem")).hide(),$(i.find(".e-customitem li")).show(),this.model.editSettings.allowAdding&&i.find(".e-add").show())}else if(this.getHeaderContent().find(f).length>0)if(c=i.find(".e-column"),$(f).closest(".e-headercell").not(".e-stackedHeaderCell").length>0){for($(i.find("li").not(".e-customitem")).hide(),$(i.find(".e-customitem li")).show(),$(i.find("li.e-haschild").find("li")).show(),c.show(),s=0;s<i.find(".e-column.e-visiblecolumn").find("li").length;s++)this.element.find(".e-headercell").not(".e-stackedHeaderCell").eq(s).hasClass("e-hide")?c.find("li input.e-checkbox").eq(s).ejCheckBox({checked:!1}):c.find("li input.e-checkbox").eq(s).ejCheckBox({checked:!0});c.find("li").show()}else{i.css("visibility","hidden");return}else{i.css("visibility","hidden");return}this.model.contextOpen&&(t.card=e,t.index=e.parent(".e-rowcell").find(".e-kanbancard").index(e),t.cellIndex=e.parent(".e-rowcell").index(),t.rowIndex=this.getIndexByRow(e.parents(".e-columnrow")),t.cardData=this._getKanbanCardData(this._currentJsonData,e.attr("id"))[0],this._trigger("contextOpen",t))},r.prototype._items=function(t,i){var r,u,f;return t==""||n.isNullOrUndefined(t)?!1:(i=="menuItem"?t.indexOf("Card")!=-1?(r=n.buildTag("li","",{},{"class":"e-content"}),r.css("display","none"),t.indexOf("Add")!=-1&&r.addClass("e-add"),t.indexOf("Edit")!=-1&&r.addClass("e-cardedit"),t.indexOf("Delete")!=-1&&r.addClass("delete"),r.css("display","none")):t.indexOf("Column")!=-1||t.indexOf("Columns")!=-1?(r=n.buildTag("li","",{},{"class":"e-column"}),t.indexOf("Hide")!=-1&&r.addClass("e-hidecolumn"),t.indexOf("Visible")!=-1&&r.addClass("e-visiblecolumn"),r.css("display","none")):t.indexOf("Row")!=-1?(r=n.buildTag("li","",{},{"class":"e-row"}),t.indexOf("Top")!=-1?r.addClass("e-top"):r.addClass("e-bottom"),r.css("display","none")):t.indexOf("Move")!=-1&&(r=n.buildTag("li","",{},{"class":"e-move"}),t.indexOf("Left")!=-1?r.addClass("e-left"):t.indexOf("Right")!=-1?r.addClass("e-right"):t.indexOf("Up")!=-1?r.addClass("e-up"):t.indexOf("Down")!=-1?r.addClass("e-down"):t.indexOf("Swimlane")!=-1&&r.addClass("e-swimlane"),r.css("display","none")):i=="subMenuItem"?r=n.buildTag("li","",{},{}):i=="custom"&&(r=n.buildTag("li","",{},{"class":"e-customitem"}),r.css("display","block")),u=document.createElement("a"),f="",f=t.indexOf("Move")!=-1?t.split(" ")[1].toLowerCase():t.split(" ")[0].toLowerCase(),u.innerHTML=t,$(u).append(n.buildTag("span","",{},{"class":"e-kanbancontext e-icon e-context"+f})),r.append(u),r)},r.prototype.columns=function(t,i,r){var f,u,e,s,o,h;if(!n.isNullOrUndefined(t)){for(f=!1,typeof t=="string"?(t=[t],f=!0):t instanceof Array&&t.length&&typeof t[0]=="string"&&(f=!0),u=0;u<t.length;u++)e=$.inArray(this.getColumnByHeaderText(f?t[u]:t[u].headerText),this.model.columns),r=="add"||n.isNullOrUndefined(r)?e==-1?this.model.columns.push(f?{headerText:t[u],key:i}:t[u]):this.model.columns[e]=f?{headerText:t[u],key:i}:t[u]:e!=-1&&this.model.columns.splice(e,1);for(s=this.element.find(".e-kanbanheader"),this._columnsWidthCollection=[],o=0;o<this.model.columns.length;o++)n.isNullOrUndefined(this.model.columns[o].width)||this._columnsWidthCollection.push(this.model.columns[o].width);this.element[0].replaceChild(this._renderHeader()[0],s[0]);this._addColumnFilters();h={requestType:"addcolumn"};this._ensureDataSource(h);this._renderAllCard();this.refresh(!0);this._refreshHeaderScroller();this._totalCount()}},r.prototype._checkDataBinding=function(){var t,i;(this.model.columns.length||(this._dataSource()!=null&&this._dataSource().length||this._dataSource()instanceof n.DataManager)&&(!(this._dataSource()instanceof n.DataManager)||this._dataManager.dataSource.url!=undefined||this._dataSource().dataSource.json.length))&&(n.isNullOrUndefined(this.model.keyField)||this._addColumnFilters(),this.initialRender=!0,this.model.cssClass!=null&&this.element.addClass(this.model.cssClass),(this.model.filterSettings.length>0||this.model.allowSearching||this.model.customToolbarItems)&&this.element.append(this._renderToolBar()),t=this.model.columns,t&&t.length&&(this.element.append(this._renderHeader()),this._stackedHeadervisible()),$.isFunction($.fn.ejWaitingPopup)&&(this.element.ejWaitingPopup({showOnInit:!1}),$("#"+this._id+"_WaitingPopup").addClass("e-kanbanwaitingpopup")),this.model.contextMenuSettings.enable&&this._renderContext(),this._dataSource()instanceof n.DataManager?(this.element.ejWaitingPopup("show"),this._dataSource().ready!=undefined?(i=this,this._dataSource().ready.done(function(t){i._initDataSource();i.model.dataSource=new n.DataManager(t.result)})):(this.element.ejWaitingPopup("show"),this._initDataSource())):(this._trigger("actionBegin"),this._ensureDataSource(),this._initKanbanRender(),this._enableKanbanRTL()))},r.prototype._renderToolBar=function(){var i=n.buildTag("div.e-kanbantoolbar","",{},{id:this._id+"_toolbarItems"}),f,u,o,t,l;if(this.model.allowSearching){this._isWatermark="placeholder"in document.createElement("input");var e=n.buildTag("ul.e-searchbar","",{},{}),r=n.buildTag("li.e-search","",{},{id:this._id+"_toolbarItems_search"}),a=n.buildTag("a.e-searchitem e-toolbaricons e-disabletool e-icon e-searchfind","",{position:"absolute"},{}),s=n.buildTag("input.e-ejinputtext e-input","",{},{type:"text",id:this._id+"_searchbar",placeholder:"Search",height:"33px"}),h=n.buildTag("div.e-searchdiv","",{display:"inline-table",width:"83%"},{});h.append(s);r.append(h);r.append(a);e.append(r);this._searchInput=s;n.isNullOrUndefined(this.model.searchSettings.key)||this._searchInput.val(this.model.searchSettings.key);this._searchBar=r;this._isWatermark||(this._hiddenSpan=n.buildTag("span.e-input e-placeholder","Search",{display:"block"},{}).insertAfter(this._searchInput))}for(n.isNullOrUndefined(this.model.customToolbarItems)||(f=n.buildTag("ul.e-customtoolbar"),this.model.filterSettings.length>0&&f.addClass("e-customtoolbarseparator"),!n.isNullOrUndefined(this.model.customToolbarItems)&&this.model.customToolbarItems.length&&this._renderCustomLi(f),i.append(f)),this.model.filterSettings.length>0&&(u=n.buildTag("ul","",{},{}),o=n.buildTag("li","",{},{"class":"e-quickfilter",tabindex:"0"}),o.append("<label class='e-toolbartext e-text'>"+this.localizedLabels.FilterSettings+"<\/label>"),u.append(o)),t=0;t<this.model.filterSettings.length;t++){var c=this.model.filterSettings[t].description,r=n.buildTag("li","",{},{id:this._id+"_"+this.model.filterSettings[t].text,title:n.isNullOrUndefined(c)?this.model.filterSettings[t].text:c,tabindex:"0"}),v=n.buildTag("a.e-toolbartext e-text",this.model.filterSettings[t].text,{},{});r.append(v);u.append(r)}return n.isNullOrUndefined(u)||i.append(u),n.isNullOrUndefined(e)||i.append(e),l={click:this._onToolbarClick},i.ejToolbar(l),this._filterToolBar=i,i},r.prototype._renderCustomLi=function(t){for(var r,u,f,i=0;i<this.model.customToolbarItems.length;i++){u=this.model.customToolbarItems[i].template?this.model.customToolbarItems[i].template.replace("#",""):this.model.customToolbarItems[i];r=n.buildTag("li","",{},{id:this._id+"_"+u,title:u});switch(typeof this.model.customToolbarItems[i]){case"string":f=n.buildTag("a.e-toolbaricons e-icon","",{}).addClass(this.model.customToolbarItems[i].text);break;case"object":r.attr("title",this.model.customToolbarItems[i].template.replace("#",""));f=$(this.model.customToolbarItems[i].template).hide().html()}r.html(f);t.append(r)}},r.prototype.dataSource=function(n,t){t&&(this._templateRefresh=!0);this._dataSource(n);this._refreshDataSource(n);this._addLastRow()},r.prototype._refreshDataSource=function(t){this._dataManager=t instanceof n.DataManager?t:new n.DataManager(t);this._isLocalData=!(this._dataSource()instanceof n.DataManager)||this._dataManager.dataSource.offline||this._isRemoteSaveAdaptor;this.refresh(!0)},r.prototype._ensureDataSource=function(t){var i,e,u,r,h,y,c,o,l,f,a,s,v;if(this._dataSource()==null&&!(this._dataSource()instanceof n.DataManager)){if(n.isNullOrUndefined(t)||t.requestType!="add")return;this.dataSource([],!1)}if(this.model.query.requiresCount(),i=this.model.query,f=i.clone(),this._dataSource()instanceof n.DataManager||(this._currentJsonData=this.currentViewData=this._dataSource()),this.model.filterSettings.length&&!n.isNullOrUndefined(t)&&t.requestType=="filtering"||!n.isNullOrUndefined(t)&&t.requestType=="search"||this.model.searchSettings.key.length){for(i.queries=i.queries.slice(i.queries.length),this.model.searchSettings.key.length!=0&&(u=this.model.searchSettings,u.fields.length==0&&(n.isNullOrUndefined(this.model.fields.content)||u.fields.push(this.model.fields.content),n.isNullOrUndefined(this.model.fields.swimlaneKey)||u.fields.push(this.model.fields.swimlaneKey),n.isNullOrUndefined(this.model.fields.primaryKey)||u.fields.push(this.model.fields.primaryKey),n.isNullOrUndefined(this.model.fields.title)||u.fields.push(this.model.fields.title)),i.search(u.key,u.fields,u.operator||"contains",u.ignoreCase)),r=0;r<this._filterCollection.length;r++)e=e!=undefined?e.and(this._filterCollection[r]):this._filterCollection[r];for(i.where(n.Predicate.or(this.keyPredicates)),r=0;r<i.queries.length;r++)i.queries[r].fn=="onWhere"&&e&&(i.queries[r].e=i.queries[r].e.and(e));this._isLocalData&&(this._filteredRecords=this._dataManager.executeLocal(i).result,this._filteredRecordsCount=this._filteredRecords.length);this._isLocalData&&this.model.filterSettings.length==0&&(!n.isNullOrUndefined(this._filteredRecordsCount)||this._filteredRecordsCount>0)&&(this._filteredRecordsCount=null,this._filteredRecords=[])}this._isLocalData&&(this.model.editSettings.allowEditing||this.model.editSettings.allowAdding)&&(!n.isNullOrUndefined(this._cModifiedData)||!n.isNullOrUndefined(this._cAddedRecord))&&(n.isNullOrUndefined(this._cAddedRecord)?(i=i.where(this.model.fields.primaryKey,n.FilterOperators.equal,t.primaryKeyValue),h=this._dataManager.executeLocal(i),y=this._dataSource()instanceof n.DataManager?$.extend(this._dataSource().dataSource.json[$.inArray(h.result[0],this._dataSource().dataSource.json)],this._cModifiedData):$.extend(this._dataSource()[$.inArray(h.result[0],this._dataSource())],this._cModifiedData),t.data=y):(c=this._cAddedRecord,this._cAddedRecord=null,this._dataSource()instanceof n.DataManager?this._dataSource().dataSource.json.push(c):this._dataSource(undefined,!0).splice(this._dataSource().length,0,c)),i.queries=f.queries);t&&t.requestType=="delete"&&!n.isNullOrUndefined(this._cDeleteData)&&this._isLocalData&&(this._dataSource()instanceof n.DataManager?(o=$.inArray(this._cDeleteData[0],this._dataSource().dataSource.json),this._dataSource().dataSource.json.splice(o,1)):(o=$.inArray(this._cDeleteData[0],this._dataSource()),this._dataSource(undefined,!0).splice(o,1)));this._cloneQuery=i.clone();this._isLocalData&&(!n.isNullOrUndefined(t)&&(t.requestType=="addcolumn"||t.requestType=="refresh")&&this._filterCollection.length<=0&&!n.isNullOrUndefined(this._searchInput)&&this._searchInput.val().length<=0?(f=i.clone(),f.queries=[],f.where(n.Predicate.or(this.keyPredicates)),l=f):l=i,a=this._dataManager.dataSource.json,s=this._dataSource().dataSource,!n.isNullOrUndefined(s)&&this._dataSource()instanceof n.DataManager&&(this._dataManager.dataSource.json=a!=s.json?s.json:a),v=this._dataManager.executeLocal(l),this.currentViewData=this._currentJsonData=v.result,this._recordsCount=v.count)},r.prototype._addColumnFilters=function(){for(var r=this.model.columns,t=[],u=this.model.query,i=0;i<r.length;i++)n.isNullOrUndefined(r[i].key)||t.push(new n.Predicate(this.model.keyField,n.FilterOperators.equal,r[i].key,!0));t.length>0&&u.where(n.Predicate.or(t));this.keyPredicates=t},r.prototype._getMetaColGroup=function(){for(var i,r=n.buildTag("colgroup","",{},{}),t=0;t<this.model.columns.length;t++)i=$(document.createElement("col")),this.model.allowToggleColumn&&this.model.columns[t].isCollapsed===!0&&i.addClass("e-shrinkcol"),this.model.columns[t].visible===!1&&i.addClass("e-hide"),r.append(i);return r},r.prototype.refresh=function(n){n&&this.refreshTemplate();this._processBindings({requestType:"refresh"})},r.prototype.sendDataRenderingRequest=function(t){this._templateRefresh&&(this.refreshTemplate(),this._templateRefresh=!1);var i=this.model.query,r=i.clone();if(this.currentViewData!=null&&this.currentViewData.length){switch(t.requestType){case"save":this._updateGroup(t.primaryKeyValue,t.data);case"delete":case"refresh":case"search":case"filtering":case"cancel":this.getContentTable().find("colgroup").first().replaceWith(this._getMetaColGroup());n.isNullOrUndefined(this.model.fields.swimlaneKey)||(i=i.group(this.model.fields.swimlaneKey),this.currentViewData.GROUPGUID||(this.currentViewData=new n.DataManager(this.currentViewData).executeLocal(i).result));this._renderAllCard();this._enableSwimlaneCount=!0;this._swimlaneLimit(t);this._eventBindings();break;case"beginedit":case"add":this.KanbanEdit._editAdd(t)}i.queries=r.queries}else this.getContentTable().find("tbody").empty().first().append(this._getEmptyTbody());(this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate")&&(this._editForm=this.element.find(".e-externalform"),this.KanbanEdit._formFocus());("beginedit"==t.requestType||"add"==t.requestType)&&(this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="externalform")&&this.KanbanEdit._refreshEditForm(t);this._renderComplete(t);this._newData=null},r.prototype._renderAllCard=function(){var t=document.createElement("div");t.innerHTML=["<table>",$.render[this._id+"_JSONTemplate"]({columns:this.model.columns,dataSource:this.currentViewData}),"<\/table>"].join("");n.isNullOrUndefined(t.firstChild)||n.isNullOrUndefined(t.firstChild.lastChild)||this.getContentTable().get(0).replaceChild(t.firstChild.lastChild,this.getContentTable().get(0).lastChild);this._cardCollapse();this._selectionOnRerender()},r.prototype._processBindings=function(t){if(t.primaryKey=this.model.fields.primaryKey,!this._checkSkipAction(t)&&this._trigger("actionBegin",t))return!0;if(this._ensureDataSource(t),this._editForm=this.element.find(".kanbanform"),t.requestType=="beginedit"||this._editForm.length==0||(this._editForm.length>1&&t.requestType=="save"&&t.action=="edit"&&(this._editForm=$(this._editForm[0])),$(this._editForm).find("select.e-dropdownlist").ejDropDownList("destroy"),$(this._editForm).find("textarea.e-rte").ejRTE("destroy"),$(this._editForm).find(".e-datepicker").ejDatePicker("destroy"),$(this._editForm).find(".e-datetimepicker").ejDateTimePicker("destroy"),$(this._editForm).find(".e-numerictextbox").ejNumericTextbox("destroy"),$(this._editForm).addClass("e-formdestroy")),t&&t.requestType=="delete"&&t.div.remove(),this._dataSource()instanceof n.DataManager&&t.requestType!="beginedit"&&t.requestType!="cancel"&&t.requestType!="add"){this.element.ejWaitingPopup("show");var r=this._queryPromise=this._dataSource().executeQuery(this.model.query),i=this;i._dataSource().ready?i._dataSource().ready.done(function(){i._processDataRequest(i,t,r)}):i._processDataRequest(i,t,r)}else this.sendDataRenderingRequest(t)},r.prototype._processDataRequest=function(t,i,r){r.done(n.proxy(function(n){t.element.ejWaitingPopup("hide");t._currentJsonData=t.model.currentViewData=n.result==null?[]:n.result;t._processData(n,i)}));r.fail(n.proxy(function(n){t.element.ejWaitingPopup("hide");i.error=n.error;n=[];t.model.currentViewData=[];t._processData(n,i);t._trigger("actionFailure",i)}))},r.prototype._processData=function(t,i){n.isNullOrUndefined(this.model.filterSettings)||(i.requestType=="filtering"||this.model.filterSettings.length>0&&i.requestType=="refresh")&&(this._filteredRecordsCount=t.count);this.sendDataRenderingRequest(i)},r.prototype._editEventTrigger=function(n){if(n.requestType=="save"||n.requestType=="delete"){var t={data:n.data,action:n.action!==undefined?n.action:n.requestType};this._trigger("end"+t.action.charAt(0).toUpperCase()+t.action.slice(1),t)}},r.prototype._renderComplete=function(n){n.requestType!="beginedit"&&this._setWidthToColumns();(n.requestType=="save"||n.requestType=="cancel")&&(this._isAddNew=!1);("delete"==n.requestType||"save"==n.requestType)&&this._editEventTrigger(n);this._tableBEle=this.getContentTable().get(0);this._kanbanRows=this._tableBEle.rows;this._columnRows=$(this._kanbanRows).not(".e-swimlanerow");this.model.allowScrolling&&!this.initialRender&&this.getContentTable().find("tr:last").find("td").addClass("e-lastrowcell");this._trigger("actionComplete",n);!this.initialRender&&this.model.allowScrolling&&(n.requestType=="add"||n.requestType=="cancel"||n.requestType=="save"||n.requestType=="delete"||n.requestType=="filtering"||n.requestType=="refresh")&&this._refreshScroller(n);(n.requestType=="cancel"||n.requestType=="delete")&&(this._renderLimit(),this._totalCount());n.requestType=="filtering"&&this._filterLimitCard(n);this.model.allowDragAndDrop&&this.KanbanDragAndDrop&&this.KanbanDragAndDrop._addDragableClass()},r.prototype._enableKanbanRTL=function(){this.model.enableRTL?this.element.addClass("e-rtl"):this.element.removeClass("e-rtl")},r.prototype._createTemplate=function(n,t){var i=document.createElement("script");return i.id=this._id+t+"_Template",i.type="text/x-jsrender",i.text=n,$("body").append(i),i},r.prototype._addInitTemplate=function(){var t=this,i={},u=!n.isNullOrUndefined(t.model.keyField),f=n.browserInfo().name=="msie"&&n.parseInt(n.browserInfo().version,10)==8,e=this.model.allowToggleColumn,r=!n.isNullOrUndefined(t.model.fields.swimlaneKey);this._slTemplate="";i[t._id+"Object"]=this;i["_"+t._id+"columnKeys"]=this._getColumnKeyItems;i["_"+t._id+"tagItems"]=this._gettagItems;i["_"+t._id+"colorMaps"]=this._getColorMaps;i["_"+t._id+"getId"]=this._removeIdSymbols;i["_"+t._id+"getData"]=this._columnData;i["_"+t._id+"getCardCount"]=this._columnCardcount;i["_"+t._id+"getStatus"]=this._columnStatus;$.views.helpers(i);r&&(this._slTemplate+="{{for dataSource ~columns=columns ~ds=dataSource}}",this._slTemplate+="<tr id='{{: ~_"+t._id+"getId(key)}}' class='e-swimlanerow' role='kanbanrow'><td class='e-rowcell' role='kanbancell'  colspan='"+t.getVisibleColumnNames().length+"'><div class='e-slexpandcollapse'><div class='e-icon e-slexpand'><\/div><\/div><div class='e-slkey'>{{:key}}<\/div>{{if "+this.model.swimlaneSettings.showCount+"}}<div class='e-slcount'>"+t.localizedLabels.SwimlaneCaptionFormat+"<\/div>{{/if}}<\/td><\/tr>");this._slTemplate+="<tr class='e-columnrow' role='kanbanrow'>";this._slTemplate+=r?"{{for ~columns ~items=#data.items}}":"{{for columns}}";this._slTemplate+="<td ej-mappingkey='{{:key}}' class='e-rowcell {{if !#data.visible}}  e-hide {{/if}}{{if (#data.isCollapsed && "+e+")}}e-shrink{{/if}}'role='kanbancell'>{{if "+u+"}}{{for ~_"+t._id+"columnKeys('"+t._id+"Object')}}";this._slTemplate+=this._cardCustomization()+"{{/for}}{{/if}}{{if "+this.model.allowToggleColumn+"}}<div class='e-shrinkheader{{if "+f+"}} IE{{/if}}{{if !#data.isCollapsed}}  e-hide {{/if}}'>{{:headerText}}<div class='e-shrinklabel'>[<div class='e-shrinkcount'>{{:~_"+t._id+"getCardCount(~root.dataSource,key,#parent.parent.getIndex()) }}<\/div>]<\/div><\/div>{{/if}}{{if "+this.model.editSettings.allowAdding+"}}{{if #data.showAddButton}} <div class='e-customaddbutton{{if #data.isCollapsed}}  e-hide {{/if}}'><div class='e-columnadd e-icon'><\/div><\/div>{{/if}}{{/if}}<\/td>{{/for}}<\/tr>";r&&(this._slTemplate+="{{/for}}");this.templates[this._id+"_JSONTemplate"]=$.templates(this._createTemplate(this._slTemplate,"_swinlaneContent"));this.templates[this._id+"_cardTemplate"]=$.templates(this._createTemplate(this._cardTemplate,"_cardTemplate"));$.templates(this.templates)},r.prototype._cardCustomization=function(){var i=this,u=this.model.allowToggleColumn,r=this.model.cardSettings.template?!0:!1,f=this.model.fields.imageUrl?!0:!1,t=this.model.fields,s=!n.isNullOrUndefined(t.title),e=t.title?t.title:t.primaryKey?t.primaryKey:null,o=!n.isNullOrUndefined(t.tag)||!n.isNullOrUndefined(t.content);return this._cardTemplate="<div id='{{:"+i.model.fields.primaryKey+"}}' class='e-kanbancard {{if ~_"+i._id+"getData(#parent)  && "+u+" }}e-hide{{/if}} {{if "+r+"}}e-templatecell{{/if}}'{{if "+t.color+" }} style='{{if "+i.model.enableRTL+"}}border-right-color{{else}}border-left-color{{/if}}:{{for  ~_"+i._id+"colorMaps('"+i._id+"Object',"+t.color+")}}{{:#data}}{{/for}}'{{/if}}>{{if "+r+"}}"+$(i.model.cardSettings.template).html()+"{{else}}{{if "+i.model.allowTitle+"}}<div class='e-cardheader'><div class='e-primarykey'>{{:"+e+"}}<\/div><div class='e-expandcollapse'><div class='e-icon e-cardexpand'><\/div><\/div><\/div>{{/if}}<div class='e-cardcontent'><table class='e-cardtable'><tbody><tr><td class='e-contentcell'>{{if "+o+"}}<div class='e-innercontent'><div class='e-text'>{{:"+t.content+"}}<\/div>{{if "+t.tag+"}}{{for ~_"+i._id+"tagItems("+t.tag+")}}{{:#data}}{{/for}}{{/if}}<\/div>{{/if}}<\/td><td class='e-imagecell'>{{if "+f+" }} <div class='e-card_image'>{{if "+t.imageUrl+"}}<img class='e-image' src='{{:"+t.imageUrl+"}}'><\/img>{{else}}<div class='e-image e-no-user'><\/div>{{/if}}{{/if}}<\/td><\/tr><\/tbody><\/table><\/div>{{/if}}<\/div><\/div>",this._cardTemplate},r.prototype._removeIdSymbols=function(n){return n.replace(/[-\s']/g,"_")},r.prototype._columnStatus=function(n){var t=this.getRsc("helpers",n),i=t.getBrowserDetails();return i.browser=="msie"?!0:!1},r.prototype._setModel=function(t){var i,u,f,r;for(i in t)switch(i){case"columns":f=t.columns;this.model.columns=[];this.columns(f,"add");break;case"cssClass":this.element.removeClass(this.model.cssClass).addClass(t[i]);break;case"filterSettings":i=="filterSettings"&&(this.model.filterSettings=t[i]);this.model.filterSettings.length>0?(this.element.find(".e-kanbantoolbar").remove(),this._filterCollection=[],this._renderToolBar().insertBefore(this.element.find(".e-kanbanheader").first())):(this.element.find(".e-kanbantoolbar").remove(),this.model.filterSettings=[],this._filterCollection=[],this.refresh());break;case"allowHover":this.model.allowHover=t[i];this._enableCardHover();break;case"enableRTL":this.model.enableRTL=t[i];this._enableKanbanRTL();this.refresh(!0);this._refreshScroller({requestType:"refresh"});break;case"tooltipSettings":$.extend(this.model.tooltipSettings,t[i]);!n.isNullOrUndefined(this.model.tooltipSettings)&&this.model.tooltipSettings.enable?(this._on(this.element,"mouseover",".e-kanbancard",$.proxy(this._showToolTip,this)),this._on(this.element,"mouseout",".e-kanbancard",$.proxy(this._hideToolTip,this))):(this._off(this.element,"mouseover",".e-kanbancard"),this._off(this.element,"mouseout",".e-kanbancard"));break;case"allowScrolling":case"scrollSettings":if(u=this.getContent(),i!="allowScrolling"){if(!n.isNullOrUndefined(t.scrollSettings)){if($.isEmptyObject(t.scrollSettings))break;$.extend(this.model.scrollSettings,t.scrollSettings)}n.isNullOrUndefined(t.allowScrolling)||(this.model.allowScrolling=t.allowScrolling);n.isNullOrUndefined(u.data("ejScroller"))||u.ejScroller("destroy");this.model.allowScrolling?(this.getHeaderContent().find("div").first().addClass("e-headercontent"),this._originalScrollWidth=this.model.scrollSettings.width,this._renderScroller()):(this.element.children(".e-kanbanheader").removeClass("e-scrollcss"),this.element.get(0).style.width.length==0&&this.element.css("width","auto"))}break;case"allowFreezeSwimlane":this.model.scrollSettings.allowFreezeSwimlane=t[i];t[i]?this.getContent().data("ejScroller").scrollY("0"):this._freezeSwimlaneRow.remove();break;case"dataSource":u=this.element.find(".e-kanbancontent").first();this._refreshDataSource(this._dataSource());this._addLastRow();break;case"editSettings":$.extend(this.model.editSettings,t[i]);this.KanbanEdit._processEditing();this._tdsOffsetWidth=[];(this.model.editSettings.allowEditing||this.model.editSettings.allowAdding)&&(this.model.editSettings.editMode=="dialog"||this.model.editSettings.editMode=="dialogtemplate"?($("#"+this._id+"_dialogEdit").data("ejDialog")&&$("#"+this._id+"_dialogEdit").ejDialog("destroy"),$("#"+this._id+"_dialogEdit_wrapper,#"+this._id+"_dialogEdit").remove(),this.element.append(this.KanbanEdit._renderDialog())):(this.model.editSettings.editMode=="externalform"||this.model.editSettings.editMode=="externalformtemplate")&&($("#"+this._id+"_externalEdit").css("display","none"),this.element.append(this.KanbanEdit._renderExternalForm())));this._enableEditingEvents();break;case"allowSelection":t[i]&&(this._off(this.element,"click"),this._on(this.element,"click","",this._clickHandler));break;case"query":this.model.query=$.extend(!0,{},t[i]);break;case"stackedHeaderRows":i=="stackedHeaderRows"&&(this.model.stackedHeaderRows=t[i]);this.model.stackedHeaderRows.length>0?this._refreshStackedHeader():(this.element.find(".e-stackedHeaderRow").remove(),this.model.stackedHeaderRows=[]);break;case"template":this.model.cardSettings.template=t[i];this.element.find(".e-kanbancard").remove();this.refreshTemplate();this._renderAllCard();this._enableDragandScroll();break;case"allowToggleColumn":this.model.allowToggleColumn=t[i];this.refreshTemplate();this.getHeaderContent().replaceWith(this._renderHeader());this.sendDataRenderingRequest({requestType:"refresh"});this.model.allowToggleColumn||this.element.find(".e-shrinkheader").not(".e-hide").addClass("e-hide");break;case"locale":this.model.locale=t[i];r=this.model;r.query.queries=r.query.queries.slice(0,r.query.queries.length-1);this.element.ejKanban("destroy").ejKanban(r)}},r.prototype._columnCardcount=function(t,i,r){var f=0,u;if(n.isNullOrUndefined(r)){for(u=0;u<t.length;u++)t[u].Status===i&&f++;return f}for(u=0;u<t[r].items.length;u++)t[r].items[u].Status===i&&f++;return f},r.prototype._columnData=function(t){return n.isNullOrUndefined(t)?!1:t.parent.data.isCollapsed},r.prototype._getColorMaps=function(n,t){var e=this.getRsc("helpers",n),f,r=e.model.cardSettings.colorMapping,i,u;for(i in r){if(r[i].indexOf(",")==-1&&r[i]==t)return i;for(f=r[i].split(","),u=0;u<f.length;u++)if(f[u]==t)return i}},r.prototype._gettagItems=function(n){var i="<div class='e-tags'>",t;for(n=n.split(","),t=0;t<n.length;t++)i=i.concat("<div class='e-tag'>"+n[t]+"<\/div>");return i.concat("<\/div>")},r.prototype._getColumnKeyItems=function(t){var r=this.getRsc("helpers",t),f,e=this.ctx.root.dataSource,u,o=r.model.query,i=o.clone();return r._filterCollection.length<=0&&r.model.allowSearching&&r._searchInput.val().length<=0?(i.queries=[],i.where(n.Predicate.or(r.keyPredicates))):i.queries=i.queries.slice(0,i.queries.length-1),i=i.where(r.model.keyField,"equal",this.data.key),f=e.GROUPGUID?new n.DataManager(this.ctx.items).executeLocal(i).result:new n.DataManager(e).executeLocal(i).result,u=r.model.fields.priority,u&&f.sort(function(n,t){return n[u]-t[u]}),f},r.prototype._renderSingleCard=function(t,i){var r=this.element.find("div[id='"+t+"']"),u=this,f,e,h,o,s;this._dropped?(s=$.render[this._id+"_cardTemplate"](i),n.browserInfo().name=="msie"&&n.browserInfo().version=="8.0"?$(r).after(s):$(r).replaceWith(s)):(n.isNullOrUndefined(u.model.fields.swimlaneKey)?f=this.element.find(".e-columnrow:first"):(h=this._removeIdSymbols(i[u.model.fields.swimlaneKey]),o=this.element.find("tr[id='"+h+"']"),o.length>0&&(f=o.next())),e=$(f).find("td.e-rowcell[ej-mappingkey='"+i[u.model.keyField]+"']"),$(r).remove(),e.length>0&&$(e).append($.render[this._id+"_cardTemplate"](i)));this._cardCollapse();this.KanbanDragAndDrop&&this.KanbanDragAndDrop._addDragableClass();this._selectionOnRerender()},r.prototype._selectionOnRerender=function(){var s,e,t,o=!0,n=this,r,u,i,f,c,h;if(n.model.selectionType=="single")n._selectedCards.length>0&&(u=$(n._selectedCards[0]),i=n.element.find("#"+u[0].id),i.hasClass("e-kanbancard")?(e=$(i).parents(".e-columnrow"),t=$(i).parents(".e-rowcell"),n._selectedCards=[],n._selectedCards=i.addClass("e-cardselection"),n._currentRowCellIndex=n._previousRowCellIndex=[],n._currentRowCellIndex.push([e.index(),[t.index()],[t.find(".e-kanbancard").index(t.find("#"+u[0].id))]]),n._currentRowCellIndex=n._previousRowCellIndex,n.selectedRowCellIndexes=[],n.selectedRowCellIndexes.push({rowIndex:n._currentRowCellIndex[0][0],cellIndex:n._currentRowCellIndex[0][1][0],cardIndex:n._currentRowCellIndex[0][2][0]})):(n._selectedCards=n._selectedCardData=n.selectedRowCellIndexes=[],n._currentRowCellIndex=n._previousRowCellIndex=[]));else{for(r=0;r<n._selectedCards.length;r++)if($(n._selectedCards[r]).length>1)for(f=0;f<n._selectedCards[r].length;f++)u=$(n._selectedCards[r][f]),i=n.element.find("#"+u[0].id),e=$(i).parents(".e-columnrow"),t=$(i).parents(".e-rowcell"),i.hasClass("e-kanbancard")?(o=!0,n._selectedCards[r].splice(f,0,i[0]),i.addClass("e-cardselection"),n._selectedCards[r].splice(f+1,1),r==0&&f==0&&(n._currentRowCellIndex=n._previousRowCellIndex=[],n._currentRowCellIndex.push([e.index(),[t.index()],[t.find(".e-kanbancard").index(t.find("#"+u[0].id))]]),n._currentRowCellIndex=n._previousRowCellIndex,n.selectedRowCellIndexes=[]),c=[e.index(),[t.index()],[t.find(".e-kanbancard").index(t.find("#"+u[0].id))]],n._pushIntoSelectedArray([c])):(o=!1,n._selectedCards[r].splice(f,1),h=n._selectedCardData.indexOf(n._getKanbanCardData(n._selectedCardData,u[0].id)[0]),n._selectedCardData.splice(h,1),--f);else u=$(n._selectedCards[r]),i=n.element.find("#"+u[0].id),e=$(i).parents(".e-columnrow"),t=$(i).parents(".e-rowcell"),i.hasClass("e-kanbancard")?(o=!0,i.addClass("e-cardselection"),n._selectedCards[r]=i[0],r==0&&(n._currentRowCellIndex=n._previousRowCellIndex=[],n._currentRowCellIndex.push([e.index(),[t.index()],[t.find(".e-kanbancard").index(t.find("#"+u[0].id))]]),n._currentRowCellIndex=n._previousRowCellIndex,n.selectedRowCellIndexes=[]),c=[e.index(),[t.index()],[t.find(".e-kanbancard").index(t.find("#"+u[0].id))]],n._pushIntoSelectedArray([c])):(o=!1,n._selectedCards.splice(r,1),h=n._selectedCardData.indexOf(this._getKanbanCardData(n._selectedCardData,u[0].id)[0]),n._selectedCardData.splice(h,1),--r);!o&&n._selectedCards.length<=0&&(n._currentRowCellIndex=n._previousRowCellIndex=n.selectedRowCellIndexes=[])}s=n.element.find(".e-columnrow").index(n.element.find(".e-cardselection").eq(0).parents(".e-columnrow"));s>=0&&(n.selectedRowCellIndexes[0].rowIndex=n._currentRowCellIndex[0][0]=s,n._previousRowCellIndex.length>0&&(n._previousRowCellIndex[0][0]=s))},r.prototype._getKanbanCardData=function(t,i){return new n.DataManager(t).executeLocal((new n.Query).where(this.model.fields.primaryKey,n.FilterOperators.equal,i))},r.prototype._renderScroller=function(){var i,r,u,f,t,e;this.model.scrollSettings||(this.model.scrollSettings={});typeof this._originalScrollWidth=="string"&&(this.element.css("width","auto"),i=this.element.width(),(this.model.scrollSettings.width=="auto"||this._originalScrollWidth=="auto")&&(this._originalScrollWidth="100%"),this.model.scrollSettings.width=i*(n.parseFloat(this._originalScrollWidth)/100));typeof this.model.scrollSettings.height=="string"&&(r=this.element.height(),this.model.scrollSettings.height=="auto"&&(this.model.scrollSettings.height="100%"),this.model.scrollSettings.height=r*(n.parseFloat(this.model.scrollSettings.height)/100));(this.model.scrollSettings.width||this.model.width)&&this.element.width(this.model.scrollSettings.width||this.model.width);u=this.model.scrollSettings.height!=0?this.model.scrollSettings.height-this.getHeaderTable().height()-(!n.isNullOrUndefined(this._filterToolBar)&&this._filterToolBar.height()):this.model.scrollSettings.height;f=this.getContent().attr("tabindex","0");this.element.addClass("e-kanbanscroll");f.ejScroller({enableRTL:this.model.enableRTL,height:u,width:this.model.scrollSettings.width,thumbStart:function(n){var t=$(n.originalEvent.target);return t.hasClass("e-kanbancard")||t.parents(".e-kanbancard").hasClass("e-kanbancard"),!1},scroll:$.proxy(this._freezeSwimlane,this)});this.getContent().ejScroller("isVScroll")?(this.element.find(".e-kanbanheader").addClass("e-scrollcss"),this.getHeaderContent().find("div").first().addClass("e-headercontent")):this.element.find(".e-kanbanheader").removeClass("e-scrollcss");(this.model.scrollSettings.width||this.model.width)&&this.element.width(this.model.scrollSettings.width||this.model.width);t=this.getContent().data("ejScroller");e=t&&t.isVScroll()?"addClass":"removeClass";this.getHeaderContent().find(".e-headercontent")[e]("e-hscrollcss");this._refreshHeaderScroller()},r.prototype._refreshHeaderScroller=function(){var t=this;this.getContent().find(".e-content").scroll(n.proxy(function(n){t.getHeaderContent().find("div").first().scrollLeft($(n.currentTarget).scrollLeft())}),t);this.element.find(".e-kanbanheader").find(".e-headercontent").scroll(n.proxy(function(n){var i=$(n.currentTarget);t.getContent().find(".e-content").first().scrollLeft(i.scrollLeft())}),t)},r.prototype._freezeSwimlane=function(t){var v,c,f,e,l,i,r,o,y,s,a,h,u;(this._freezeSwimlaneRow=this.element.find(".e-freezeswimlanerow"),this.model.scrollSettings.allowFreezeSwimlane||this._freezeSwimlaneRow.remove(),this.model.scrollSettings.allowFreezeSwimlane&&!n.isNullOrUndefined(this.model.fields.swimlaneKey)&&(n.isNullOrUndefined(t.scrollLeft)||this._freezeSwimlaneRow.length!=0))&&(this._freezeSwimlaneRow.length<=0?(this._freezeSwimlaneRow=n.buildTag("div.e-freezeswimlanerow e-swimlanerow","<div><\/div>",{},{}),v=this.headerContent.offset().top+this.headerContent.height(),this._freezeSwimlaneRow.appendTo(this.element).css({top:v}),c=this._swimlaneRows.eq(0),this._freezeSwimlaneRow.children().append(c.find(".e-slkey,.e-slcount").clone()),this._freezeSwimlaneRow.width(this.headerContent.width()-1).height(c.height()),this._freezeSlOrder=0,f=n.buildTag("table.e-table e-freeze-table","",{},{cellspacing:"0.25px"}),f.append(this.getContentTable().find("colgroup").clone()),e=n.buildTag("tbody","",{},{}),f.append(e),e.append(this.getContentTable().find(".e-columnrow").eq(0).clone().removeClass("e-columnrow").addClass("e-collapsedrow")),l=e.find("td"),l.removeClass("e-droppable").removeAttr("ej-mappingkey").height(0),l.children().remove(),this._freezeSwimlaneRow.append(f)):(i=this.getContent().offset().top+this._freezeSwimlaneRow.height(),a=this._swimlaneRows.eq(this._freezeSlOrder),s=this._swimlaneRows.eq(this._freezeSlOrder+1),h=this._swimlaneRows.eq(this._freezeSlOrder-1),r=s.offset().top+s.height(),o=a.offset().top+a.height(),y=h.offset().top+h.height(),u=this.element.find(".e-freezeswimlanerow >div"),this._freezeScrollTop>t.scrollTop&&(o=o,i>=r&&(r=i+1)),this._freezeScrollTop<t.scrollTop&&(r=r),(t.source=="wheel"||t.source=="button")&&(this._freezeScrollTop<t.scrollTop?r=r-t.model.scrollOneStepBy:this._freezeScrollTop>t.scrollTop&&(i=i-t.model.scrollOneStepBy)),i>=r?(u.children().remove(),u.append(s.find(".e-slkey,.e-slcount").clone()),++this._freezeSlOrder):i<o&&i>y&&this._freezeSlOrder>0&&(u.children().remove(),u.append(h.find(".e-slkey,.e-slcount").clone()),--this._freezeSlOrder),t.scrollTop==0&&this._freezeSwimlaneRow.remove(),n.isNullOrUndefined(t.scrollLeft)||(u.css({left:-t.scrollLeft}),this._freezeSwimlaneRow.find("table").css({left:-t.scrollLeft}))),this._freezeScrollTop=t.scrollTop)},r.prototype._enableDragandScroll=function(){this.model.allowDragAndDrop&&this.KanbanDragAndDrop&&this.KanbanDragAndDrop._addDragableClass();this.model.allowScrolling&&(this.initialRender?(n.isNullOrUndefined(this.model.fields.swimlaneKey)||(this._swimlaneRows=this.element.find(".e-swimlanerow")),this._renderScroller()):this._refreshScroller({requestType:"refresh"}));this.model.enableTotalCount&&this._totalCount()},r.prototype._refreshScroller=function(t){var i=this.getContent().first();n.isNullOrUndefined(i.data("ejScroller"))||(t.requestType=="beginedit"&&this.getScrollObject().scrollY(0,!0),i.ejScroller("refresh"),i.ejScroller({enableRTL:this.model.enableRTL}),i.ejScroller("isVScroll")&&!this.getScrollObject().model.autoHide?(this.getHeaderContent().addClass("e-scrollcss"),this.getHeaderContent().find(".e-headercontent").hasClass("e-hscrollcss")||this.getHeaderContent().find(".e-headercontent").addClass("e-hscrollcss")):this.element.find(".e-kanbanheader").removeClass("e-scrollcss"))},r.prototype._cardCollapse=function(){var t,n,i;if(this._collapsedCards.length>0)for(t=this.element.find(".e-kanbancard"),n=0;n<t.length;n++)i=$(t[n]).find(".e-primarykey").text(),$.inArray(i,this._collapsedCards)!=-1&&this.toggleCard(i)},r.prototype._updateGroup=function(t,i){var r=this;n.isNullOrUndefined(this._saveArgs)&&new n.DataManager(r._currentJsonData).update(r.model.fields.primaryKey,i,"");$.type(i)&&!i.count&&r._renderSingleCard(t,i)},r.prototype.updateCard=function(t,i){n.isNullOrUndefined(i)&&t&&(i=new n.DataManager(this._currentJsonData).executeLocal((new n.Query).where(this.model.fields.primaryKey,n.FilterOperators.equal,t))[0]);i=n.isNullOrUndefined(i)?null:i;var f,e=i,r=this,u=this._saveArgs;this._dataSource()instanceof n.DataManager&&!this._dataManager.dataSource.offline||this._dataSource().adaptor instanceof n.remoteSaveAdaptor?(f=n.isNullOrUndefined(this._saveArgs)||this._saveArgs.action=="edit"?this._dataManager.update(this.model.fields.primaryKey,e):this._dataManager.insert(e),!n.isNullOrUndefined(f)&&$.isFunction(f.promise)&&this._dataSource()instanceof n.DataManager&&(f.done(function(f){!n.isNullOrUndefined(f)&&$.isPlainObject(f.record)&&(n.isNullOrUndefined(u)?i=f.record:(u.data=f.record,u.action=="add"&&(r._cAddedRecord=f.record),u.action=="edit"&&(r._cModifiedData=f.record)));n.isNullOrUndefined(u)?r._updateGroup(t,i):r._processBindings(u);r._cModifiedData=null;r._cAddedRecord=null;r._isAddNewClick=!1;r._currentData=null;r._newCard=null;r._saveArgs=null;r._cardEditClick=null;r._dblArgs=null}),f.fail(function(t){var i;n.isNullOrUndefined(u)?i=t:(u.error=t&&t.error?t.error:t,i=u);r._trigger("actionFailure",i)}))):n.isNullOrUndefined(this._saveArgs)?r._updateGroup(t,i):r._processBindings(this._saveArgs);f!=undefined&&$.isFunction(f.promise)||(r._cModifiedData=null,r._cAddedRecord=null,r._isAddNewClick=!1,r._currentData=null,r._newCard=null,r._saveArgs=null,r._cardEditClick=null,r._dblArgs=null)},r.prototype._eventBindings=function(){var i,t,u,r,n,f;if(this._kanbanRows=this.getContentTable().get(0).rows,i=$(this._kanbanRows).not(".e-swimlanerow"),this._currentJsonData.length!=0&&this.model.queryCellInfo!=null)for(t=0;t<i.length;t++)for(u=i[t],r=this.model.columns,n=0;n<r.length;n++)f=$(u).find(".e-rowcell")[n],this._cellEventTrigger(f,r[n])},r.prototype._cellEventTrigger=function(n,t){for(var r=$(n).find(".e-kanbancard"),i=0;i<r.length;i++){var u=r[i].id,f=this._getKanbanCardData(this._currentJsonData,u),e={card:r[i],cell:n,column:t,data:f[0]};this._trigger("queryCellInfo",e)}},r.prototype._checkSkipAction=function(n){switch(n.requestType){case"save":case"delete":return!0}return!1},r.prototype._totalCount=function(){for(var i,t=0;t<this.model.columns.length;t++)if(i=this.model.columns[t],n.isNullOrUndefined(i.constraints)&&this.model.enableTotalCount){var r=this.getHeaderContent().find("span.e-totalcount")[t],u=i.key,f=$($(this.element.find(".e-columnrow")).find("td[ej-mappingkey="+u+"]")),e=f.find(".e-kanbancard").length;$(r).text(e)}},r.prototype._renderLimit=function(){for(var t,s,h,e,o,u={},i=0;i<this.model.columns.length;i++)if(t=this.model.columns[i],!n.isNullOrUndefined(t.constraints)){s=!n.isNullOrUndefined(t.constraints.min);h=!n.isNullOrUndefined(t.constraints.max);(s||h)&&(u=this.getHeaderContent().find(".e-columnheader").not(".e-stackedHeaderRow").find(".e-headercell")[i]);e=this.getHeaderContent().find("span.e-totalcount");var c=t.key,f=$($(this.element.find(".e-columnrow")).find("td[ej-mappingkey="+c+"]")),r=0;o=f.find(".e-kanbancard").length;$(e[i]).text(o);n.isNullOrUndefined(t.constraints.type)&&(t.constraints.type="column");switch(t.constraints.type){case"column":this._validateLimit(t,u,r);break;case"swimlane":for(r=0;r<f.length;r++)this._validateLimit(t,u,r),this.getHeaderContent().find(".e-headercell").eq(i).hasClass("e-shrinkcol")||f.eq(r).find(".e-limits").removeClass("e-hide");n.isNullOrUndefined(this.model.fields.swimlaneKey)||$(u).find(".e-limits").addClass("e-hide")}}},r.prototype._getEmptyTbody=function(){var t=n.buildTag("td.e-emptycard",this.localizedLabels.EmptyCard,{},{colSpan:this.model.columns.length});return $(document.createElement("tr")).append(t)},r.prototype._getLocalizedLabels=function(){return n.getLocalizedConstants(this.sfType,this.model.locale)},r}(n.WidgetBase);n.widget("ejKanban","ej.Kanban",new i)}(n||(n={})),function(n){var t;(function(n){var t,i,r,u,f,e;n.Locale={},function(n){n[n.Filtering="filtering"]="Filtering";n[n.BeginEdit="beginedit"]="BeginEdit";n[n.Edit="edit"]="Edit";n[n.Save="save"]="Save";n[n.Add="add"]="Add";n[n.Delete="delete"]="Delete";n[n.Cancel="cancel"]="Cancel";n[n.Refresh="refresh"]="Refresh";n[n.Search="searching"]="Search"}(n.Actions||(n.Actions={}));t=n.Actions,function(n){n[n.String="stringedit"]="String";n[n.Numeric="numericedit"]="Numeric";n[n.Dropdown="dropdownedit"]="Dropdown";n[n.DatePicker="datepicker"]="DatePicker";n[n.DateTimePicker="datetimepicker"]="DateTimePicker";n[n.TextArea="textarea"]="TextArea";n[n.RTE="rteedit"]="RTE"}(n.EditingType||(n.EditingType={}));i=n.EditingType,function(n){n[n.Dialog="dialog"]="Dialog";n[n.DialogTemplate="dialogtemplate"]="DialogTemplate";n[n.ExternalForm="externalform"]="ExternalForm";n[n.ExternalFormTemplate="externalformtemplate"]="ExternalFormTemplate"}(n.EditMode||(n.EditMode={}));r=n.EditMode,function(n){n[n.BottomLeft="bottomleft"]="BottomLeft";n[n.TopRight="topright"]="TopRight"}(n.FormPosition||(n.FormPosition={}));u=n.FormPosition,function(n){n[n.Single="single"]="Single";n[n.Multiple="multiple"]="Multiple"}(n.SelectionType||(n.SelectionType={}));f=n.SelectionType,function(n){n[n.Column="column"]="Column";n[n.Swimlane="swimlane"]="Swimlane"}(n.Type||(n.Type={}));e=n.Type})(t=n.Kanban||(n.Kanban={}))}(n||(n={}))});
