/*!
*  filename: ej.olap.base.min.js
*  version : 12.3
*  Copyright Syncfusion Inc. 2001 - 2014. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min"],n):n()})(function(){(function(n,t,i){t.olap=t.olap||{};t.olap.base={_initProperties:function(){this._columnHeaders=[];this._rowHeaders=[];this._valueCells=[];this.pivotEngine=[];this.olapCtrlObj=null;this._cBIndx=null;this._rBIndx=null;this._OlapDataSource;this._measureDt={};this._cTotIndexInfo=null;this._rTotIndexInfo=null;this._kpi=null},_initControlProperties:function(n){n._drilledCellSet=[];n.XMLACellSet=null;n._fieldData={};n.pluginName=="ejPivotGrid"&&this._getFieldItemsInfo(n);this._currIndex={};this._isRowDrilled=!1;this._isColDrilled=!1},getJSONData:function(t,i,r){var f,o,e,u;t.action&&t.action=="initialLoad"&&(this._initControlProperties(r),this._applyTrim(r));this._initProperties();this.olapCtrlObj=n.extend({},r);this._OlapDataSource=i;f="";o=i.data;r.model.enableGroupingBar&&r._createGroupingBar(i);f=i.MDXQuery?i.MDXQuery:this._getParsedMDX(i,i.cube);u=this._getConnectionInfo(this.olapCtrlObj.model.dataSource.data);e='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header><\/Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement> '+f+" <\/Statement> <\/Command> <Properties> <PropertyList> <Catalog>"+i.catalog+"<\/Catalog> <LocaleIdentifier>"+u.LCID+"<\/LocaleIdentifier> <\/PropertyList> <\/Properties><\/Execute> <\/Body> <\/Envelope>";t.action=="drilldown"?this.olapCtrlObj.doAjaxPost("POST",u.url,{XMLA:e},this._onDemandExpand,null,t):this.olapCtrlObj.doAjaxPost("POST",u.url,{XMLA:e},this._generateJSONData,null,t)},_getParsedMDX:function(n,r){if(n!=i){var e="",u,f,o;u=t.olap._mdxParser._getRowMDX(n);f=t.olap._mdxParser._getcolumnMDX(n);u=u.length>0?",NON EMPTY("+u+")\n dimension properties MEMBER_TYPE,CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME  ON ROWS":"";o=t.olap._mdxParser._getSlicerMDX(n,this.olapCtrlObj);e="\nSelect \nNON EMPTY("+(f==""?"{}":f)+")\ndimension properties MEMBER_TYPE,CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME  ON COLUMNS \n"+u+"\n "+t.olap._mdxParser._getIncludefilterQuery(n,r,this.olapCtrlObj)+o+"\n CELL PROPERTIES VALUE, FORMAT_STRING, FORMATTED_VALUE \n ";f==""&&e.replace(/NON EMPTY/g," ")}return e},_getAxisElementsUName:function(n){for(var i="",t=0;t<n.length;t++)i+=i==""?"{"+n[t].uniqueName+"}":", {"+n[t].uniqueName+"}";return i},_generateJSONData:function(r,u){var o=[],s=[],h,y,w,p,c,l,a,f,e,v;if(n(u).find("Error").length>0)return this.olapCtrlObj._createErrorDialog(n(u).find("faultstring").text(),r.action),!1;if(n(u).find("Axis[name|='SlicerAxis']").remove(),this.olapCtrlObj.XMLACellSet=n(u).find("Axes, CellData"),w=[],r=="onDemandDrill"&&(this.olapCtrlObj.XMLACellSet=u),h=n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0'] Tuple"),y=n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1'] Tuple"),h.length>0){for(p=n(this.olapCtrlObj.XMLACellSet).find("CellData Cell"),this._columnHeaders=this._getHeaderCollection(h,"colheader"),this._rowHeaders=this._getHeaderCollection(y,"rowheader"),this._valueCells=this._getValueCells(p,h.length),indexRCell=this._measureDt.axis=="rowheader"?t.sum(this._rowHeaders.maxLvlLen)+1:t.sum(this._rowHeaders.maxLvlLen),indexCCell=this._measureDt.axis=="colheader"?t.sum(this._columnHeaders.maxLvlLen)+1:t.sum(this._columnHeaders.maxLvlLen),this._populateEngine(this._rowHeaders.headers,this._columnHeaders.headers,this._valueCells),n(this.olapCtrlObj).find(".pivotGridTable").remove(),c=this._rowHeaders.headers.length+indexCCell,l=this._columnHeaders.headers.length+indexRCell,this.pivotEngine.length>1&&(c=this.pivotEngine.length),f=0;f<c;f++)for(e=0;e<l;e++)o[e]==i&&(o[e]=[]),this.pivotEngine[f]!=i&&this.pivotEngine[f][e]!=i?(o[e][f]={Index:e+","+f,CSS:this.pivotEngine[f][e].CSS==""?"none":this.pivotEngine[f][e].CSS==i?"value":this.pivotEngine[f][e].CSS,Value:this.pivotEngine[f][e].Value,State:this.pivotEngine[f][e].ChildCount>0?2:this.pivotEngine[f][e].ChildCount<0?1:0,RowSpan:this.pivotEngine[f][e].RowSpan!=i?this.pivotEngine[f][e].RowSpan:1,ColSpan:this.pivotEngine[f][e].ColSpan!=i?this.pivotEngine[f][e].ColSpan:1,Info:this.pivotEngine[f][e].UName+"::"+this.pivotEngine[f][e].LName+"::"+this.pivotEngine[f][e].Value+"::"+this.pivotEngine[f][e].PUName,Span:"None",Expander:1},this.pivotEngine[f][e].kpiInfo&&(o[e][f].kpi=this.pivotEngine[f][e].kpi,o[e][f].kpiInfo=this.pivotEngine[f][e].kpiInfo),this.pivotEngine[f][e].ActualValue&&(o[e][f].ActualValue=this.pivotEngine[f][e].ActualValue)):this.pivotEngine[f]!=i&&(a="none",f<indexCCell&&e<indexRCell&&(a="rowheader"),o[e][f]={Index:e+","+f,CSS:a,Value:"",State:0,RowSpan:1,ColSpan:1,Info:"",Span:"None",Expander:0});for(f=0;f<l;f++)for(e=0;e<c;e++)o[f]!=i&&o[f][e]!=i&&s.push(o[f][e]);for(v=0,index=0;index<s.length;index++)if(parseInt(s[index].Index.split(",")[0])==0)v++;else break;this.olapCtrlObj._pivotRecords={records:s,rowCount:v};typeof this.olapCtrlObj.model.dataSource.data=="string"&&this.olapCtrlObj.pluginName!="ejPivotGrid"?this.olapCtrlObj.generateJSON({baseObj:this},o):(this.olapCtrlObj._dataModel="XMLA",this.olapCtrlObj.setJSONRecords(JSON.stringify(s)),this.olapCtrlObj.model.enableGroupingBar&&this.olapCtrlObj._createGroupingBar(this.olapCtrlObj.model.dataSource),this.olapCtrlObj.renderControlFromJSON(s),r.action&&r.action=="initialLoad"&&(this.olapCtrlObj._trigger("renderSuccess",this.olapCtrlObj),this.olapCtrlObj._fieldData={hierarchy:this.olapCtrlObj._fieldData.hierarchy}),this.olapCtrlObj.pluginName=="ejPivotGrid"&&this.olapCtrlObj._ogridWaitingPopup.hide(),this._columnHeaders=this._rowHeaders=this._valueCells=this.pivotEngine=[],this._cBIndx=this._rBIndx=null,this._measureDt={axis:"",posision:null},this._cTotIndexInfo=this._rTotIndexInfo=null)}else this.olapCtrlObj._generateJSONRecord({activeObj:this.olapCtrlObj,measureDetails:this._measureDt},transeposeEngine)},_onDemandExpand:function(t,i){var et=i,f,it,r="",e=this.olapCtrlObj.XMLACellSet,b,k,d=n(this.olapCtrlObj.XMLACellSet).find("Axis[name='Axis0'] Tuple").length,c=n(this.olapCtrlObj.XMLACellSet).find("Axis[name='Axis1'] Tuple").length,y,rt=0,ut=0,h,u,nt,ft,tt;c=c?c:1;rt=n(i).find("CellData Cell").length;ut=n(this.olapCtrlObj.XMLACellSet).find("CellData Cell").length;it=t.cellInfo.previousElements.split(">#>");var l=n(i).find("Axis[name|='Axis0'] Tuple"),a=n(i).find("Axis[name|='Axis1'] Tuple"),b=l.length;k=a.length;n(i).find("Axis[name='SlicerAxis']").remove();var g=t.cellInfo.itemPosition,v,p,o=0,s=!1,w="";for(p=t.cellInfo.axis=="rowheader"?a[0]:l[0],r=v=n(p).find("Member:nth-child("+(g+1)+") PARENT_UNIQUE_NAME").text(),h=g+1;h>0;h--)e=n(e).find("Tuple Member:nth-child("+h+") UName:contains('"+v+"')").parents("tuple"),v=n(p).find("Member:nth-child("+(h-1)+") UName").text(),w=v+w;if(r=w+r,y=e.index()+1,r=t.cellInfo.previousElements.split(">#>").join().replace(/,/g,""),f=t.cellInfo.preRepItm.split(">#>").join().replace(/,/g,""),this.olapCtrlObj._drilledCellSet&&(o=this.olapCtrlObj._drilledCellSet.length),this.olapCtrlObj._drilledCellSet[0]&&o)for(u=0;u<o;u++){for(nt=this.olapCtrlObj._drilledCellSet[u].length,ft=t.cellInfo.parentUniqueName,cEllen=0;cEllen<nt;cEllen++)if(t.cellInfo.previousElements.startsWith(this.olapCtrlObj._drilledCellSet[u][cEllen].key)){this.olapCtrlObj._drilledCellSet[u].push({key:r,repItms:f,cSet:n(i).find("Axes, CellData").clone(!0)});s=!0;break}else if(this.olapCtrlObj._drilledCellSet[u][cEllen].key.startsWith(t.cellInfo.previousElements)){this.olapCtrlObj._drilledCellSet[u].splice(cEllen,0,{key:r,repItms:f,cSet:n(i).find("Axes, CellData").clone(!0)});s=!0;break}if(s)break}else this.olapCtrlObj._drilledCellSet[0]=[],this.olapCtrlObj._drilledCellSet[0][0]={key:r,repItms:f,cSet:n(i).find("Axes, CellData").clone(!0)},s=!0;s||(this.olapCtrlObj._drilledCellSet[o]=[],this.olapCtrlObj._drilledCellSet[o].push({key:r,repItms:f,cSet:n(i).find("Axes, CellData").clone(!0)}));t.cellInfo.axis=="rowheader"?(tt=n(i).find("Axis[name|='Axis1'] Tuple"),this._insertCellSet("rowheader",e,a,l,k,d,b,y,i)):(tt=n(i).find("Axis[name|='Axis1'] Tuple"),this._insertCellSet("colheader",e,l,a,c,d,b,y,i));this._generateJSONData("onDemandDrill",this.olapCtrlObj.XMLACellSet)},_insertCellSet:function(t,i,r,u,f,e,o,s,h){var g=n(n(h).find("CellData Cell")[0]).clone(),a,l,c,v,it;n(g).find("FmtValue").text("");i.length>1?n(i[0]).after(r):n(i).after(r);l=e;t=="rowheader"?a=n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0'] Tuple"):(a=n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1'] Tuple"),l=o);var y=0,nt=n(a).filter(function(t,i){if(u[y]&&n(i).find("UName").text()==n(u[y]).find("UName").text())return y++,!0}),p=0,w=!1;for(c=0;c<f;c++){var tt="",b=0,k=0,d;for(d=t=="rowheader"?(s+c)*l:c*(e+l)+s,v=0;v<l;v++)(t!="rowheader"||n(nt[b]).index()!=v)&&(t!="colheader"||n(nt[p]).index()!=c)&&a.length?n(this.olapCtrlObj.XMLACellSet).find("CellData Cell:nth-child("+(d+k)+")").after(n(g).clone()):(it=t=="rowheader"?c*o:p*o,tt=n(n(h).find("CellData Cell")[it+b]).clone(),n(this.olapCtrlObj.XMLACellSet).find("CellData Cell:nth-child("+(d+k)+")").after(tt),b++,w=!0),k++;t=="colheader"&&(w&&p++,w=!1)}},_onDemandCollapse:function(i,r){var e,o,s,u,f,h=i.drilledMembers[i.drilledMembers.length-1].cSet;o=n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0'] Tuple");e=n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1'] Tuple");u=n(h).find("Axis[name|='Axis0'] Tuple");f=n(h).find("Axis[name|='Axis1'] Tuple");try{s=r=="rowheader"?f:u;r=="rowheader"?this._removeCellSets(s,e,o,u,f,r):this._removeCellSets(s,o,e,f,u,r);this.olapCtrlObj.model.dataSource=t.olap._mdxParser._clearCollapsedItems(r,i.drilledMembers[i.drilledMembers.length-1],this.olapCtrlObj.model.dataSource);i.drilledMembers=i.drilledMembers.splice(0,i.drilledMembers.length-1)}catch(c){this.olapCtrlObj._ogridWaitingPopup.hide()}i.drilledMembers.length?this._onDemandCollapse({drilledMembers:i.drilledMembers},r):i.action||this._generateJSONData("onDemandDrill",this.olapCtrlObj.XMLACellSet)},_removeCellSets:function(t,i,r,u,f,e){for(var c,s,v,o,l=t.length,h,y,p=f[0],a=0;a<i.length;a++)if(n(i[a]).find("UName").text()==n(p).find("UName").text()){y=i[a];break}if(c=l,s=n(y).index(),s)if(e=="rowheader"){for(h=r.length;c>0;)n(n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1'] Tuple")[s]).remove(),c--;for(o=ext=s;o<ext+l;o++)v=n(n(this.olapCtrlObj.XMLACellSet).find("CellData Cell")).splice(s*h,h),n(v).remove()}else{for(h=i.length;c>0;)n(n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0'] Tuple")[s]).remove(),c--;for(o=0;o<h;o++)v=n(n(this.olapCtrlObj.XMLACellSet).find("CellData Cell")).splice(h*o-o*l+s,l),n(v).remove()}},_getDrilledMemeber:function(t){var u=[],e=t.item.itemPosition,f,r,i,o=this.olapCtrlObj._drilledCellSet.length;return keyVal=t.item.previousElements.split(">#>").join().replace(/,/g,""),n.grep(this.olapCtrlObj._drilledCellSet,function(n,t){for(var u=0;u<n.length;u++)if(n[u].key.startsWith(keyVal))return r=u,i=t,f=n.length,!0}),this.olapCtrlObj._drilledCellSet[i]&&(n.merge(u,this.olapCtrlObj._drilledCellSet[i].splice(r,f-r)),this.olapCtrlObj._drilledCellSet[i].length||this.olapCtrlObj._drilledCellSet.splice(i,1)),u},_getHeaderCollection:function(t,r){var f,dt,a=[],ot,st="",w=[],tt=null,ht={},d={},l=this,vt,u,e,v,at,ii,p,wt,g,rt,bt,ut,h,ri,ft,gt,ui,ni,nt,et,kt,ti;if(f=n(t).filter(function(t,i){var f=n(i).find("Member"),e=n(f[0]).find("LName").text().indexOf("[(All)]")!=-1,h=e?1:0,o=0,u,s;for(tt=null,e?(ot=0,st="total"):(st="",ot=f.length),u=1,n(f[0]).find("LName").text().toLowerCase().indexOf("[measures]")!=-1&&(u=0),u;u<f.length;u++)n(f[u]).find("LName").text().toLowerCase().indexOf("[measures]")!=-1?(o=e,d.axis=r,d.posision=u,parseInt(n(f[u]).find("MEMBER_TYPE").text())==4&&(s=n(f[u]).find("UName").text().toLowerCase(),s.indexOf("trend]")!=-1?(l._kpi||l._loadKpi(l.olapCtrlObj.model.dataSource,this._loadKpiSuccess,""),(ht=l._isKpi(n(f[u]).find("UName").text(),"trend"))&&(tt="trend",d.isKpiExist=!0)):s.indexOf("status]")!=-1?(l._kpi||l._loadKpi(l.olapCtrlObj.model.dataSource,this._loadKpiSuccess,""),(ht=l._isKpi(n(f[u]).find("UName").text(),"status"))&&(tt="status",d.isKpiExist=!0)):s.indexOf("goal]")!=-1&&(l._kpi||l._loadKpi(l.olapCtrlObj.model.dataSource,this._loadKpiSuccess,""),(ht=l._isKpi(n(f[u]).find("UName").text()+"::"+n(f[u]).find("Caption").text(),"goal"))&&(tt="goal",d.isKpiExist=!0)))):o=n(f[u]).find("LName").text().indexOf("[(All)]")!=-1,(e==!1&&o==!0||e==!0&&o==!1)&&(h++,ot=u,st="total"),e=o;return dt=t,h<2&&a.push({selIndx:dt,totLvl:ot,type:st,kpi:tt,kpiInfo:ht}),h<2}).map(function(t,u){for(var s,c,h,e=n(u).find("Member"),o=[],f=0;f<e.length;f++)s=parseInt(n(e[f]).find("LNum").text()),c=n(e[f]).find("PARENT_UNIQUE_NAME").length?n(e[f]).find("PARENT_UNIQUE_NAME").text():"",o.push({CSS:r,Value:n(e[f]).find("Caption").text(),ColSpan:1,RowSpan:1,HUName:n(e[f]).attr("Hierarchy"),LName:n(e[f]).find("LName").text(),UName:n(e[f]).find("UName").text(),ChildCount:parseInt(n(e[f]).find("CHILDREN_CARDINALITY").text()),PUName:c,LNum:s,MemberType:parseInt(n(e[f]).find("MEMBER_TYPE").text())}),n(e[f]).find("LName").text().toLowerCase().indexOf("[measures]")!=-1&&a[t].kpi&&(o[o.length-1].kpiInfo=a[t].kpiInfo,o[o.length-1].kpi=a[t].kpi),w[f]==i?w[f]=s:w[f]<s&&(w[f]=s);return h=[],h[0]=o,h}),r=="colheader"?this._cTotIndexInfo=a:this._rTotIndexInfo=a,f={headers:f,indxInfo:a,maxLvlLen:w},n.isEmptyObject(d)||(this._measureDt=n.extend({},d)),vt=1,r.indexOf(this._OlapDataSource.values[0].axis.substring(0,3))>-1&&(vt=this._measureDt.measureCount=this._OlapDataSource.values[0].measures.length),!this._OlapDataSource._enableBasicEngine){var s={headers:[],indxInfo:[]},fi=a,c=a.length,ct=s.length,lt=[],o=[],yt=0,b=[],it=!1;try{for(u=0;u<c;u++){for(yt=e==0?o.length:o.length;u<c&&f.indxInfo[u-yt].type=="total";)s.indxInfo.push(f.indxInfo.splice(u-yt,1)[0]),s.headers.push(f.headers.splice(u,1)[0]),c--,ct++;if(u==0&&(s.indxInfo.reverse(),s.headers.reverse()),u+1<c||u+1==c){var k=f.headers[u].length,y=0,pt=0;for(e==k-1&&w[w.length-1]==0&&(k-=1),this._measureDt.posision==k-1&&this._measureDt.axis==r&&(pt=1),e=0;e<k-1-pt;e++){if(v=1,f.headers[u][e+1]!=i&&e+1<k-1&&f.headers[u][e+1].LName.toLowerCase().indexOf("[measures]")!=-1&&(v=2),b[e]==i?b[e]=0:f.headers[u+1]!=i&&u!=0&&f.headers[u][e].LNum==f.headers[u+1][e].LNum&&f.headers[u][e].UName!=f.headers[u-1][e].UName&&f.headers[u][e].UName==f.headers[u+1][e].UName&&(b[e]!=i&&(b[e]=u),it=!0),f.headers[u+1]!=i&&f.headers[u+1][e].LNum>1&&f.headers[u][e].LNum<f.headers[u+1][e].LNum){for(at=0,ii=0,tlen=s.headers.length,rt=f.headers[u+1][e].PUName,p=0;p<tlen;p++)s.headers[p]!=i&&s.headers[p][e].UName==rt&&s.headers[p][e+v]!=i&&s.headers[p][e+v].LNum!=0&&(s.headers.splice(p,1),s.indxInfo.splice(p-o.length,1),ct--,p--,tlen--);for(wt=b[e];wt<=u;wt++)g=b[e],(f.headers[g][e+v]!=i&&(e+v==k-1||f.headers[g][e+v].LName.toLowerCase().indexOf("[measures]")!=-1)||f.headers[g][e+v].LName.indexOf("[(All)]")==-1&&f.headers[g][e+v].LNum!=0)&&(f.indxInfo.splice(g-o.length,1),f.headers.splice(g,1),c--,at++);if(u+1>=at)for(u-=at-1;u<c&&f.indxInfo[u-o.length].type=="total";)s.indxInfo.push(f.indxInfo.splice(u-o.length,1)[0]),s.headers.push(f.headers.splice(u,1)[0]),c--,ct++}if(u>0&&f.headers[u-1]!=i&&f.headers[u][e].LNum<f.headers[u-1][e].LNum){for(rt=f.headers[u-1][e].PUName,bt=f.headers[u][e].LNum;bt<=f.headers[u-1][e].LNum;bt++)n.grep(s.headers,function(n,t){n!=i&&n[e].UName==rt&&(rt=n[e].PUName,f.headers.splice(u,0,s.headers.splice(t,1)[0]),f.indxInfo.splice(u-o.length,0,s.indxInfo.splice(t,1)[0]),c++,ct--,u++,it&&b[e]++)});it=!1}if(ut=this._comparePrevMembers(f.headers,c,u,e,k,y),u+1+y==c||f.headers[u+1+y]!=i&&f.headers[u][e].UName!=f.headers[u+1+y][e].UName||ut){for(h=[],ri=n.grep(s.headers,function(n,t){if(f.headers[u][e].UName==n[e].UName&&s.indxInfo[t].totLvl==e+v||f.headers[u+1+y]!=i&&f.headers[u][e].UName!=f.headers[u+1+y][e].UName&&f.headers[u][e].PUName==n[e].UName&&s.indxInfo[t].totLvl==e+v&&ut)return h.push(t),n}),ut&&(h.reverse(),ut=!1);h.length>0;){for(ft=h.length-1,gt=h[h.length-1];ft>=0;)gt<h[ft]&&h[ft]--,ft--;f.headers.splice(u+1,0,s.headers.splice(h[h.length-1],1)[0]);f.indxInfo.splice(u+1-o.length,0,s.indxInfo.splice(h[h.length-1],1)[0]);y++;h.pop();c++;it&&b[e]++}it=!1;lt[e]=0}lt[e]==i?lt[e]=0:lt[e]++}if(ui=this._findNextMember(f.headers,u,e),ni=this._findPreviousMember(f.headers,u-1,e),u>=vt&&e==k-1-pt&&w[e]>1){if(u>0&&f.headers[u]!=i&&f.headers[u-1][e].LNum!=0&&f.headers[u-1][e].LNum<f.headers[u][e].LNum)for(nt=ni;nt<0;nt++)f.indxInfo[u+nt-o.length].lnum=f.headers[u+nt][e].LNum,f.indxInfo[u+nt-o.length].type="total",o.push(f.indxInfo.splice(u+nt-o.length,1)[0]);if(u!=0&&f.headers[u]!=i&&f.headers[u][e].LNum!=0&&f.headers[u-1][e].LNum>f.headers[u][e].LNum)if(et=0,f.headers[u][e].LNum!=1&&o.length)for(kt=f.headers[u][e].LNum;kt<f.headers[u-1][e].LNum;kt++)for(ti=o[o.length-1].lnum;ti==o[o.length-1].lnum;)f.indxInfo.splice(u+et-o.length,0,o.splice(o.length-1,1)[0]),r==this._measureDt.axis&&this._measureDt.measureCount>1&&et--;else while(o.length>0)f.indxInfo.splice(u+et-o.length,0,o.splice(o.length-1,1)[0]),r==this._measureDt.axis&&this._measureDt.measureCount>1&&et--;else if(f.indxInfo[u+1-o.length]&&o.length&&f.indxInfo[u+1-o.length].type=="total")while(o.length>0)f.indxInfo.splice(u+1-o.length,0,o.splice(o.length-1,1)[0])}y>0&&(u+=y,y=0)}if(u+1==c){if(o.length&&f.headers[u][e].LNum!=1)while(o.length>0)f.indxInfo.splice(u+1-o.length,0,o.splice(o.length-1,1)[0]);n.grep(s.indxInfo,function(){f.headers.splice(u+1,0,s.headers.splice(0,1)[0]);f.indxInfo.splice(u+1-o.length,0,s.indxInfo.splice(0,1)[0])})}}}catch(ei){this.olapCtrlObj._ogridWaitingPopup.hide()}}return r=="rowheader"?this._rBIndx=a:this._cBIndx=a,f.maxLvlLen[e]>1&&(f.headers=this._drillOrderHeaderCollection(f.indxInfo,t,r)),f},_insertSummaryHeaders:function(n,t,i,r,u){while(i.length>0)n.headers.splice(r+1,0,t.headers.splice(i[i.length-1],1)[0]),n.indxInfo.splice(r+1-u,0,t.indxInfo.splice(i[i.length-1],1)[0]),i.pop()},_comparePrevMembers:function(n,t,i,r,u,f){if(r>0&&i+1+f<t)for(var e=r-1;e<=0;e--)return n[i][e].UName!=n[i+1+f][e].UName?!0:!1},_drillOrderHeaderCollection:function(t,i,r){var f=t,e=i,o=r,u=0;return n(f).map(function(t,i){var f=n(e[i.selIndx]).find("Member"),s=[],r,c,l,h;for(s[u]=[],r=0;r<f.length;r++)c=parseInt(n(f[r]).find("LNum").text()),l=n(f[r]).find("PARENT_UNIQUE_NAME").length?n(f[r]).find("PARENT_UNIQUE_NAME").text():"",s[u].push({CSS:o,Value:n(f[r]).find("Caption").text(),ColSpan:1,RowSpan:1,HUName:n(f[r]).attr("Hierarchy"),LName:n(f[r]).find("LName").text(),UName:n(f[r]).find("UName").text(),ChildCount:parseInt(n(f[r]).find("CHILDREN_CARDINALITY").text()),PUName:l,LNum:c,MemberType:parseInt(n(f[r]).find("MEMBER_TYPE").text())}),h=s[u][s[u].length-1],i.kpiInfo&&h.UName.toLowerCase().indexOf("[measures]")>-1&&h.MemberType==4&&(s[u][s[u].length-1].kpiInfo=i.kpiInfo),i.kpi&&h.UName.toLowerCase().indexOf("[measures]")>-1&&h.MemberType==4&&(s[u][s[u].length-1].kpi=i.kpi);return s})},_loadKpi:function(n,t,i){var r='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_KPIS<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+n.catalog+"<\/CATALOG_NAME><CUBE_NAME>"+n.cube+"<\/CUBE_NAME><\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+n.catalog+"<\/Catalog><\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>";this.olapCtrlObj.doAjaxPost("POST",n.data,{XMLA:r},this._loadKpiSuccess,null,i)},_loadKpiSuccess:function(n,t){this._kpi=t},_isKpi:function(t,i){var u=n(this._kpi).find("row:contains("+t.split("::")[0]+")"),r={};return u.length?(i=="trend"?(r.Graphic=n(u).find("KPI_TREND_GRAPHIC").text(),r.Value=n(u).find("KPI_NAME").text()):i=="status"?(r.Graphic=n(u).find("KPI_STATUS_GRAPHIC").text(),r.Value=n(u).find("KPI_NAME").text()):i=="goal"&&(r.Caption=t.split("::")[1],r.Value=n(u).find("KPI_NAME").text()),r):!1},_getValueCells:function(t,i){var s=this._columnHeaders.headers.length,h=this._rowHeaders.headers.length?this._rowHeaders.headers.length:1,e=0,u=0,f,l,r,o,c;if(this._valueCells[e]=[],this._OlapDataSource._enableBasicEngine)for(r=0;r<t.length;r++)u<s&&(this._valueCells[e][u]={Value:n(t[r]).find("FmtValue")[0]?n(t[r]).find("FmtValue").text():"",FormatString:n(t[r]).find("FormatString")[0]?n(t[r]).find("FormatString").text():""},u++),u==s&&e+1<h&&(u=0,e++,this._valueCells[e]=[]);else for(f=0;f<h;f++)for(l=this._rBIndx.length?this._rBIndx[f].selIndx:0,r=0;r<s;r++)o=n(t[l*i+this._cBIndx[r].selIndx]),c="",(this._columnHeaders.indxInfo[r]&&this._columnHeaders.indxInfo[r].type=="total"||this._rowHeaders.indxInfo[f]&&this._rowHeaders.indxInfo[f].type=="total")&&(c="summary"),u<s&&(this._valueCells[f][r]={ActualValue:n(o).find("Value").text(),Value:n(o).find("FmtValue")[0]?this._getFormatedValue(n(o),n(o).find("FormatString")[0]):"",FormatString:n(o).find("FormatString")[0]?n(o).find("FormatString").text():"",kpi:this._cBIndx[r].kpi?this._cBIndx[r].kpi:this._rBIndx[f]?this._rBIndx[f].kpi:"status",summary:c},u++),u==s&&e+1<h&&(u=0,e++,this._valueCells[e]=[]);return this._valueCells},_getFormatedValue:function(i,r){var r,u;if(this.olapCtrlObj.model.locale!="en-US"&&n.isNumeric(parseFloat(n(i).find("Value").text()))){r=n(r).length>0?n(r).text().toLowerCase():"";u=parseFloat(i.find("Value").text());switch(r){case"decimal":u=parseFloat(t.widgetBase.formatting("{0:D2}",u,this.olapCtrlObj.model.locale));break;case"percent":u=t.widgetBase.formatting("{0:P0}",u,this.olapCtrlObj.model.locale);break;case"number":u=t.widgetBase.formatting("{0:N}",u,this.olapCtrlObj.model.locale);break;case"currency":u=t.widgetBase.formatting("{0:C2}",u,this.olapCtrlObj.model.locale);break;case"date":u=new Date((Number(u)-2)*864e5+new Date("01/01/1900").getTime());this._isDateTime(u)&&(u=t.widgetBase.formatting("{0:MM/dd/yyyy}",u,this.olapCtrlObj.model.locale));break;case"scientific":u=u.toExponential(2).replace("e","E");break;case"accounting":u=this._toAccounting(u,"{0:C2}");break;case"time":u=new Date((Number(u)-2)*864e5+new Date("01/01/1900").getTime());this._isDateTime(u)&&(u=t.widgetBase.formatting("{0:h:mm:ss tt}",u,this.olapCtrlObj.model.locale));break;case"fraction":u=this._toFraction(u);u="numerator"in u?u.integer+" "+u.numerator+"/"+u.denominator:u.integer;break;default:u=n(i).find("FmtValue").text()}}else u=n(i).find("FmtValue").text();return u},_isDateTime:function(n){return Object.prototype.toString.call(n)==="[object Date]"&&!isNaN(n.valueOf())},_toAccounting:function(n,i,r){var h=t.preferredCulture(r).numberFormat,f,e,u=h.currency.symbol,o,s;return val=t.widgetBase.formatting(i,n,this.olapCtrlObj.model.locale),o=val.replace(u,""),s=val.indexOf(u),!s||n<0&&s===1?(f=u,e=Number(n)?o:"-"):(f=Number(n)?o:"-",e=u),f+"   "+e},_toFraction:function(n){if(this._isNumber(n)){var r=n.toString(),e=r.split(".")[0],t=r.split(".")[1];if(!t)return{integer:n};var i=(+t).toString(),u=this._getPlaceValue(t,i),f=this._getGCD(i,u);return{integer:e,numerator:Number(i)/f,denominator:Number(u)/f}}return null},_isNumber:function(n){return n-parseFloat(n)>=0},_getGCD:function(n,t){return(n=Number(n),t=Number(t),!t)?n:this._getGCD(t,n%t)},_getPlaceValue:function(n,t){var i=n.indexOf(t)+t.length;return"1"+Array(i+1).join("0")},_populateEngine:function(t,r,u){var l=t.length,a=r.length,v=l?t[0].length:l,s=a?r[0].length:a,y=u.length,p=u[0].length,f,e,c,g;try{this.pivotEngine=[];var w=[],b=[],nt=!1,h=!1,o=[];for(f=0;f<a;f++)for(this.pivotEngine[f+s]==i&&(this.pivotEngine[f+s]=[]),f==0&&(this.pivotEngine[0]=[],this.pivotEngine[0][0]={CSS:"none",Value:"",ColSpan:indexCCell?indexCCell:1,RowSpan:indexRCell?indexRCell:1,HUName:"",LName:"",UName:"",LNum:""}),e=0;e<s;e++)h=!1,this._OlapDataSource.columns&&this._OlapDataSource.columns[e]&&this._OlapDataSource.columns[e].isNamedSets&&(h=!0),this._pivotEngineSpanCalculation("colheader",r,t,this._columnHeaders.maxLvlLen,u,e,f,b,w,this._cTotIndexInfo,h);for(o=this.pivotEngine.slice(),this.pivotEngine=[],f=0;f<o.length;f++)if(o[f])for(e=0;e<o[f].length;e++)o[f][e]&&(this.pivotEngine[e]==i&&(this.pivotEngine[e]=[]),this.pivotEngine[e][f]={CSS:o[f][e].CSS,ColSpan:o[f][e].RowSpan,HUName:o[f][e].HUName,LName:o[f][e].LName,LNum:o[f][e].LNum,RowSpan:o[f][e].ColSpan,UName:o[f][e].UName,PUName:o[f][e].PUName,Value:o[f][e].Value,ChildCount:o[f][e].ChildCount,MemberType:o[f][e].MemberType},o[f][e].kpiInfo&&(this.pivotEngine[e][f].kpiInfo=o[f][e].kpiInfo,this.pivotEngine[e][f].kpi=o[f][e].kpi));var k=[],d=[],nt=!1;for(f=0;f<l;f++)for(this.pivotEngine[f+indexCCell]==i&&(this.pivotEngine[f+indexCCell]=[]),e=0;e<v;e++)h=!1,this._OlapDataSource.rows&&this._OlapDataSource.rows[e]&&this._OlapDataSource.rows[e].isNamedSets&&(h=!0),this._pivotEngineSpanCalculation("rowheader",t,r,this._rowHeaders.maxLvlLen,u,e,f,d,k,this._rTotIndexInfo,h);for(v=this._measureDt.axis=="rowheader"?indexRCell+1:indexRCell,s=indexCCell?indexCCell:s,f=0;f<y;f++)for(this.pivotEngine[f+s]!=i&&(v=this.pivotEngine[f+s].length),e=0;e<p;e++)this.pivotEngine[f+s]==i&&(this.pivotEngine[f+s]=[]),c=this._setClassName(u[f][e]),u[f][e].CSS=c,c.indexOf("kpiiconvalue")>-1&&!1?u[f][e].Value="":c.indexOf("kpiiconvalue")>-1&&(u[f][e].Value=parseInt(u[f][e].Value)),this.pivotEngine[f+indexCCell][e+indexRCell]=u[f][e];g=n.grep(this.pivotEngine,function(n){return n})}catch(tt){this.olapCtrlObj._ogridWaitingPopup.hide()}},_pivotEngineSpanCalculation:function(n,t,r,u,f,e,o,s,h,c,l){var ut=t.length,ft="",yt=r.length,b=ut?t[0].length:ut,v=yt?r[0].length:yt,dt=f.length,gt=f[0].length,wt,k,g,a,pt,ct,nt,d,rt,kt,ot,at,vt,st;n=="rowheader"?(v=indexCCell?indexCCell:v,ft="row"):(v=indexRCell?indexRCell:v,ft="col");wt=1;k=0;l&&(t[o][e].ChildCount=0);this._measureDt.axis==n&&this._measureDt.posision==b-1&&(k=1);s[e]||(s[e]=[]);this.pivotEngine[o+v]||(this.pivotEngine[o+v]=[]);h[e]=o;var bt=u[e]?u[e]:1,y=0,ht=0;for(g=0;g<e;g++)u[g]&&(y+=u[g]-1,ht+=u[g]);if(!this._OlapDataSource._enableBasicEngine||this._OlapDataSource._checkSummaryHeaders)for(a=1;a<=bt;a++){var p=null,it=!1,w=t[o][e].LNum;if(s[e][a]==i&&(s[e][a]=0),t[o-1]&&s[e][w]&&(t[o][e].LNum!=0&&t[o-1][e].PUName==t[o][e].UName||e+k==b-1&&t[o-1][e].LNum<t[o][e].LNum)&&(tempSpan=s[e][w],this.pivotEngine[o+v-tempSpan][e+w-1+y]=t[o][e],l||(this.pivotEngine[o+v-tempSpan][e+w-1+y].ChildCount=-1),this.pivotEngine[o+v-tempSpan][e+w-1+y].ColSpan=1,this.pivotEngine[o+v-tempSpan][e+w-1+y].RowSpan+=tempSpan,this._drilledJSONData(o+v-tempSpan,o+v,e+w-1+y,t[o][e]),s[e][w]=0,e+k==b-1&&t[o-1][e].LNum>t[o][e].LNum)){for(pt=u[e]-w,ct=this._findNextMember(t,o,e),nt=0;nt<ct;nt++)this.pivotEngine[o+v+nt]||(this.pivotEngine[o+v+nt]=[]),this.pivotEngine[o+v+nt][e+y+w]={CSS:"summary "+ft,Value:"Total",ColSpan:pt,RowSpan:1,HUName:"",LName:"",UName:"",LNum:"",MemberType:"",ChildCount:""};this.pivotEngine[o+v-tempSpan][e+w-1+y].RowSpan+=ct-1}if(t[o][e].LNum>a&&s[e][a]++,p=o+v,a==t[o][e].LNum&&o==0&&t[o][e].LNum>1)this.pivotEngine[p]||(this.pivotEngine[p]=[]),this.pivotEngine[p][e+a-1+y]=t[o][e],(!(t[o+1]!=i&&t[o][e].LNum<t[o+1][e].LNum)||e+k==b-1&&t[o+1]&&t[o][e].LNum<t[o+1][e].LNum)&&(this.pivotEngine[p][e+a-1+y].ColSpan+=u[e]-this.pivotEngine[p][e+a-1+y].LNum);else if(o!=0&&t[o][e].LNum>1&&a==t[o][e].LNum&&t[o-1][e].UName!=t[o][e].UName&&t[o-1][e].PUName!=t[o][e].UName)this.pivotEngine[p]==i&&(this.pivotEngine[p]=[]),this.pivotEngine[p][e+a-1+y]=t[o][e],(!(t[o+1]!=i&&t[o][e].LNum<t[o+1][e].LNum)||e+k==b-1&&t[o+1]&&t[o][e].LNum<t[o+1][e].LNum)&&(this.pivotEngine[p][e+a-1+y].ColSpan+=u[e]-this.pivotEngine[p][e+a-1+y].LNum);else if(o!=0&&a==t[o][e].LNum&&t[o-1][e].UName==t[o][e].UName)s[e][a]++,this.pivotEngine[o+v][e+a-1+y]=t[o][e],(t[o+1]!=i&&t[o+1][e].UName!=t[o][e].UName||o+1==ut&&s[e][a]>0)&&(d=s[e][a],rt=t[o][e].LNum,d&&this.pivotEngine[o+v-d][e+rt-1+y]!=i&&this.pivotEngine[o+v-d][e+rt-1+y].Value!=i&&(this.pivotEngine[o+v-d][e+rt-1+y].RowSpan+=d,this._drilledJSONData(o+v-d,o+v,e+rt-1+y,t[o][e])),s[e][a]=0);else if(t[o][e].LNum<2&&(a==t[o][e].LNum||t[o][e].LNum==0)||t[o][e].LNum<a&&t[o-1]&&t[o][e].LNum<t[o-1][e].LNum&&c[o].type=="total"&&this._measureDt.axis==n)if(kt=a-1,t[o-1]&&t[o-1][e].UName==t[o][e].UName&&t[o][e].LName.toLowerCase().indexOf("[measures]")>-1&&(this.pivotEngine[o+v][e+a-1+y]=t[o][e],this._measureDt.measureCount>1&&n==this._measureDt.axis||s[e][a]++),c[o].type!="total")t[o-1]&&t[o-1][e].UName==t[o][e].UName||(this.pivotEngine[o+v][e+a-1+y]=t[o][e],rSCnt=s[e][a],rSCnt&&this.pivotEngine[o+v-rSCnt][e+a-1+y]!=i&&(this.pivotEngine[o+v-rSCnt][e+a-1+y].RowSpan+=s[e][a],this._drilledJSONData(o+v-rSCnt,o+v,e+a-1+y,t[o][e])),s[e][a]=0),!t[o][e].LNum==0&&(!(t[o+1]!=i&&t[o][e].LNum<t[o+1][e].LNum)||e+k==b-1&&t[o+1]&&t[o][e].LNum<t[o+1][e].LNum)&&this.pivotEngine[o+v][e+a-1+y]&&(this.pivotEngine[o+v][e+a-1+y].ColSpan+=u[e]-this.pivotEngine[o+v][e+a-1+y].LNum);else if(c[o].type=="total"&&t[o][e].LName.toLowerCase().indexOf("[measures]")==-1&&t[o][e].LNum!=a&&u[e]!=0){if((t[o][e-1]&&t[o][e-1].LName.toLowerCase().indexOf("[measures]")==-1||this._measureDt.axis!=n)&&(e>c[o].totLvl||e==b-1&&a>c[o].totLvl&&c[o].totLvl!=0||c[o].totLvl==0&&a-1>c[o].totLvl))break;for(var et=1,lt=1,tt=0;t[o-lt][e]&&t[o-lt][e].LNum==0;)lt++,tt++;if(this._measureDt.axis==n){for(ot=0,it=!1,tt=0,e<this._measureDt.posision?(at=e,vt=this._measureDt.posision):e>this._measureDt.posision&&(vt=u.length,at=e,it=!0),st=at;st<vt;st++)ot+=u[st];t[o][e+1]&&t[o][e+1].LName.toLowerCase().indexOf("[measures]")>-1&&u[e]>1&&(it=!0,ot-=t[o][e].LNum);et=ot}else t[o][e].LNum==0&&(o!=0&&t[o][e-1]&&u[e-1]>1&&t[o][e-1].LNum<t[o-1][e-1].LNum&&(tt=u[e-1]-t[o][e-1].LNum),n=="rowheader"?et=indexRCell-ht+tt:n=="colheader"&&(et=indexCCell-ht+tt),(u.length!=1&&e==b-1||u.length>1&&e<b-1)&&(it=!0));this.pivotEngine[o+v][e+a-1+y-tt]={CSS:"summary "+ft,Value:"Total",ColSpan:et,RowSpan:1,HUName:"",LName:"",UName:"",LNum:"",MemberType:"",ChildCount:""}}else t[o][e].LName.toLowerCase().indexOf("[measures]")!=-1&&(t[o-1]&&t[o-1][e].UName==t[o][e].UName||(this.pivotEngine[o+v][e+a-1+y]=t[o][e]),(t[o-1]&&t[o-1][e].UName!=t[o][e].UName||o+1==ut)&&(rSCnt=s[e][a],rSCnt&&this.pivotEngine[o+v-rSCnt][e+a-1+y]!=i&&(this.pivotEngine[o+v-rSCnt][e+a-1+y].RowSpan+=s[e][a],this._drilledJSONData(o+v-rSCnt,o+v,e+a-1+y,t[o][e])),s[e][a]=0));if(it)break}else this.pivotEngine[o+v][e]=t[o][e]},_findNextMember:function(n,t,i){for(var r=0;n[t+r]&&n[t][i].UName==n[t+r][i].UName;)r++;return r},_findPreviousMember:function(n,t,i){for(var r=-1;n[t+r]&&n[t][i].UName==n[t+r][i].UName;)r--;return r},_drilledJSONData:function(n,t,i,r){for(var u=n+1;u<t;u++)this.pivotEngine[u][i]=r},_setClassName:function(n){var i=parseInt(n.Value),t="value";if(n.kpi)if(n.kpi=="trend")switch(i){case-1:t="value kpiiconvalue kpidownarrow";break;case 0:t="value kpiiconvalue kpirightarrow";break;case 1:t="value kpiiconvalue kpiuparrow"}else if(n.kpi=="status")switch(i){case-1:t="value kpiiconvalue kpidiamond";break;case 0:t="value kpiiconvalue kpitriangle";break;case 1:t="value kpiiconvalue kpicircle"}return n.summary+" "+t},_getFieldItemsInfo:function(n){var t=this._getConnectionInfo(n.model.dataSource.data),i='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_HIERARCHIES<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+n.model.dataSource.catalog+"<\/CATALOG_NAME><CUBE_NAME>"+n.model.dataSource.cube+"<\/CUBE_NAME><\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+n.model.dataSource.catalog+"<\/Catalog> <LocaleIdentifier>"+t.LCID+"<\/LocaleIdentifier><\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>";n.doAjaxPost("POST",t.url,{XMLA:i},this._getHierarchyInfo,null,{pvtGridObj:n,action:"loadFieldElements"})},_getHierarchyInfo:function(t,i){for(var u,s,o=[],r=t.pvtGridObj,f=this._getConnectionInfo(r.model.dataSource.data),e=0;e<n(i).find("row").length;e++)u=n(n(i).find("row")[e]),o.push({pid:u.find("DIMENSION_UNIQUE_NAME").text(),id:u.find("HIERARCHY_UNIQUE_NAME").text(),name:u.find("HIERARCHY_CAPTION").text(),tag:u.find("HIERARCHY_UNIQUE_NAME").text(),hasAllMember:u.children("ALL_MEMBER").length==0?!0:!1});r._fieldData={hierarchy:o,hierarchySuccess:i,measures:[]};f.LCID.indexOf("1033")>=0&&!r.model.enableDrillThrough||(s='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_MEASURES<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+r.model.dataSource.catalog+"<\/CATALOG_NAME><CUBE_NAME>"+r.model.dataSource.cube+"<\/CUBE_NAME><\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+r.model.dataSource.catalog+"<\/Catalog> <LocaleIdentifier>"+f.LCID+"<\/LocaleIdentifier> <\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>",r.doAjaxPost("POST",f.url,{XMLA:s},this._getMeasureInfo,null,{pvtGridObj:r,action:"loadFieldElements"}))},_getMeasureInfo:function(t,i){for(var f=[],r=0;r<n(i).find("row").length;r++){var u=n(n(i).find("row")[r]),o=u.children("MEASUREGROUP_NAME").text(),e=u.find("MEASURE_UNIQUE_NAME").text();f.push({id:e,pid:o,name:u.children("MEASURE_CAPTION").text(),tag:e})}t.pvtGridObj._fieldData.measures=f;t.pvtGridObj._fieldData.measureSuccess=i},_getConnectionInfo:function(t){var i={url:"",LCID:"1033"};return t!=""&&n.map(t.split(";"),function(n){n.toLowerCase().indexOf("locale")<0&&i.url.length==0?i.url=n:n.toLowerCase().indexOf("locale")>=0&&(i.LCID=n.replace(/ /g,"").split("=")[1])}),i},_applyTrim:function(t){var u=[],r=t.model.dataSource,f=this;t._fieldData&&t._fieldData.measures&&t._fieldData.hierarchy?(n.merge(u,t._fieldData.hierarchy),n.merge(u,t._fieldData.measures)):t._fieldData&&t._fieldData.hierarchy?t._fieldData.hierarchy:[];r.rows=n.map(r.rows,function(t){if(t.fieldName!=i)return t.fieldName=n.trim(t.fieldName),f._getCaption(t,u)});r.columns=n.map(r.columns,function(t){if(t.fieldName!=i)return t.fieldName=n.trim(t.fieldName),f._getCaption(t,u)});r.filters=n.map(r.filters,function(t){if(t.fieldName!=i)return t.fieldName=n.trim(t.fieldName),f._getCaption(t,u)});r.values=r.values.length>0&&r.values[0].measures!=i?r.values:[{measures:[],axis:"columns"}];r.values[0].measures=n.map(r.values[0].measures,function(t){if(t.fieldName!=i)return t.fieldName=n.trim(t.fieldName),f._getCaption(t,u)});t.model.dataSource=r},_getCaption:function(t,r){var f=t.fieldName,u=[];return r.length>0?(u=n.map(r,function(t){if(t.tag!=i&&t.tag.toLowerCase()==n.trim(f.toLowerCase()))return t}),f.toLowerCase().indexOf("[measures]")>=0&&u.length==0&&f.split(".[").length>0?t.fieldCaption=f.split(".[")[1].replace(/]/g,""):u.length>0&&(t.hasAllMember=u[0].hasAllMember?!0:!1,t.fieldCaption=u[0].name)):u.length==0&&(t.fieldCaption=f),t}};t.olap._mdxParser={_getRowMDX:function(r){var f=n(r)[0].rows,s,u,o,e,h;if(rowQuery="",measureQuery="",updateQuery=[],isSorted=!1,s=r.values.length>0&&r.values[0].measures!=i&&r.values[0].axis==t.olap.AxisName.Row,f.length>0){for(u=0;u<f.length;u++)o=t.isNullOrUndefined(f[u].isNamedSets)||!f[u].isNamedSets?!1:!0,e="",f[u].fieldName==i||o?o&&(rowQuery=u>0?rowQuery+"*{"+f[u].fieldName+"}":"{"+f[u].fieldName+"}"):(e=this._getDimensionQuery(f[u],r,"rows",u),updateQuery.push(e.replace(/["'\(\)]/g,"").replace(/["'\{\}]/g,"").replace(/\levels0/g,"levels(0)")),f[u].sortOrder&&f[u].sortOrder!=t.olap.SortOrder.None?(h=f[u].sortOrder==t.olap.SortOrder.None?"asc":"desc",isSorted=!0,rowQuery=rowQuery+(u>0?"*":"")+"{ORDER({HIERARCHIZE({"+e+"})},"+f[u].fieldName+".CurrentMember.MEMBER_CAPTION,"+h+")}"):rowQuery=rowQuery+(u>0?"*":"")+"{HIERARCHIZE({({"+e+"})})}");rowQuery=(isSorted?" ":" HIERARCHIZE ")+"( {"+this._updateOlapReport(n(r)[0].rows,rowQuery,"rows",updateQuery)+"})"}return s&&(measureQuery=t.olap._mdxParser._getMeasuresQuery(r),rowQuery=rowQuery!=""?rowQuery+(rowQuery!=""&&measureQuery!=""?",":"")+measureQuery:measureQuery),rowQuery},_getcolumnMDX:function(r){var f=n(r)[0].columns,e="",s=[],h=!1,l=r.values.length>0&&r.values[0].measures!=i&&r.values[0].axis==t.olap.AxisName.Column,u,c;if(f.length>0){for(u=0;u<f.length;u++){var a=t.isNullOrUndefined(f[u].isNamedSets)||!f[u].isNamedSets?!0:!1,h=!1,o="";f[u].fieldName!=i&&a?(o=this._getDimensionQuery(f[u],r,"columns",u),s.push(o.replace(/["'\(\)]/g,"").replace(/["'\{\}]/g,"")),f[u].sortOrder&&f[u].sortOrder!=t.olap.SortOrder.None?(c=f[u].sortOrder==t.olap.SortOrder.Ascending?"asc":"desc",h=!0,e=e+(u>0?"*":"")+"{ ORDER ({HIERARCHIZE ({"+o+"})},"+f[u].fieldName+".CurrentMember.MEMBER_CAPTION,"+c+")}"):e=e+(u>0?"*":"")+"{"+o+"}"):e=u>0?e+"*{"+f[u].fieldName+"}":"{"+f[u].fieldName+"}"}e=(h?" ":" HIERARCHIZE ")+"( {"+this._updateOlapReport(f,e,"columns",s)+"})"}return l&&(measureQuery=t.olap._mdxParser._getMeasuresQuery(r),e=e!=""?e+(e!=""&&measureQuery!=""?",":"")+measureQuery:measureQuery),e},_getSortedMembers:function(i){var r=i.fieldName,u;return i.sortOrder&&i.sortOrder!=t.olap.SortOrder.None?(u=i.sortOrder=="ascending"?"asc":"desc",n.map(i.drilledItems,function(t){return n.map(t,function(n){return n.indexOf(r)>=0&&(n="order ( "+n+" , "+r+".CurrentMember.MEMBER_CAPTION,"+u+")"),n})})):i.drilledItems},_updateOlapReport:function(r,u,f,e){var c=this,s,h,o;return f=="rows"?(s=n.map(r,function(n,t){if(r[t].drilledItems!=i)return c._getSortedMembers(n,r)}),t.olap.base._isRowDrilled&&"rows"==t.olap.base._currIndex.axis&&r[t.olap.base._currIndex.Index]!=i&&r[t.olap.base._currIndex.Index].drilledItems!=i?(o=n.map(e,function(n){return n.indexOf("DrillDownlevel")>=0&&(n=n.replace("DrillDownlevel","DrillDownlevel(")+")"),n}),r[t.olap.base._currIndex.Index].drilledItems.push(o),t.olap.base._isRowDrilled=!1):s.length>0&&(t.olap.base._currIndex.axis==i||t.olap.base._currIndex.axis=="columns"&&!t.olap.base._isRowDrilled)&&(u=this._getDrillQuery(s,u,r)),t.isNullOrUndefined(t.olap.base._currIndex.axis)||t.olap.base._currIndex.axis!="rows"||(t.olap.base._currIndex={})):(h=n.map(r,function(n,t){if(r[t].drilledItems!=i)return c._getSortedMembers(n,r)}),t.olap.base._isColDrilled&&"columns"==t.olap.base._currIndex.axis&&r[t.olap.base._currIndex.Index]!=i&&r[t.olap.base._currIndex.Index].drilledItems!=i?(o=n.map(e,function(n){return n.indexOf("DrillDownlevel")>=0&&(n=n.replace("DrillDownlevel","DrillDownlevel(")+")"),n}),r[t.olap.base._currIndex.Index].drilledItems.push(o),t.olap.base._isColDrilled=!1):h.length>0&&(t.olap.base._currIndex.axis==i||t.olap.base._currIndex.axis=="rows"&&!t.olap.base._isColDrilled)&&(u=this._getDrillQuery(h,u,r)),t.isNullOrUndefined(t.olap.base._currIndex.axis)||t.olap.base._currIndex.axis!="columns"||(t.olap.base._currIndex={})),u},_getDrillQuery:function(t,r,u){for(var s,e,h,o="",f=0;f<t.length;f++)if(t[f][t[f].length-1].toLowerCase().indexOf(".children")>=0||t[f][t[f].length-1].toLowerCase().indexOf("DrillDownlevel")>=0||t[f][t[f].length-1].toLowerCase().indexOf("members")>=0||(t[f][t[f].length-1]=t[f][t[f].length-1]+".children"),t[f].length!=u.length){for(s=n.map(u,function(n){if(n.fieldName!=i&&n.fieldName!=t[f][[t[f].length-1]].split(".").splice(0,2).join("."))return{uniqueName:"DrillDownLevel("+n.fieldName.trim()+")",fieldName:n.fieldName.trim()}}),e=0;e<s.length;e++)h=this._getItemPosition(u,s[e].fieldName)[0],t[f].toString().indexOf(s[e].fieldName)>=0||t[f].splice(h,0,s[e].uniqueName);o=o+""+(f>0?",":"")+"\n ("+t[f]+")"}else o=o+""+(f>0?",":"")+"\n ("+t[f].toString()+")\n";return"("+r+"),"+o},_getDimensionQuery:function(n){var r="";return n.drillCellInfo!=i?(r="{("+n.drillCellInfo.uniqueName+")}",delete n.drillCellInfo):r=t.isNullOrUndefined(n.hasAllMember)||!n.hasAllMember?"DrillDownlevel(("+n.fieldName.trim()+"))":"(("+n.fieldName.trim()+").levels(0).members)",r},_updateReport:function(i,r,u,f){u.drillCellInfo=n.extend({},r);u.drillCellInfo.uniqueName="("+u.drillCellInfo.uniqueName.trim()+".children)";var e={action:"drilldown",cellInfo:r};t.olap.base.getJSONData(e,f.model.dataSource,f)},_splitCellInfo:function(n){if(n)var t={hierarchyUniqueName:n.split("::")[1].split(".").splice(0,2).join("."),uniqueName:n.split("::")[0],levelUniqueName:n.split("::")[1],leveName:n.split("::")[2],parentUniqueName:n.split("::")[3]};return t},updateDrilledReport:function(r,u,f){var tt=t.olap._mdxParser,c=null,e,p,w="",l="",k,g,h,v,o,y,nt;if(e=this._splitCellInfo(r.uniqueName),e.targetUName=r.uniqueName,e.previousElements="",p=u=="rowheader"?f.model.dataSource.rows:u=="colheader"?f.model.dataSource.columns:null,p.length>0){k=n.map(p,function(n,t){if(n.fieldName!=i&&n.fieldName.trim().toLowerCase()==e.hierarchyUniqueName.trim().toLowerCase())return{report:n,index:t}});c=k[0].report;e.itemPosition=k[0].index;g=n.map(f._pivotRecords.records,function(n){if(n.Info.replace(/&/g,"&amp;")==r.uniqueName)return n.Index});e.cellIndex=g.length>0?g[0]:r.index;c.drilledItems!=i?c.drilledItems:c.drilledItems=[];t.olap.base._currIndex={axis:u=="rowheader"?"rows":"columns",Index:k[0].index};var a=e.hierarchyUniqueName,b="",w="",s="",d=e.cellIndex.split(",")[0];if(rowPos=e.cellIndex.split(",")[1],u=="rowheader")for(b="rowheader",t.olap.base._isRowDrilled=!0,h=parseInt(d);h>=0;h--)!f._pivotRecords.records[parseInt(h*f._pivotRecords.rowCount+parseInt(d))].Info.indexOf(a)>=0&&(s=f._pivotRecords.records[parseInt(h*f._pivotRecords.rowCount+parseInt(rowPos))].Info,v=this._splitCellInfo(s),v&&(w=v.uniqueName+w),s==""||s.indexOf(a)>=0||(o=this._splitCellInfo(s),o.uniqueName=o.uniqueName.replace(/&/g,"&amp;"),l=o.uniqueName+">#>"+l,currReport=n.map(p,function(n,t){if(n.fieldName!=i&&n.fieldName.trim().toLowerCase()==o.hierarchyUniqueName.trim().toLowerCase())return t}),r.action!="collapse"&&(f.model.dataSource.rows[currReport[0]].drillCellInfo=o),a=o.hierarchyUniqueName));else for(b="colheader",t.olap.base._isColDrilled=!0,h=parseInt(rowPos);h>=0;h--)!f._pivotRecords.records[parseInt(d*f._pivotRecords.rowCount+parseInt(h))].Info.indexOf(a)>=0&&(s=f._pivotRecords.records[parseInt(d*f._pivotRecords.rowCount+parseInt(h))].Info,v=this._splitCellInfo(s),v&&(w=v.uniqueName+">#>"+w),s==""||s.indexOf(a)>=0||(o=this._splitCellInfo(s),o.uniqueName=o.uniqueName.replace(/&/g,"&amp;"),l=o.uniqueName+l,currReport=n.map(p,function(n,t){if(n.fieldName!=i&&n.fieldName.trim().toLowerCase()==o.hierarchyUniqueName.trim().toLowerCase())return t}),r.action!="collapse"&&(f.model.dataSource.columns[currReport[0]].drillCellInfo=o),a=o.hierarchyUniqueName));l+=e.uniqueName;e.previousElements=w.replace(/&amp;/g,"&");e.preRepItm=l.replace(/&amp;/g,"&");e.axis=b;r.action?r.action?(y=t.olap.base._getDrilledMemeber({item:e}),y.length&&t.olap.base._onDemandCollapse({drilledMembers:y},b)):(nt=n(r.drilledMember).clone(!0),t.olap.base._onDemandExpand({action:"drilldown",cellInfo:e,isExist:!0},r.drilledMember)):(y=t.olap.base._getDrilledMemeber({item:e}),y.length&&t.olap.base._onDemandCollapse({drilledMembers:y,action:"collapse"},b),t.olap._mdxParser._updateReport(c.drilledItems,e,c,f))}},_clearCollapsedItems:function(t,r,u){return t=="rowheader"?u.rows=n.map(u.rows,function(t){return t.drilledItems!=i&&t.drilledItems.length&&(t.drilledItems=n.map(t.drilledItems,function(n){if(n.join("").indexOf(r.repItms.replace(/&/g,"&amp;"))<0)return[n]})),t}):t=="colheader"&&(u.columns=n.map(u.columns,function(t){return t.drilledItems!=i&&t.drilledItems.length&&(t.drilledItems=n.map(t.drilledItems,function(n){if(n.join("").indexOf(r.repItms.replace(/&/g,"&amp;"))<0)return[n]})),t})),u},_getSlicerMDX:function(t,r){for(var h,f=n(t)[0].filters,e="",o=this,s=r._fieldData,u=0;u<f.length;u++)h=n.grep(n(t)[0].columns,function(n){return o._getDimensionUniqueName(n.fieldName,s)==o._getDimensionUniqueName(f[u].fieldName,s)}).length>0,h||(h=n.grep(n(t)[0].rows,function(n){return o._getDimensionUniqueName(n.fieldName,s)==o._getDimensionUniqueName(f[u].fieldName,s)}).length>0),h||(f[u].fieldName!=i&&f[u].filterItems==i?e=e+(e!=""?"*":"")+"{"+this._getDimensionQuery(f[u])+"}":f[u].filterItems!=i&&(e=e+(e!=""?"*":"")+"{"+f[u].filterItems.values.toString()+"}"));return e!=""?"where ("+e.replace(/DrillDownlevel/g,"")+")":""},_getDimensionUniqueName:function(t,i){var u=i.hierarchy,r;return u?(r=n.map(u,function(n){if(n.id.toLowerCase()==t.toLowerCase())return n.pid}),r.length>0?r[0]:""):t.split(".")[0]},_getMeasuresQuery:function(t){var u=n(t)[0].values,f=[],e="",s="",r,o;return u.length>0&&(r=jQuery.map(u,function(n,t){if(n.measures!=i)return{measureElements:n.measures,Index:t,axisName:n.axis}}),o=r.length>0?n.map(r[0].measureElements,function(n){return n.fieldName}):null,o!=null?f.push({values:o,Index:r[0].Index}):f,s=u.axis),e=n.map(f,function(n){return n.values.toString()}),e[0]!=""?"{"+e+"}":""},_getIncludefilterQuery:function(t,r,u){var l="FROM ["+r+"]",e="FROM ( SELECT (",o,s,v=u._fieldData,h=[],y="COLUMNS",c,a,f;for(o=n.map(n(t.rows),function(n){if(n.filterItems!=i)return[n.filterItems.values]}),s=n.map(n(t.columns),function(n){if(n.filterItems!=i)return[n.filterItems.values]}),f=0;f<t.filters.length;f++)c=t.filters,a=this,n.map(t.columns,function(n){a._getDimensionUniqueName(n.fieldName,v)==a._getDimensionUniqueName(c[f].fieldName,v)&&c[f].filterItems!=i&&s.push(c[f].filterItems.values)}),n.map(t.rows,function(n){a._getDimensionUniqueName(n.fieldName,v)==a._getDimensionUniqueName(c[f].fieldName,v)&&c[f].filterItems!=i&&o.push(c[f].filterItems.values)});if(t.enableAdvancedFilter){for(f=0;f<=t.columns.length-1;f++)t.columns[f].advancedFilter&&n.merge(h,this._getAdvancedFilterQuery(t.columns[f],e,y));for(f=0;f<=t.rows.length-1;f++)t.rows[f].advancedFilter&&n.merge(h,this._getAdvancedFilterQuery(t.rows[f],e,y))}for(f=0;f<=s.length-1;f++)e=f==0?e+"{"+s[f].toString()+"}":e+",{"+s[f].toString()+"}";for(s.length>0&&(e=o.length>0?e+" ) on COLUMNS ,(":e+" ) on COLUMNS "),f=0;f<=o.length-1;f++)e=f>0?e+",{"+o[f].toString()+"}":e+"{"+o[f].toString()+"}";return e=s.length>0&&o.length>0?e=e+") on ROWS ":s.length==0&&o.length>0?e+") on COLUMNS ":e,h.length>0&&(h=(s.length>0||o.length>0?e:"")+" "+h.join(" ")+" "+l+Array(h.length+1+s.length+o.length).join(")")),l=s.length==0&&o.length==0?l:e+l+")",h.length>0?h:l},_getAdvancedFilterQuery:function(i,r,u){var f=[],e=this;return n.map(i.advancedFilter,function(r){t.isNullOrUndefined(r.labelFilterOperator)&&r.labelFilterOperator==t.olap.LabelFilterOptions.None&&t.isNullOrUndefined(r.valueFilterOperator)&&r.valueFilterOperator==t.olap.ValueFilterOptions.None||f.push("FROM (SELECT Filter("+n.trim(r.name)+".AllMembers, "+e._getAdvancedFilterCondtions(i.fieldName,r.advancedFilterType==t.olap.AdvancedFilterType.LabelFilter||t.isNullOrUndefined(r.advancedFilterType)?r.labelFilterOperator:r.valueFilterOperator,r.values,r.advancedFilterType,r.measure)+")) on "+u)}),f},_getAdvancedFilterCondtions:function(n,i,r,u,f){var e="",u=t.isNullOrUndefined(u)?"label":u;switch(i.toLowerCase()){case"equals":e="("+(u!="value"?n+'.CurrentMember.member_caption ="'+r[0]+'"':f+" = "+r[0]);break;case"notequals":e="("+(u!="value"?n+'.CurrentMember.member_caption &lt;&gt;"'+r[0]+'"':f+" &lt;&gt;"+r[0]);break;case"contains":e="( InStr (1,"+n+'.CurrentMember.member_caption,"'+r[0]+'")&gt;0';break;case"notcontains":e="( InStr (1,"+n+'.CurrentMember.member_caption,"'+r[0]+'")=0';break;case"beginswith":e="( Left ("+n+".CurrentMember.member_caption,"+r[0].length+')="'+r[0]+'"';break;case"notbeginswith":e="( Left ("+n+".CurrentMember.member_caption,"+r[0].length+')&lt;&gt;"'+r[0]+'"';break;case"endswith":e="( Right ("+n+".CurrentMember.member_caption,"+r[0].length+')="'+r[0]+'"';break;case"notendswith":e="( Right ("+n+".CurrentMember.member_caption,"+r[0].length+')&lt;&gt;"'+r[0]+'"';break;case"greaterthan":e="("+(u!="value"?n+'.CurrentMember.member_caption &gt;"'+r[0]+'"':f+" &gt;"+r[0]+"");break;case"greaterthanorequalto":e="("+(u!="value"?n+'.CurrentMember.member_caption &gt;="'+r[0]+'"':f+" &gt;="+r[0]+"");break;case"lessthan":e="("+(u!="value"?n+'.CurrentMember.member_caption &lt;"'+r[0]+'"':f+" &lt;"+r[0]+"");break;case"lessthanorequalto":e="("+(u!="value"?n+'.CurrentMember.member_caption &lt;="'+r[0]+'"':f+" &lt;="+r[0]+"");break;case"between":e="("+(u!="value"?n+'.CurrentMember.member_caption &gt;="'+r[0]+'"AND '+n+'.CurrentMember.member_caption &lt;="'+r[1]+'"':f+" &gt;="+r[0]+" AND "+f+"&lt;="+r[1]);break;case"notbetween":e="("+(u!="value"?n+'.CurrentMember.member_caption &gt;="'+r[0]+'"OR '+n+'.CurrentMember.member_caption &lt;="'+r[1]+'"':f+" &gt;="+r[0]+" OR "+f+"&lt;="+r[1]);break;default:e="( InStr (1,"+n+'.CurrentMember.member_caption,"'+r[0]+'")&gt;0'}return e},_getItemPosition:function(t,r){return n.map(t,function(n,t){if(n.fieldName!=i&&n.fieldName.trim()==r.trim())return t})}};t.olap.SortOrder={None:"none",Ascending:"ascending",Descending:"descending"};t.olap.AdvancedFilterType={LabelFilter:"label",ValueFilter:"value"};t.olap.ValueFilterOptions={None:"none",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"};t.olap.LabelFilterOptions={None:"none",BeginsWith:"beginswith",NotBeginsWith:"notbeginswith",EndsWith:"endswith",NotEndsWith:"notendswith",Contains:"contains",NotContains:"notcontains",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"};t.olap.AxisName={Row:"rows",Column:"columns"}})(jQuery,Syncfusion)});
