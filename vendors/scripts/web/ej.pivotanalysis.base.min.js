/*!
*  filename: ej.pivotanalysis.base.min.js
*  version : 12.3
*  Copyright Syncfusion Inc. 2001 - 2014. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min"],n):n()})(function(){(function($,ej,undefined){var colKeysCalcValues=[],rowKeysCalcValues=[],tableKeysCalcValues=[],gridMatrix=null,columnHeaders=null,valueArea=null,rowTotCalc=[],colTotCalc=[],transposeEngine=[],tRowCnt=0,tColCnt=0,cellType="",sortedElements,filteredMembers,fieldMembers={},summaryTypes=[],locale="en-US";ej.PivotAnalysis={pivotEnginePopulate:function(model){var dataSource=model.dataSource,transposeEngine=[],cnt,nC,outputString,rC,cC,val,treeviewData,t,checkedState,i,j,formula,k,oldValue,newValue,rCnt,emptyCellColSpan,tcnt,cCnt;locale=model.locale;var colAxis=dataSource.columns,rowAxis=dataSource.rows,filters=dataSource.filters,calcValues=dataSource.values,colLen,jsonObj=[],pivotFieldList=[],rowLen;for(summaryTypes=[],i=0;i<calcValues.length;i++)summaryTypes.push(calcValues[i].summaryType!=null&&calcValues[i].summaryType!=undefined?calcValues[i].summaryType:ej.PivotAnalysis.SummaryType.Sum);if(dataSource.data!=null)for(cnt=0;cnt<dataSource.data.length;cnt++){list=dataSource.data[cnt];var table={keys:[],uniqueName:"",value:null},row={keys:[],uniqueName:"",value:null},col={keys:[],uniqueName:"",value:null},values={keys:[],uniqueName:"",value:null},isExcluded=!1;for(i=0;i<filters.length;i++)if(val=this._getReflectedValue(list,filters[i].fieldName,null),fieldMembers[filters[i].fieldName]==undefined||fieldMembers[filters[i].fieldName]==null?fieldMembers[filters[i].fieldName]=[val]:$.inArray(val,fieldMembers[filters[i].fieldName])==-1&&fieldMembers[filters[i].fieldName].push(val),filters[i].filterItems!=null&&filters[i].filterItems!=undefined&&((filters[i].filterItems.filterType==ej.PivotAnalysis.FilterType.Exclude||filters[i].filterItems.filterType==null)&&$.inArray(val!=null?val.toString():val,filters[i].filterItems.values)>=0||filters[i].filterItems.filterType==ej.PivotAnalysis.FilterType.Include&&$.inArray(val!=null?val.toString():val,rowAxis[rC].filterItems.values)<0)){isExcluded=!0;break}for(nC=0;nC<calcValues.length;nC++)val="",calcValues[nC]!=undefined&&calcValues[nC]!=null&&(val=this._getReflectedValue(list,calcValues[nC].fieldName,calcValues[nC].format),fieldMembers[calcValues[nC].fieldName]==undefined||fieldMembers[calcValues[nC].fieldName]==null?fieldMembers[calcValues[nC].fieldName]=[val]:$.inArray(val,fieldMembers[calcValues[nC].fieldName])==-1&&fieldMembers[calcValues[nC].fieldName].push(val)),outputString=val!=null?val.toString().replace(/([AMPME~!@#$%^&*()_+=`{}\[\]\|\\:;'<>,.\/? ])+/g,""):"0",outputString=outputString.replace(ej.globalize.preferredCulture(locale).numberFormat.currency.symbol,""),$.isNumeric(outputString)?values.keys.push(val):values.keys.push(1);for(rC=0;rC<rowAxis.length;rC++){if(val="",rowAxis[rC]!=undefined&&rowAxis[rC]!=null&&(val=this._getReflectedValue(list,rowAxis[rC].fieldName,null),fieldMembers[rowAxis[rC].fieldName]==undefined||fieldMembers[rowAxis[rC].fieldName]==null?fieldMembers[rowAxis[rC].fieldName]=[val]:$.inArray(val,fieldMembers[rowAxis[rC].fieldName])==-1&&fieldMembers[rowAxis[rC].fieldName].push(val),rowAxis[rC].filterItems!=null&&rowAxis[rC].filterItems!=undefined&&((rowAxis[rC].filterItems.filterType==ej.PivotAnalysis.FilterType.Exclude||rowAxis[rC].filterItems.filterType==null)&&$.inArray(val!=null?val.toString():val,rowAxis[rC].filterItems.values)>=0||rowAxis[rC].filterItems.filterType==ej.PivotAnalysis.FilterType.Include&&$.inArray(val!=null?val.toString():val,rowAxis[rC].filterItems.values)<0))){isExcluded=!0;break}val!=null&&val.toString().replace(/^\s+|\s+$/gm,"")||(val="(blank)");row.keys.push(val);row.uniqueName+=row.uniqueName==""?val:"."+val;table.keys.push(val);table.uniqueName+=table.uniqueName==""?val:"."+val}for(cC=0;cC<colAxis.length;cC++){if(val="",colAxis[cC]!=undefined&&colAxis[cC]!=null&&(val=this._getReflectedValue(list,colAxis[cC].fieldName,null),fieldMembers[colAxis[cC].fieldName]==undefined||fieldMembers[colAxis[cC].fieldName]==null?fieldMembers[colAxis[cC].fieldName]=[val]:$.inArray(val,fieldMembers[colAxis[cC].fieldName])==-1&&fieldMembers[colAxis[cC].fieldName].push(val),colAxis[cC].filterItems!=null&&colAxis[cC].filterItems!=undefined&&((colAxis[cC].filterItems.filterType==ej.PivotAnalysis.FilterType.Exclude||colAxis[cC].filterItems.filterType==null)&&$.inArray(val!=null?val.toString():val,colAxis[cC].filterItems.values)>=0||colAxis[cC].filterItems.filterType==ej.PivotAnalysis.FilterType.Include&&$.inArray(val!=null?val.toString():val,colAxis[cC].filterItems.values)<0))){isExcluded=!0;break}val!=null&&val.toString().replace(/^\s+|\s+$/gm,"")||(val="(blank)");col.keys.push(val);col.uniqueName+=col.uniqueName==""?val:"."+val;table.keys.push(val);table.uniqueName+=table.uniqueName==""?val:"."+val}for(isExcluded||(this._isMemberExist("row",row,$.extend(!0,{},values),dataSource),this._isMemberExist("column",col,$.extend(!0,{},values),dataSource),this._isMemberExist("calc",table,$.extend(!0,{},values),dataSource)),jQuery.each(list,function(n){jQuery.inArray(n,pivotFieldList)==-1&&pivotFieldList.push(n)}),treeviewData=[],jQuery.each(calcValues,function(n,t){t.isCalculatedField==!0&&jQuery.inArray(t.fieldCaption,pivotFieldList)==-1&&pivotFieldList.push(t.fieldCaption)}),t=0;t<pivotFieldList.length;t++)checkedState=$.grep(dataSource.rows,function(n){return n.fieldName==pivotFieldList[t]}).length>0||$.grep(dataSource.columns,function(n){return n.fieldName==pivotFieldList[t]}).length>0||$.grep(dataSource.values,function(n){return n.fieldName==pivotFieldList[t]}).length>0||$.grep(dataSource.filters,function(n){return n.fieldName==pivotFieldList[t]}).length>0,treeviewData.push({id:pivotFieldList[t],name:pivotFieldList[t],isSelected:checkedState,spriteCssClass:""})}for(i=0;i<calcValues.length;i++)if(calcValues[i].isCalculatedField)for(j=0;j<tableKeysCalcValues.length;j++){for(formula=calcValues[i].formula.replace(/\s/g,""),k=0;k<calcValues.length;k++)calcValues[k].isCalculatedField!=!0&&(formula=formula.replace(new RegExp(calcValues[k].fieldCaption,"g"),ej.globalize.parseFloat(tableKeysCalcValues[j].value.keys[k]==null?"0":calcValues[k].format=="date"?this._dateToInt(tableKeysCalcValues[j].value.keys[k].toString()).toString():calcValues[k].format=="time"?this._dateToInt(new Date("1900",tableKeysCalcValues[j].value.keys[k].toString().split(":")[0],tableKeysCalcValues[j].value.keys[k].toString().split(":")[1],tableKeysCalcValues[j].value.keys[k].toString().split(":")[2].split(" ")[0]).toString()).toString():tableKeysCalcValues[j].value.keys[k].toString())));formula.indexOf("^")>-1&&(formula=this._powerFunction(formula));oldValue=dataSource.values[i].format==null?eval(formula):eval(formula).toString();newValue=dataSource.values[i].format==null?0:"0";tableKeysCalcValues[j].value.keys[i]=this._getSummaryValue(oldValue,newValue,1,summaryTypes[i],dataSource.values[i].format)}for(rowAxis.length>0&&(rowKeysCalcValues=this._sortHeaders(rowKeysCalcValues,rowAxis,0)),colAxis.length>0&&(colKeysCalcValues=this._sortHeaders(colKeysCalcValues,colAxis,0)),colAxis.length>0&&this._insertTotalHeader(colAxis,colKeysCalcValues),rowAxis.length>0?this._insertTotalHeader(rowAxis,rowKeysCalcValues):calcValues.length>0&&(rowKeysCalcValues[0].keys[0]="Grand Total"),tRowCnt=0,tColCnt=0,this._calculateValues(dataSource),colTotCalc=[],rowTotCalc=[],colKeysCalcValues=[],rowKeysCalcValues=[],tableKeysCalcValues=[],rCnt=0;rCnt<tRowCnt-1;rCnt++)for(cCnt=0;cCnt<tColCnt-1;cCnt++)transposeEngine[cCnt]==undefined&&(transposeEngine[cCnt]=[]),gridMatrix[rCnt]!=undefined&&gridMatrix[rCnt][cCnt]!=undefined?transposeEngine[cCnt][rCnt]={Index:cCnt+","+rCnt,CSS:gridMatrix[rCnt][cCnt].CSS,Value:typeof gridMatrix[rCnt][cCnt]=="string"||typeof gridMatrix[rCnt][cCnt]=="number"||typeof gridMatrix[rCnt][cCnt]=="object"?gridMatrix[rCnt][cCnt].Value==0?"":gridMatrix[rCnt][cCnt].Value==undefined?"":gridMatrix[rCnt][cCnt].Value:"",State:gridMatrix[rCnt][cCnt].State,RowSpan:gridMatrix[rCnt][cCnt].RowSpan!=undefined?gridMatrix[rCnt][cCnt].RowSpan:1,ColSpan:gridMatrix[rCnt][cCnt].ColSpan!=undefined?gridMatrix[rCnt][cCnt].ColSpan:1,Info:"",Span:"None",Expander:gridMatrix[rCnt][cCnt].Expander}:gridMatrix[rCnt]!=undefined&&(transposeEngine[cCnt][rCnt]={Index:cCnt+","+rCnt,CSS:"none",Value:"",State:0,RowSpan:1,ColSpan:1,Info:"",Span:"None",Expander:0});for(rCnt=0;rCnt<tColCnt-1;rCnt++){if(rowAxis.length=rowAxis.length==0?1:rowAxis.length,rCnt<rowAxis.length)for(emptyCellColSpan=colAxis.length+(dataSource.values.length>0?1:0),emptyCellColSpan==0&&rowAxis.length>0&&(emptyCellColSpan=1),tcnt=0;tcnt<emptyCellColSpan;tcnt++)gridMatrix.length>0&&jsonObj.push({Index:rCnt+","+tcnt,CSS:"none",Value:"",State:0,ColSpan:rCnt==0&&tcnt==0?rowAxis.length:1,RowSpan:rCnt==0&&tcnt==0?colAxis.length+(dataSource.values.length>0?1:0):1,Info:"",Span:"None",Expander:0});for(cCnt=0;cCnt<tRowCnt-1;cCnt++)transposeEngine[rCnt]==undefined||transposeEngine[rCnt][cCnt]==undefined||cCnt<colAxis.length+(dataSource.values.length>0?1:0)&&rCnt<rowAxis.length||jsonObj.push(transposeEngine[rCnt][cCnt])}return gridMatrix=[],dataSource.rows[0]==undefined&&(dataSource.rows.length=0),{json:jsonObj,pivotEngine:transposeEngine,report:dataSource,treeviewData:treeviewData}},getMembers:function(n){return fieldMembers[n]},_powerFunction:function(n){if(n.indexOf("^")>-1){for(var t=[];n.indexOf("(")>-1;)n=n.replace(/(\([^\(\)]*\))/g,function(n,i){return t.push(i),"~"+(t.length-1)});for(t.push(n),n="~"+(t.length-1);n.indexOf("~")>-1;)n=n.replace(new RegExp("~(\\d+)","g"),function(n,i){return t[i].replace(/(\w*)\^(\w*)/g,"Math.pow($1,$2)")})}return n},_calculatedFieldSummaryValue:function(index,calValue,dataSource){var formula,i,oldValue,newValue;if(dataSource.values[index].isCalculatedField==!0){for(formula=dataSource.values[index].formula.replace(/\s/g,""),i=0;i<dataSource.values.length;i++)dataSource.values[i].isCalculatedField!=!0&&(formula=formula.replace(new RegExp(dataSource.values[i].fieldCaption,"g"),ej.globalize.parseFloat(calValue[i]==null?"0":dataSource.values[i].format=="date"?this._dateToInt(calValue[i].toString()).toString():dataSource.values[i].format=="time"?this._dateToInt(new Date("1900",calValue[i].toString().split(":")[0],calValue[i].toString().split(":")[1],calValue[i].toString().split(":")[2].split(" ")[0]).toString()).toString():calValue[i].toString())));return formula.indexOf("^")>-1&&(formula=this._powerFunction(formula)),oldValue=dataSource.values[index].format==null?eval(formula):eval(formula).toString(),newValue=dataSource.values[index].format==null?0:"0",this._getSummaryValue(oldValue,newValue,1,summaryTypes[index]=="count"?"sum":summaryTypes[index],dataSource.values[index].format)}},_sortHeaders:function(n,t,i){for(var r=[],e=[],u=0,f=ej.DataManager(n).executeLocal(ej.Query().sortBy("keys."+i,t[i].sortOrder!=null&&t[i].sortOrder==ej.PivotAnalysis.SortOrder.Descending?ej.sortOrder.Descending:ej.sortOrder.Ascending,!1)),o;u<f.length;)o=f[u].keys[i],r=$.grep(f,function(n){return n.keys[i]==o}),r.length>1&&i+1<f[u].keys.length&&(r=this._sortHeaders(r,t,i+1)),e=e.concat(r),u+=r.length;return e},_getReflectedValue:function(n,t,i){var r=$(n).prop(t);if(r==null)return r;switch(i){case"percentage":r=ej.widgetBase.formatting("{0:P}",r,locale);break;case"decimal":case"number":r=ej.widgetBase.formatting("{0:N}",r,locale);break;case"currency":r=ej.widgetBase.formatting("{0:C2}",r,locale);break;case"date":r=new Date((Number(r)-2)*864e5+new Date("01/01/1900").getTime());this._isDateTime(r)&&(r=ej.widgetBase.formatting("{0:MM/dd/yyyy}",r,"en-US"));break;case"scientific":r=r.toExponential(2).replace("e","E");break;case"accounting":r=this._toAccounting(r,"{0:C2}",locale);break;case"time":r=new Date((Number(r)-2)*864e5+new Date("01/01/1900").getTime());this._isDateTime(r)&&(r=ej.widgetBase.formatting("{0:h:mm:ss tt}",r,locale));break;case"fraction":r=this._toFraction(r);r="numerator"in r?r.integer+" "+r.numerator+"/"+r.denominator:r.integer;break;default:r}return r},_isDateTime:function(n){return Object.prototype.toString.call(n)==="[object Date]"&&!isNaN(n.valueOf())},_toAccounting:function(n,t,i){var s=ej.preferredCulture(i).numberFormat,u,f,r=s.currency.symbol,e,o;return val=ej.widgetBase.formatting(t,n),e=val.replace(r,""),o=val.indexOf(r),!o||n<0&&o===1?(u=r,f=Number(n)?e:"-"):(u=Number(n)?e:"-",f=r),u+"   "+f},_toFraction:function(n){if(this._isNumber(n)){var r=n.toString(),e=r.split(".")[0],t=r.split(".")[1];if(!t)return{integer:n};var i=(+t).toString(),u=this._getPlaceValue(t,i),f=this._getGCD(i,u);return{integer:e,numerator:Number(i)/f,denominator:Number(u)/f}}return null},_isNumber:function(n){return n-parseFloat(n)>=0},_getGCD:function(n,t){return(n=Number(n),t=Number(t),!t)?n:this._getGCD(t,n%t)},_getPlaceValue:function(n,t){var i=n.indexOf(t)+t.length;return"1"+Array(i+1).join("0")},_isMemberExist:function(n,t,i,r){var f,s,e,u,o;switch(n){case"row":for(s=!1,rowKeysCalcValues.length==0&&rowKeysCalcValues.push(t),e=0;e<rowKeysCalcValues.length;e++)if(t.uniqueName==rowKeysCalcValues[e].uniqueName){s=!0;f=e;break}if(s)for(u=0;u<i.keys.length;u++)if(rowKeysCalcValues[f].value==null){rowKeysCalcValues[f].value=i;break}else rowKeysCalcValues[f].value.keys[u]+=i.keys[u];else rowKeysCalcValues.push(t);break;case"column":for(s=!1,colKeysCalcValues.length==0&&(r.columns.length>0||r.values.length>0)&&colKeysCalcValues.push(t),e=0;e<colKeysCalcValues.length;e++)if(t.uniqueName==colKeysCalcValues[e].uniqueName){s=!0;f=e;break}if(s)for(u=0;u<i.keys.length;u++)if(colKeysCalcValues[f].value==null){colKeysCalcValues[f].value=i;break}else colKeysCalcValues[f].value.keys[u]+=i.keys[u];else(r.columns.length>0||r.values.length>0)&&colKeysCalcValues.push(t);break;case"calc":for(s=!1,tableKeysCalcValues.length==0&&tableKeysCalcValues.push(t),e=0;e<tableKeysCalcValues.length;e++)if(t.uniqueName==tableKeysCalcValues[e].uniqueName){s=!0;f=e;break}if(s)for(u=0;u<i.keys.length;u++)if(tableKeysCalcValues[f].value==null){for(tableKeysCalcValues[f].value=i,tableKeysCalcValues[f].value.count=1,o=0;o<i.keys.length;o++)summaryTypes[o]==ej.PivotAnalysis.SummaryType.Count&&(tableKeysCalcValues[f].value.keys[o]=tableKeysCalcValues[f].value.count);break}else tableKeysCalcValues[f].value.count++,r.values[u].isCalculatedField!=!0&&(tableKeysCalcValues[f].value.keys[u]=this._getSummaryValue(tableKeysCalcValues[f].value.keys[u],i.keys[u],tableKeysCalcValues[f].value.count,summaryTypes[u],r.values[u].format));else for(tableKeysCalcValues.push(t),tableKeysCalcValues[tableKeysCalcValues.length-1].value=i,o=0;o<i.keys.length;o++)summaryTypes[o]==ej.PivotAnalysis.SummaryType.Count&&(tableKeysCalcValues[tableKeysCalcValues.length-1].value.keys[o]=1),tableKeysCalcValues[tableKeysCalcValues.length-1].value.count=1}},_getSummaryValue:function(oldValue,newValue,count,type,format){var time;switch(format){case"date":oldValue=ej.parseDate(oldValue,"MM/dd/yyyy","en-US")!=null?this._dateToInt(oldValue):oldValue;newValue=ej.parseDate(newValue,"MM/dd/yyyy","en-US")!=null?this._dateToInt(newValue):newValue;break;case"percentage":oldValue=oldValue!=0?ej.globalize.parseFloat(oldValue,locale)/100:oldValue;newValue=ej.globalize.parseFloat(newValue,locale)/100;break;case"currency":case"accounting":oldValue=oldValue!=0?ej.globalize.parseFloat(ej.globalize.format(oldValue,"c",locale),locale):oldValue;newValue=ej.globalize.parseFloat(ej.globalize.format(newValue,"c",locale),locale);break;case"decimal":case"number":oldValue=oldValue!=0?ej.globalize.parseFloat(oldValue,locale):oldValue;newValue=ej.globalize.parseFloat(newValue,locale);break;case"scientific":oldValue=oldValue!=0?parseFloat(oldValue):oldValue;newValue=parseFloat(newValue);break;case"time":this._isNumber(oldValue)||(time=oldValue.toString().split(":"),time=new Date("1900",time[0],time[1],time[2].split(" ")[0]).toString(),oldValue=this._dateToInt(time));this._isNumber(newValue)||(time=newValue.toString().split(":"),time=new Date("1900",time[0],time[1],time[2].split(" ")[0]).toString(),newValue=this._dateToInt(time));break;case"fraction":var temp1=parseFloat(oldValue.toString().split(" ")[0]),temp2=eval(oldValue.toString().split(" ")[1])!=undefined?parseFloat(eval(oldValue.toString().split(" ")[1])):parseFloat(0),temp3=parseFloat(newValue.toString().split(" ")[0]),temp4=eval(newValue.toString().split(" ")[1])!=undefined?parseFloat(eval(newValue.toString().split(" ")[1])):parseFloat(0);oldValue=oldValue!=0?temp1+temp2:oldValue;newValue=temp3+temp4}switch(type){case ej.PivotAnalysis.SummaryType.Sum:oldValue+=newValue;break;case ej.PivotAnalysis.SummaryType.Average:oldValue=(oldValue*(count-1)+newValue)/count;Math.floor(oldValue)!=oldValue&&(oldValue=Number(oldValue.toFixed(2)));break;case ej.PivotAnalysis.SummaryType.Min:oldValue=count==1?newValue:Math.min(oldValue,newValue);break;case ej.PivotAnalysis.SummaryType.Max:oldValue=count==1?newValue:Math.max(oldValue,newValue);break;case ej.PivotAnalysis.SummaryType.Count:oldValue=count}switch(format){case"percentage":oldValue=ej.widgetBase.formatting("{0:P}",oldValue,locale);break;case"decimal":case"number":oldValue=ej.widgetBase.formatting("{0:N}",oldValue,locale);break;case"date":oldValue=new Date((Number(oldValue)-2)*864e5+new Date("01/01/1900").getTime());this._isDateTime(oldValue)&&(oldValue=ej.widgetBase.formatting("{0:MM/dd/yyyy}",oldValue,"en-US"));break;case"currency":oldValue=ej.widgetBase.formatting("{0:C2}",oldValue,locale);break;case"scientific":oldValue=oldValue.toExponential(2).replace("e","E");break;case"accounting":oldValue=this._toAccounting(oldValue,"{0:C2}",locale);break;case"time":oldValue=new Date((Number(oldValue)-2)*864e5+new Date("01/01/1900").getTime());this._isDateTime(oldValue)&&(oldValue=ej.widgetBase.formatting("{0:h:mm:ss tt}",oldValue,locale));break;case"fraction":oldValue=this._toFraction(oldValue);oldValue="numerator"in oldValue?oldValue.integer+" "+oldValue.numerator+"/"+oldValue.denominator:oldValue.integer;break;default:oldValue}return oldValue},_dateToInt:function(n){var t=new Date("01/01/1900"),i=this._isDateTime(n)?n:new Date(n),r=i.getTime()-t.getTime();return r/864e5+2},_insertTotalHeader:function(n,t){var s,r,o,u,h,i;if(n.length<=1){t.push({cellType:"RGTot",keys:["Grand Total"],tot:"sub"});return}for(s=-1,r=n.length-2;r>=0;r--)if(s++,o=t.length,o>0){u=t[0].uniqueName.split(".");h=t[0].keys[s];u=u.slice(0,r+1).join(".");var e="",f=0,c="";for(i=1;i<=o;i++)t[i]!=undefined?(e=t[i].uniqueName.split("."),e=e.slice(0,r+1).join("."),c=t[i].keys[r+1]):e=undefined,e!=undefined&&e.indexOf("Total")==-1?u!=undefined&&e!=u&&(t.splice(i,0,{keys:[u.split(".")[r]+" Total"],cellType:"SubTot",uniqueName:u,level:r}),t[f].span==undefined&&(t[f].span=[]),t[f].span[r]=i-f,i++,o++,u=e,f=i,h=c):u!=undefined&&(t.splice(i,0,{keys:[u.split(".")[r]+" Total"],cellType:"SubTot:",uniqueName:u,level:r}),t[f].span==undefined&&(t[f].span=[]),t[f].span[r]=i-f,i++,o++,u=e,f=i,h=c)}t.push({cellType:"RGTot",keys:["Grand Total"]})},_isPreviousLevelEqual:function(n,t,i,r){for(var u=r-1;u>=0;u--)return n[t].keys[u]!=n[i].keys[u]?!0:!1},_calculateValues:function(n){var t=rowKeysCalcValues.length+(n.values.length>0?1:0),u=colKeysCalcValues.length==0?1:colKeysCalcValues.length*(n.values.length==0?1:n.values.length)+1,i,r;gridMatrix=new Array(t+n.rows.length+1);this._populateRowHeaders(n,t+n.rows.length+1,n.rows.length==0?1:n.rows.length);i=n.columns.length+1;r=u+(n.rows.length==0?1:n.rows.length);this._populateColumnHeaders(n,i,r);n.values.length>0&&this._populateCalcTable(n);tRowCnt=t+i;tColCnt=r},_populateRowHeaders:function(n,t,i){var u,c,r,h;if(rowKeysCalcValues.length!=0){for(u=n.columns.length+(n.values.length>0?1:0),gridMatrix=[],c="",r=0;r<rowKeysCalcValues.length;r++){c=rowKeysCalcValues[r];var e=0,f=0,o=0,s=0;if(rowKeysCalcValues[r].keys!=undefined&&rowKeysCalcValues[r].keys.length!=0)for(gridMatrix[u]=new Array(i),s=rowKeysCalcValues[r].keys.length,kCnt=0;kCnt<s;kCnt++)rowKeysCalcValues[r].cellType!=undefined?rowKeysCalcValues[r].cellType.indexOf("SubTot")>-1?(f=rowKeysCalcValues[r].level+e,o=i-rowKeysCalcValues[r].level,cellType="summary rstot"):(cellType="summary rgtot",f=e,o=n.rows.length):(cellType="rowheader",f=e,o=1),h=s>1?s-kCnt>1?1:0:0,gridMatrix[u][f]={Index:f+","+u,CSS:cellType,Value:rowKeysCalcValues[r].keys[kCnt],State:h,RowSpan:rowKeysCalcValues[r].span!=undefined?rowKeysCalcValues[r].span[kCnt]:1,ColSpan:o,Info:"",Span:"None",Expander:h},e++;u++}cellType=""}},_populateColumnHeaders:function(n,t){var i,e,u;if(colKeysCalcValues.length!=0){var o=tempCnt=n.rows.length==0?1:n.rows.length,f=n.values.length==0?1:n.values.length,s=n.columns.length,h="",r=colKLen=0;for(i=0;i<colKeysCalcValues.length;i++){for(r=0,tempRIndx=0,tempRSpan=0,tempCSpan=0,h=colKeysCalcValues[i].keys,gridMatrix[r]==undefined&&(gridMatrix[r]=[]),colKLen=colKeysCalcValues[i].keys.length,kCnt=0;kCnt<colKLen;kCnt++){for(gridMatrix[r]==undefined&&(gridMatrix[r]=[]),colKeysCalcValues[i].cellType!=undefined?colKeysCalcValues[i].cellType.indexOf("SubTot")>-1?(tempRIndx=colKeysCalcValues[i].level+r,tempRSpan=t-colKeysCalcValues[i].level-1,cellType="summary cstot"):(tempRIndx=r,tempRSpan=n.columns.length,cellType="summary cgtot"):(tempRIndx=r,tempRSpan=1,cellType="colheader"),e=colKLen>1?colKLen-kCnt>1?1:0:0,u=0;u<f;u++)gridMatrix[tempRIndx][f*i+u+tempCnt]={Index:o+","+tempRIndx,CSS:cellType,Value:colKeysCalcValues[i].keys[kCnt],State:e,ColSpan:(colKeysCalcValues[i].span!=undefined?colKeysCalcValues[i].span[kCnt]==undefined?1:colKeysCalcValues[i].span[kCnt]:1)*f,RowSpan:tempRSpan,Info:"",Span:"None",Expander:e};r++}if(n.values.length>0)for(u=0;u<f;u++)gridMatrix[r]==undefined&&(gridMatrix[r]=[]),gridMatrix[s][f*i+u+tempCnt]={Index:f*i+u+tempCnt+","+r,CSS:cellType+" calc",Value:n.values[u].fieldName,State:0,ColSpan:1,RowSpan:1,Info:"",Span:"None",Expander:0};o++}cellType=""}},_populateCalcTable:function(n){for(var d,v,f,s,w,i,h,l,t=[],e=n.values.length,u=n.rows.length==0?1:n.rows.length,o=n.columns.length+1,b=0,y=!1,a=0,k=o,c,p=!1,r=0;r<rowKeysCalcValues.length;r++){for(colTotCalc=[],c=u,y=!0,gridMatrix[r+o]==undefined&&(gridMatrix[r+o]=[]),rowTotCalc[a]=[],cCnt=0;cCnt<colKeysCalcValues.length;cCnt++){if(t=[],cellType="value",n.columns.length>0&&n.rows.length>0?$.grep(tableKeysCalcValues,function(n){if(n.uniqueName==rowKeysCalcValues[r].uniqueName+"."+colKeysCalcValues[cCnt].uniqueName)for(i=0;i<n.value.keys.length;i++)t.push(n.value.keys[i]);return}):n.rows.length==0?$.grep(tableKeysCalcValues,function(n){if(n.uniqueName==colKeysCalcValues[cCnt].uniqueName)for(i=0;i<n.value.keys.length;i++)t.push(n.value.keys[i]);return}):$.grep(tableKeysCalcValues,function(n){if(n.uniqueName==rowKeysCalcValues[r].uniqueName)for(i=0;i<n.value.keys.length;i++)t.push(n.value.keys[i]);return}),colKeysCalcValues[cCnt].cellType!=undefined&&(colKeysCalcValues[cCnt].cellType.indexOf("SubTot")>-1||colKeysCalcValues[cCnt].cellType.indexOf("RGTot")>-1)){for(t=[],i=0;i<e;i++)for(h=0,f=0,s=c;s<=cCnt*e+u;s++)gridMatrix[r+o]!=undefined&&gridMatrix[r+o][c+h*e+i]!=undefined&&gridMatrix[r+o][c+h*e+i].Value!=undefined&&(t[i]==undefined&&(t[i]=0),f++,t[i]=n.values[i].isCalculatedField?this._calculatedFieldSummaryValue(i,t,n):this._getSummaryValue(t[i],gridMatrix[r+o][c+h*e+i].Value,f,summaryTypes[i]=="count"?"sum":summaryTypes[i],n.values[i].format)),h++;b=0;c=(cCnt+1)*e+u;t!=0&&colTotCalc.push({uniqueName:colKeysCalcValues[cCnt].uniqueName,level:colKeysCalcValues[cCnt].level,value:t});colKeysCalcValues[cCnt-1]!=undefined&&colKeysCalcValues[cCnt-1].cellType!=undefined&&colKeysCalcValues[cCnt-1].cellType.indexOf("SubTot")>-1&&colKeysCalcValues[cCnt-1].cellType.indexOf("RGTot")==-1&&(v=$(colTotCalc).filter(function(n,t){return t!=undefined&&t.uniqueName!=undefined&&colKeysCalcValues[cCnt].uniqueName!=undefined&&t.level!=undefined&&colKeysCalcValues[cCnt].level!=undefined&&t.uniqueName.indexOf(colKeysCalcValues[cCnt].uniqueName)===0&&colKeysCalcValues[cCnt].level+1==t.level}).map(function(i,r){for(var u=0;u<r.value.length;u++)t[u]==undefined&&(t[u]=0),n.values[u].isCalculatedField?t[u]=ej.PivotAnalysis._calculatedFieldSummaryValue(u,t,n):t[u]+=r.value[u];return t}),t!=0&&colTotCalc.push({uniqueName:colKeysCalcValues[cCnt].uniqueName,level:colKeysCalcValues[cCnt].level,value:t}));cellType="summary value"}if(colKeysCalcValues[cCnt].cellType!=undefined&&colKeysCalcValues[cCnt].cellType.indexOf("RGTot")>-1&&t==0&&(t=[],f=0,v=$(colTotCalc).filter(function(n,t){return t!=undefined&&t!=undefined&&t.level!=undefined&&t.level==0}).map(function(i,r){for(var u=0;u<r.value.length;u++)t[u]==undefined&&(t[u]=0),f++,t[u]=n.values[u].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(u,t,n):ej.PivotAnalysis._getSummaryValue(t[u],r.value[u],f,summaryTypes[u]=="count"?"sum":summaryTypes[u],n.values[u].format);return t}),cellType="summary value"),rowKeysCalcValues[r].cellType!=undefined&&(rowKeysCalcValues[r].cellType.indexOf("SubTot")>-1||rowKeysCalcValues[r].cellType.indexOf("RGTot")>-1)){for(t=[],d=rowKeysCalcValues[r].uniqueName,rowKeysCalcValues[r-1]!=undefined&&rowKeysCalcValues[r-1].cellType!=undefined&&rowKeysCalcValues[r-1].cellType.indexOf("SubTot")>-1&&rowKeysCalcValues[r].cellType.indexOf("RGTot")==-1&&(f=0,v=$(rowTotCalc).filter(function(n,t){return t[0]!=undefined&&t[0].uniqueName!=undefined&&rowKeysCalcValues[r].uniqueName!=undefined&&t[0].level!=undefined&&rowKeysCalcValues[r].level!=undefined&&t[0].uniqueName.indexOf(rowKeysCalcValues[r].uniqueName)===0&&rowKeysCalcValues[r].level+1==t[0].level}).map(function(i,r){if(r[u+cCnt].length>0){f++;for(var e=0;e<r[u+cCnt].length;e++)t[e]==undefined&&(t[e]=0),t[e]=n.values[e].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(e,t,n):ej.PivotAnalysis._getSummaryValue(t[e],r[u+cCnt][e],f,summaryTypes[e]=="count"?"sum":summaryTypes[e],n.values[e].format)}return t})),rowKeysCalcValues[r].cellType!=undefined&&rowKeysCalcValues[r].cellType.indexOf("RGTot")>-1&&(f=0,v=$(rowTotCalc).filter(function(n,t){return t!=undefined&&t[0]!=undefined&&t[0].level!=undefined&&t[0].level==0}).map(function(i,r){if(r[u+cCnt].length>0){f++;for(var e=0;e<r[u+cCnt].length;e++)t[e]==undefined&&(t[e]=0),t[e]=n.values[e].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(e,t,n):ej.PivotAnalysis._getSummaryValue(t[e],r[u+cCnt][e],f,summaryTypes[e]=="count"?"sum":summaryTypes[e],n.values[e].format)}return t})),f=1,s=k;s<=r+o;s++){for(w=!1,i=0;i<e;i++)h=0,gridMatrix[s]!=undefined&&gridMatrix[s][u+cCnt*e+i]!=undefined&&gridMatrix[s][u+cCnt*e+i].Value!=undefined&&(t[i]==undefined&&(t[i]=0),w=!0,t[i]=n.values[i].isCalculatedField?this._calculatedFieldSummaryValue(i,t,n):this._getSummaryValue(t[i],gridMatrix[s][u+cCnt*e+i].Value,f,summaryTypes[i]=="count"?"sum":summaryTypes[i],n.values[i].format)),h++;w&&f++}b=0;p=!0;y&&(rowTotCalc[a][0]={uniqueName:rowKeysCalcValues[r].uniqueName,level:rowKeysCalcValues[r].level},y=!1);rowTotCalc[a][u+cCnt]=t;cellType="summary value"}for(l=0;l<e;l++)gridMatrix[o+r][e*cCnt+l+u]=t!=undefined&&t.length!=undefined?{Index:e*cCnt+l+u+","+o+r,CSS:cellType,Value:t[l],State:0,ColSpan:1,RowSpan:1,Info:"",Span:"None",Expander:0}:0}p&&(a++,k=r+o+1,p=!1)}return gridMatrix}};ej.PivotAnalysis.SortOrder={Ascending:"ascending",Descending:"descending"};ej.PivotAnalysis.FilterType={Exclude:"exclude",Include:"include"};ej.PivotAnalysis.SummaryType={Sum:"sum",Average:"average",Count:"count",Min:"min",Max:"max"}})(jQuery,Syncfusion)});
